var swfobject=function(){function C(){if(b)return;try{var e=a.getElementsByTagName("body")[0].appendChild(U("span"));e.parentNode.removeChild(e)}catch(t){return}b=!0;var n=c.length;for(var r=0;r<n;r++)c[r]()}function k(e){b?e():c[c.length]=e}function L(t){if(typeof u.addEventListener!=e)u.addEventListener("load",t,!1);else if(typeof a.addEventListener!=e)a.addEventListener("load",t,!1);else if(typeof u.attachEvent!=e)z(u,"onload",t);else if(typeof u.onload=="function"){var n=u.onload;u.onload=function(){n();t()}}else u.onload=t}function A(){l?O():M()}function O(){var n=a.getElementsByTagName("body")[0],r=U(t);r.setAttribute("type",i);var s=n.appendChild(r);if(s){var o=0;(function(){if(typeof s.GetVariable!=e){var t=s.GetVariable("$version");if(t){t=t.split(" ")[1].split(",");T.pv=[parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10)]}}else if(o<10){o++;setTimeout(arguments.callee,10);return}n.removeChild(r);s=null;M()})()}else M()}function M(){var t=h.length;if(t>0)for(var n=0;n<t;n++){var r=h[n].id,i=h[n].callbackFn,s={success:!1,id:r};if(T.pv[0]>0){var o=R(r);if(o)if(W(h[n].swfVersion)&&!(T.wk&&T.wk<312)){V(r,!0);if(i){s.success=!0;s.ref=_(r);i(s)}}else if(h[n].expressInstall&&D()){var u={};u.data=h[n].expressInstall;u.width=o.getAttribute("width")||"0";u.height=o.getAttribute("height")||"0";o.getAttribute("class")&&(u.styleclass=o.getAttribute("class"));o.getAttribute("align")&&(u.align=o.getAttribute("align"));var a={},f=o.getElementsByTagName("param"),l=f.length;for(var c=0;c<l;c++)f[c].getAttribute("name").toLowerCase()!="movie"&&(a[f[c].getAttribute("name")]=f[c].getAttribute("value"));P(u,a,r,i)}else{H(o);i&&i(s)}}else{V(r,!0);if(i){var p=_(r);if(p&&typeof p.SetVariable!=e){s.success=!0;s.ref=p}i(s)}}}}function _(n){var r=null,i=R(n);if(i&&i.nodeName=="OBJECT")if(typeof i.SetVariable!=e)r=i;else{var s=i.getElementsByTagName(t)[0];s&&(r=s)}return r}function D(){return!w&&W("6.0.65")&&(T.win||T.mac)&&!(T.wk&&T.wk<312)}function P(t,n,r,i){w=!0;g=i||null;y={success:!1,id:r};var o=R(r);if(o){if(o.nodeName=="OBJECT"){v=B(o);m=null}else{v=o;m=r}t.id=s;if(typeof t.width==e||!/%$/.test(t.width)&&parseInt(t.width,10)<310)t.width="310";if(typeof t.height==e||!/%$/.test(t.height)&&parseInt(t.height,10)<137)t.height="137";a.title=a.title.slice(0,47)+" - Flash Player Installation";var f=T.ie&&T.win?"ActiveX":"PlugIn",l="MMredirectURL="+u.location.toString().replace(/&/g,"%26")+"&MMplayerType="+f+"&MMdoctitle="+a.title;typeof n.flashvars!=e?n.flashvars+="&"+l:n.flashvars=l;if(T.ie&&T.win&&o.readyState!=4){var c=U("div");r+="SWFObjectNew";c.setAttribute("id",r);o.parentNode.insertBefore(c,o);o.style.display="none";(function(){o.readyState==4?o.parentNode.removeChild(o):setTimeout(arguments.callee,10)})()}j(t,n,r)}}function H(e){if(T.ie&&T.win&&e.readyState!=4){var t=U("div");e.parentNode.insertBefore(t,e);t.parentNode.replaceChild(B(e),t);e.style.display="none";(function(){e.readyState==4?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)})()}else e.parentNode.replaceChild(B(e),e)}function B(e){var n=U("div");if(T.win&&T.ie)n.innerHTML=e.innerHTML;else{var r=e.getElementsByTagName(t)[0];if(r){var i=r.childNodes;if(i){var s=i.length;for(var o=0;o<s;o++)(i[o].nodeType!=1||i[o].nodeName!="PARAM")&&i[o].nodeType!=8&&n.appendChild(i[o].cloneNode(!0))}}}return n}function j(n,r,s){var o,u=R(s);if(T.wk&&T.wk<312)return o;if(u){typeof n.id==e&&(n.id=s);if(T.ie&&T.win){var a="";for(var f in n)n[f]!=Object.prototype[f]&&(f.toLowerCase()=="data"?r.movie=n[f]:f.toLowerCase()=="styleclass"?a+=' class="'+n[f]+'"':f.toLowerCase()!="classid"&&(a+=" "+f+'="'+n[f]+'"'));var l="";for(var c in r)r[c]!=Object.prototype[c]&&(l+='<param name="'+c+'" value="'+r[c]+'" />');u.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+a+">"+l+"</object>";p[p.length]=n.id;o=R(n.id)}else{var h=U(t);h.setAttribute("type",i);for(var d in n)n[d]!=Object.prototype[d]&&(d.toLowerCase()=="styleclass"?h.setAttribute("class",n[d]):d.toLowerCase()!="classid"&&h.setAttribute(d,n[d]));for(var v in r)r[v]!=Object.prototype[v]&&v.toLowerCase()!="movie"&&F(h,v,r[v]);u.parentNode.replaceChild(h,u);o=h}}return o}function F(e,t,n){var r=U("param");r.setAttribute("name",t);r.setAttribute("value",n);e.appendChild(r)}function I(e){var t=R(e);if(t&&t.nodeName=="OBJECT")if(T.ie&&T.win){t.style.display="none";(function(){t.readyState==4?q(e):setTimeout(arguments.callee,10)})()}else t.parentNode.removeChild(t)}function q(e){var t=R(e);if(t){for(var n in t)typeof t[n]=="function"&&(t[n]=null);t.parentNode.removeChild(t)}}function R(e){var t=null;try{t=a.getElementById(e)}catch(n){}return t}function U(e){return a.createElement(e)}function z(e,t,n){e.attachEvent(t,n);d[d.length]=[e,t,n]}function W(e){var t=T.pv,n=e.split(".");n[0]=parseInt(n[0],10);n[1]=parseInt(n[1],10)||0;n[2]=parseInt(n[2],10)||0;return t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?!0:!1}function X(n,r,i,s){if(T.ie&&T.mac)return;var o=a.getElementsByTagName("head")[0];if(!o)return;var u=i&&typeof i=="string"?i:"screen";if(s){E=null;S=null}if(!E||S!=u){var f=U("style");f.setAttribute("type","text/css");f.setAttribute("media",u);E=o.appendChild(f);T.ie&&T.win&&typeof a.styleSheets!=e&&a.styleSheets.length>0&&(E=a.styleSheets[a.styleSheets.length-1]);S=u}T.ie&&T.win?E&&typeof E.addRule==t&&E.addRule(n,r):E&&typeof a.createTextNode!=e&&E.appendChild(a.createTextNode(n+" {"+r+"}"))}function V(e,t){if(!x)return;var n=t?"visible":"hidden";b&&R(e)?R(e).style.visibility=n:X("#"+e,"visibility:"+n)}function $(t){var n=/[\\\"<>\.;]/,r=n.exec(t)!=null;return r&&typeof encodeURIComponent!=e?encodeURIComponent(t):t}var e="undefined",t="object",n="Shockwave Flash",r="ShockwaveFlash.ShockwaveFlash",i="application/x-shockwave-flash",s="SWFObjectExprInst",o="onreadystatechange",u=window,a=document,f=navigator,l=!1,c=[A],h=[],p=[],d=[],v,m,g,y,b=!1,w=!1,E,S,x=!0,T=function(){var s=typeof a.getElementById!=e&&typeof a.getElementsByTagName!=e&&typeof a.createElement!=e,o=f.userAgent.toLowerCase(),c=f.platform.toLowerCase(),h=c?/win/.test(c):/win/.test(o),p=c?/mac/.test(c):/mac/.test(o),d=/webkit/.test(o)?parseFloat(o.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,v=!1,m=[0,0,0],g=null;if(typeof f.plugins!=e&&typeof f.plugins[n]==t){g=f.plugins[n].description;if(g&&(typeof f.mimeTypes==e||!f.mimeTypes[i]||!!f.mimeTypes[i].enabledPlugin)){l=!0;v=!1;g=g.replace(/^.*\s+(\S+\s+\S+$)/,"$1");m[0]=parseInt(g.replace(/^(.*)\..*$/,"$1"),10);m[1]=parseInt(g.replace(/^.*\.(.*)\s.*$/,"$1"),10);m[2]=/[a-zA-Z]/.test(g)?parseInt(g.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else if(typeof u.ActiveXObject!=e)try{var y=new ActiveXObject(r);if(y){g=y.GetVariable("$version");if(g){v=!0;g=g.split(" ")[1].split(",");m=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)]}}}catch(b){}return{w3:s,pv:m,wk:d,ie:v,win:h,mac:p}}(),N=function(){if(!T.w3)return;(typeof a.readyState!=e&&a.readyState=="complete"||typeof a.readyState==e&&(a.getElementsByTagName("body")[0]||a.body))&&C();if(!b){typeof a.addEventListener!=e&&a.addEventListener("DOMContentLoaded",C,!1);if(T.ie&&T.win){a.attachEvent(o,function(){if(a.readyState=="complete"){a.detachEvent(o,arguments.callee);C()}});u==top&&function(){if(b)return;try{a.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}C()}()}T.wk&&function(){if(b)return;if(!/loaded|complete/.test(a.readyState)){setTimeout(arguments.callee,0);return}C()}();L(C)}}(),J=function(){T.ie&&T.win&&window.attachEvent("onunload",function(){var e=d.length;for(var t=0;t<e;t++)d[t][0].detachEvent(d[t][1],d[t][2]);var n=p.length;for(var r=0;r<n;r++)I(p[r]);for(var i in T)T[i]=null;T=null;for(var s in swfobject)swfobject[s]=null;swfobject=null})}();return{registerObject:function(e,t,n,r){if(T.w3&&e&&t){var i={};i.id=e;i.swfVersion=t;i.expressInstall=n;i.callbackFn=r;h[h.length]=i;V(e,!1)}else r&&r({success:!1,id:e})},getObjectById:function(e){if(T.w3)return _(e)},embedSWF:function(n,r,i,s,o,u,a,f,l,c){var h={success:!1,id:r};if(T.w3&&!(T.wk&&T.wk<312)&&n&&r&&i&&s&&o){V(r,!1);k(function(){i+="";s+="";var p={};if(l&&typeof l===t)for(var d in l)p[d]=l[d];p.data=n;p.width=i;p.height=s;var v={};if(f&&typeof f===t)for(var m in f)v[m]=f[m];if(a&&typeof a===t)for(var g in a)typeof v.flashvars!=e?v.flashvars+="&"+g+"="+a[g]:v.flashvars=g+"="+a[g];if(W(o)){var y=j(p,v,r);p.id==r&&V(r,!0);h.success=!0;h.ref=y}else{if(u&&D()){p.data=u;P(p,v,r,c);return}V(r,!0)}c&&c(h)})}else c&&c(h)},switchOffAutoHideShow:function(){x=!1},ua:T,getFlashPlayerVersion:function(){return{major:T.pv[0],minor:T.pv[1],release:T.pv[2]}},hasFlashPlayerVersion:W,createSWF:function(e,t,n){return T.w3?j(e,t,n):undefined},showExpressInstall:function(e,t,n,r){T.w3&&D()&&P(e,t,n,r)},removeSWF:function(e){T.w3&&I(e)},createCSS:function(e,t,n,r){T.w3&&X(e,t,n,r)},addDomLoadEvent:k,addLoadEvent:L,getQueryParamValue:function(e){var t=a.location.search||a.location.hash;if(t){/\?/.test(t)&&(t=t.split("?")[1]);if(e==null)return $(t);var n=t.split("&");for(var r=0;r<n.length;r++)if(n[r].substring(0,n[r].indexOf("="))==e)return $(n[r].substring(n[r].indexOf("=")+1))}return""},expressInstallCallback:function(){if(w){var e=R(s);if(e&&v){e.parentNode.replaceChild(v,e);if(m){V(m,!0);T.ie&&T.win&&(v.style.display="block")}g&&g(y)}w=!1}}}}(),$$FSR={timestamp:"November 19, 2012 @ 2:57 PM",version:"15.2.5",enabled:!0,frames:!1,sessionreplay:!0,auto:!0,encode:!1,files:"/resources/foresee/",js_files:"http://static2.pbsrc.com/pkg/foresee/",image_files:"http://pic2.pbsrc.com/foresee/",html_files:"/resources/foresee/",css_files:"http://static2.pbsrc.com/pkg/foresee/",swf_files:"http://pic2.pbsrc.com/foresee/",id:"LCTKdQG95s9ec5+mnMnrOA==",definition:"foresee-surveydef.js",embedded:!1,replay_id:"photobucket.com",attach:!1,renderer:"W3C",layout:"CENTERFIXED",pools:[{path:".",sp:100}],sites:[{path:/\w+-?\w+\.(com|org|edu|gov|net|co\.uk)/},{path:".",domain:"default"}],storageOption:"cookie"},FSRCONFIG={};typeof FSR=="undefined"&&function(e){function s(){return function(){}}var t=void 0,n=!0,r=null,i=!1;(function(e,o){function u(e,n){O.controller.execute(O.controller.Ab,w._sd(),{sp:e,when:n,qualifier:t,invite:i})}function a(e,t,n){setTimeout(function(){e.Id(t,n)},1)}function f(e,t){return(t?e.get(t):e)||""}function l(e){return[e||q.g(),(e||q.g()).get("cp")||{}]}function c(e,t){w.k(e.length)||(e=[e]);for(var n=0;n<e.length;n++)X(e[n],"click",t)}function h(e,t){t=t||S;if(!t.querySelectorAll||!!w.R&&8>=z.version&&-1<e.indexOf("nth")){if(E.$&&!E.Prototype)return E.$(e,t);for(var e=e.split(","),r=[],s=e.length-1;0<=s;s--){var o=e[s].replace(/^\s\s*/,"").replace(/\s\s*$/,"").replace(/\*=/g,"=").replace(/\>/g," > ").replace(/\s+/g," ");if(-1<o.indexOf(" ")){for(var o=o.split(" "),u=[t],a=i,f=0;f<o.length;f++)if(">"==o[f])a=n;else{for(var l=[],c=u.length-1;0<=c;c--)l=l.concat(d(o[f],u[c],a));u=l;a=i}r=r.concat(w.ud(u))}else r=r.concat(d(o,t))}return r}return v(t.querySelectorAll(e))}function d(e,t,n){var r=[];if(0<e.length){var i,s,o,u,a=/[\.:\[#]/g,f=[];if(a.test(e))for(var a=e.match(a),l=0;l<a.length;l++){var c=e.indexOf(a[l]);f.push({Eb:e.substr(0,c),ke:a[l]});e=e.substr(c)}f.push({Eb:e});e=f[0].Eb.toUpperCase();for(a=f.length-1;1<=a;a--)l=f[a-1].ke,c=f[a].Eb,"["==l?s=c.substr(1,c.length-2).split("="):"."==l?o=c.substr(1):"#"==l?i=c.substr(1):":"==l&&(u=parseInt(c.replace(":nth-child(","").replace(")","")));0==e.length&&(e="*");if(n)for(a=t.childNodes.length-1;0<=a;a--)n=t.childNodes[a],1==n.nodeType&&("*"==e||n.tagName==e)&&r.push(n);else r=v(t.getElementsByTagName(e));if(i||s||o||u)for(a=r.length-1;0<=a;a--)(u&&w.vd(r[a])!=u-1||o&&-1==r[a].className.indexOf(o)||i&&r[a].id!=i||s&&0>r[a].getAttribute(s[0]).indexOf(s[1]))&&r.splice(a,1)}return r}function v(e){var t=[],n,r=0;for(n=t.length=e.length;r<n;r++)t[r]=e[r];return t}function m(e){var t=S.createElement("div");t.innerHTML=e;e=t.firstChild;e.parentNode.removeChild(e);var t=F.Uc.bd,n;for(n in t)e[n]=t[n];return e}function g(e,t){var n=[],r;for(r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function y(e,t){var n,r,i,s,o=et,u,a=t[e];a&&"object"==typeof a&&"function"==typeof a.toJSON&&(a=a.toJSON(e));"function"==typeof rt&&(a=rt.call(t,e,a));switch(typeof a){case"string":return b(a);case"number":return isFinite(a)?""+a:"null";case"boolean":case"null":return""+a;case"object":if(!a)return"null";et+=tt;u=[];if("[object Array]"===Object.prototype.toString.apply(a)){s=a.length;for(n=0;n<s;n+=1)u[n]=y(n,a)||"null";i=0===u.length?"[]":et?"[\n"+et+u.join(",\n"+et)+"\n"+o+"]":"["+u.join(",")+"]";et=o;return i}if(rt&&"object"==typeof rt){s=rt.length;for(n=0;n<s;n+=1)"string"==typeof rt[n]&&(r=rt[n],(i=y(r,a))&&u.push(b(r)+(et?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=y(r,a))&&u.push(b(r)+(et?": ":":")+i);i=0===u.length?"{}":et?"{\n"+et+u.join(",\n"+et)+"\n"+o+"}":"{"+u.join(",")+"}";et=o;return i}}function b(e){Z.lastIndex=0;return Z.test(e)?'"'+e.replace(Z,function(e){var t=nt[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}var w={},E=E=this,S=E.document;w.Ca=864e5;w.R=!!S.attachEvent;var x=Object.prototype.hasOwnProperty,T=[],C=i,L,T=[],C=i;w.k=function(e){return r!==e&&t!==e};w.ud=function(e){for(var t=e.length-1;0<=t;t--)for(var n=t-1;0<=n;n--)e[n]==e[t]&&e.splice(t,1);return e};w.vd=function(e){for(var t=e.parentNode.childNodes,n,r=count=0;(n=t.item(r++))&&n!=e;)1==n.nodeType&&count++;return count};w.C=function(e){return"[object Array]"==Object.prototype.toString.call(e)};w.Jc=function(e){if(e){if(e.length)for(var t=e.length-1;0<=t;t--)e[t]=r;for(var n in e)if(t=typeof e[n],"function"==t||"object"==t)e[n]=r}};w.J=function(e){return"function"==typeof e};w.Je=function(e){return"object"==typeof e};w.trim=function(e){return e.toString().replace(/\s+/g," ").replace(/^\s+|\s+$/g,"")};w.Fe=function(e){var t=e.getAttribute?e.getAttribute("id"):e.id;t&&!w.Ke(t)&&(t=e.attributes.id.value);return t};w.wd=function(e){return e.toString().replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")};w.n=function(){var e=arguments,n=e[0]||{},i=1,s=e.length,o,u,a;"object"!=typeof n&&!w.J(n)&&(n={});s===i&&(n=this,--i);for(;i<s;i++)if((o=e[i])!=r)for(u in o)a=o[u],n!==a&&a!==t&&(n[u]=a);return n};w.xa=s();w.now=function(){return+(new Date)};w.shift=function(e){return e.splice(0,1)[0]};w.Vb=function(e,t){for(var n in t)if(t[n]===e)return n;return-1};w.Ia=function(){return S.location.protocol};w.He=function(e,t){return-1!=w.Vb(e,t)};w.kb=function(e){return S.getElementById(e)};w.nb=function(e,t,n){for(var i=e.split("."),t=t[w.shift(i)],s=n,o;t!=r&&0<i.length;)t=t[w.shift(i)];if(t){i=e.split(".");for(o;i.length&&(o=w.shift(i));)s=s[o]?s[o]:s[o]={};i=e.split(".");s=n;for(o;i.length&&(o=w.shift(i));)0<i.length?s=s[o]:s[o]=t}};w.K=function(){return S.location.href};w.Ka=function(e){return encodeURIComponent(e)};w.N=function(e){return decodeURIComponent(e)};w.Ja=function(){return S.referrer};w.wb={};w.Pa=function(e,t,r){var r=r||w.xa,s=S.createElement(t);(t="script"===t)||(s.rel="stylesheet");s.type=t?"text/javascript":"text/css";t&&(w.R?s.onreadystatechange=function(){("loaded"==this.readyState||"complete"==this.readyState)&&r("ok")}:s.onload=function(){r("ok")},s.onerror=function(){r("error")});s[t?"src":"href"]=0==w.Vb("//",e)?w.Ia()+e:e;t?w.cb.appendChild(s):t||(w.wb[s.href]?s=w.wb[s.href]:(w.wb[s.href]=s,w.cb.appendChild(s)));if(!t){var o,u;"sheet"in s?(o="sheet",u="cssRules"):(o="styleSheet",u="rules");var a=setInterval(function(){try{if(s[o]&&s[o][u].length){clearInterval(a);clearTimeout(f);r(n,s)}}catch(e){}finally{}},10),f=setTimeout(function(){clearInterval(a);clearTimeout(f);r(i,s)},2500)}};w.Ua=function(e){var t,i;i||(i=E);i=i.document;i=i.readyState;t=t||1;if(w.J(e)&&(e=function(e,t){return function(){setTimeout(function(e){return function(){e.call(w.mb);e=r}}(e),t);e=r}}(e,t),i&&("complete"==i||"loaded"==i))){C=n;for(T.push(e);e=w.shift(T);)e&&e.call(w.mb);return}if(!C&&w.J(e))T.push(e);else if(C&&w.J(e))e.call(w.mb);else if(!w.J(e))for(C=n;0<T.length;)(e=w.shift(T))&&e.call(w.mb);e=i=i=i=r};S.addEventListener?L=function(){"complete"===S.readyState&&(S.removeEventListener("readystatechange",L,i),w.Ua(r))}:w.R&&(L=function(){"complete"===S.readyState&&(S.detachEvent("onreadystatechange",L),w.Ua(r))});i||(S.addEventListener?S.addEventListener("readystatechange",L,i):w.R&&S.attachEvent("onreadystatechange",L));w.match=function(e){for(var s=i,o=[["urls",w.K()],["referrers",w.Ja()],["userAgents",E.navigator.userAgent]],u=0;u<o.length;u++){for(var a=o[u],f=e[a[0]]||[],l=0;l<f.length;l++)if(w.N(a[1]).match(f[l])){s=n;break}if(s)break}if(s)return n;f=e.cookies||[];for(u=0;u<f.length;u++)if(a=f[u],o=q.l.O(a.name))if(o.match(a.value||".")){s=n;break}if(s)return n;s=q.Ea("fsr.ipo",q.La("fsr.ipo"));if(e=e.variables){u=0;for(a=e.length;u<a;u++)if(f=e[u].name,o=e[u].value,f!=A.ipexclude||1!=s.get("value")){w.C(f)||(f=[f],o=[o]);for(var c,l=n,h=0,d=f.length;h<d;h++){try{if(c=(new Function("return "+f[h]))(),c===t||c===r)c=""}catch(v){c=""}var m;if(m=c||""===c){e:{m=c;var g=o[h];w.C(g)||(g=[g]);for(var y=0,b=g.length;y<b;y++)if((m+"").match(g[y])){m=n;break e}m=i}m=!m}if(m){l=i;break}}if(l)return n}}return i};w.cb=r;w.Ua(function(){w.cb=S.getElementsByTagName("head")[0]||S.documentElement});w.startTime=w.now();var A={},O=w.n({replay_id:"sitecom",site:{domain:"site.com"},renderer:"W3C",layout:"",swf_files:"/"},o||{});w.yb=function(){for(var e={},t=arguments,n=0,r=t.length;n<r;n++){var i=t[n];if(w.Oa(i))for(var s in i){var o=i[s],u=e[s];e[s]=u&&w.Oa(o)&&w.Oa(u)?w.yb(u,o):w.Gb(o)}}return e};w.Gb=function(e){var t;if(w.Oa(e)){t={};for(var n in e)t[n]=w.Gb(e[n])}else if(w.C(e)){t=[];n=0;for(var r=e.length;n<r;n++)t[n]=w.Gb(e[n])}else t=e;return t};w.Oa=function(e){if(!e||"[object Object]"!==Object.prototype.toString.call(e)||e.nodeType||e.setInterval||e.constructor&&!x.call(e,"constructor")&&!x.call(e.constructor.prototype,"isPrototypeOf"))return i;for(var n in e);return n===t||x.call(e,n)||!x.call(e,n)&&x.call(Object.prototype,n)};w.ac=function(){T=O=r;w=E=E.FSR=r};w.Ge=function(e){var t=w.now(),n;do n=w.now();while(n-t<e)};if(w.k(E.FSRCONFIG)){var M=E.FSRCONFIG;M.surveydefs&&(w.surveydefs=M.surveydefs,M.surveydefs=r);M.properties&&(w.properties=M.properties,M.properties=r)}E.FSR=w;E.FSR.opts=O;E.FSR.prop=A;w.P={};w.P.Tc={};for(var _=w.P.Tc,D={},P=["onload","onerror","onabort"],M=0;M<P.length;M++)D[P[M]]=function(){this.Qa(0==arguments.callee.Fd?1:0);this.Va=i},D[P[M]].Fd=M;_.G=function(e,t){this.options=w.n({},e);this.Va=i;this.event=t;this.Hb=0;return this};_.G.prototype.Qa=function(e,t){if(this.Va)switch(this.Va=i,this.status=e,e){case 1:(this.options.onSuccess||w.xa)(t);break;case 0:this.event?this.te():(this.options.onFailure||w.xa)(t);break;case-1:(this.options.onError||w.xa)(t)}};_.G.prototype.te=function(){3>this.Hb?this.Ob():this.onFailure()};_.G.prototype.Pb=function(e,t){this.Va=n;for(var i=B.S(w.n(e,{uid:w.now()})),i=w.Ia()+"//"+this.options.host+this.options.path+this.options.url+"?"+i,t=w.n({},D,t),s=new Image,o=0;o<P.length;o++){var u=P[o];s[u]=function(){var e=arguments.callee;e.ua.onload=e.ua.onerror=e.ua.onabort=r;e.yd.call(e.self,e.ua);e.ua=r};s[u].yd=t[u];s[u].ua=s;s[u].self=this}s.src=i};_.G.prototype.send=function(e){this.we=e;this.Ob()};_.G.prototype.na=function(){this.Pb(w.n(this.options.Ra,{protocol:w.Ia()}),{onload:function(e){!this.options.Ya||e.width==this.options.Ya?this.Qa(1,e.width):this.Qa(0,e.width)},onerror:function(){this.Qa(-1)}})};_.G.prototype.Ob=function(){var e;this.Hb++;e=w.n({event:this.event,ver:this.Hb},this.we,e);this.Pb(e)};w.P.Zc={};var B=w.P.Zc;B.zd=function(){for(var e=z.Tb.replace(/[\s\\\/\.\(\);:]/gim,""),t="",n=w.now()+"",r=0;r<e.length-1;r+=e.length/7)t+=Number(e.charCodeAt(Math.round(r))%16).toString(16);7<t.length&&(t=t.substr(t.length-7));return t+"-"+e.length+n.substr(n.length-6)+"-xxxx-xxxx-xxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:t&3|8).toString(16)})};B.oa=function(){return 0+100*Math.random()};B.S=function(e,t,n){var r="";if(e)for(var i in e)r+=(0!=r.length?"&":"")+(t?t+"["+i+"]":i)+"="+(n?val:w.Ka(e[i]));return r};B.hash=function(e){e=e.split("_");return 3*e[0]+1357+""+(9*e[1]+58)};B.sc=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");e=RegExp("[\\?&+]"+e+"=([^&#]*)").exec(w.K());return e==r?i:e[1]};B.la=function(e,t){return e[t]||e.files};B.Sb=function(e){for(var t=/position *: *fixed/,n=0;n<document.styleSheets.length;n++)if(!document.styleSheets[n].href||-1==document.styleSheets[n].href.indexOf("foresee-dhtml.css")){var r=document.styleSheets[n].cssRules?document.styleSheets[n].cssRules:document.styleSheets[n].rules;if(r)for(var i=0;i<r.length;i++)r[i].cssText&&r[i].cssText.match(t)&&r[i].selectorText&&I(h(r[i].selectorText),e)}};w.P.f={};var j=w.P.f;j.hc=function(e,t){for(var n=e.name,r=[e.site,e.section,t,q.g("q"),q.g("l")],i=0;i<r.length;i++)n+=r[i]?"-"+r[i]:"";return n};j.Jd=function(e,t){function n(t){"ok"===t&&w.surveydefs&&(w.n(A,w.properties),O.qa=O.surveydefs=w.surveydefs,e())}var r=O.definition||"foresee-surveydef.js";t?setTimeout(function(){n("ok")},100):w.Pa(B.la(O.site,"js_files")+r,"script",n)};j.log=function(e,t){if(A.events.enabled){var n=q.g(),r=n.get("sd");w.k(r)||(r=n.get("cd"));var r=O.qa[r],i=new Date;(new _.G(j.z.event,"logit")).send({cid:O.id,rid:n.get("rid")||"",cat:r.name,sec:r.section||"",type:n.get("q")||"",site:O.site.name||"",lang:n.get("l")||w.$S.locale||"",msg:e,param:t,tms:i.getTime(),tmz:6e4*i.getTimezoneOffset()})}};w.P.Rc={};var F=w.P.Rc;F.Y=function(e,t){var n,r,i;w.k(e.length)||(e=[e]);n=0;for(r=e.length;n<r;n++){i=e[n];var s=i.className||"";RegExp("\\b"+t+"\\b").test(s)||(i.className=(""==s?"":s+" ")+t)}};F.Cb=function(e,t){var n,r,i;w.k(e.length)||(e=[e]);n=0;for(r=e.length;n<r;n++)i=e[n],i.className&&(i.className=i.className.replace(RegExp("\\b"+t+"\\b"),""))};F.sd=function(e,t){if(e){w.k(e.length)||(e=[e]);for(var n=0;n<e.length;n++)for(var r in t)r&&(-1=="zIndex".indexOf(r)&&"number"==typeof t[r]&&"opacity"!=r&&(t[r]+="px"),e[n].style[r]=t[r])}return e};F.Be=function(e,t){if(e){w.k(e.length)||(e=[e]);for(var n=0;n<e.length;n++)for(var r in t)e[n].setAttribute(r,t[r])}return e};var I=F.sd;F.outerHTML=function(e){if(w.k(e.outerHTML))return e.outerHTML;var t={TEXTAREA:n},r={HR:n,BR:n,IMG:n,INPUT:n},i=[],s="",o=e.nodeName;switch(e.nodeType){case 1:s=s+"<"+o.toLowerCase();if(t[o])switch(o){case"TEXTAREA":for(t=0;t<e.attributes.length;t++)if("value"!=e.attributes[t].nodeName.toLowerCase())s+=" "+e.attributes[t].nodeName.toUpperCase()+'="'+e.attributes[t].nodeValue+'"';else var u=e.attributes[t].nodeValue;s=s+">"+u+("</"+o+">")}else{for(t=e.attributes.length-1;0<=t;t--)u=e.attributes[t].nodeName.toLowerCase(),-1<"style,class,id".indexOf(u.toLowerCase())&&(s+=" "+u+'="'+e.attributes[t].nodeValue+'"');s+=">";r[o]||(s+=e.innerHTML,s+="</"+o.toLowerCase()+">")}break;case 3:s+=e.nodeValue;break;case 8:s+="<!--"+e.nodeValue+"-->"}i.push(s);return i.join("")};w.P.Xc={};var q=w.P.Xc;q.ba=function(e){return e+(O.site.cookie?"."+O.site.cookie:"")};q.g=function(e,t){var n=q.ba("fsr.s"),n=q.Ea(n,q.La(n));return e?w.k(t)?n.set(e,t):n.get(e):n};q.La=function(e){var n;n="window"==O.storageOption?function(){var e=arguments.callee;return new q.Nb(e.rc,e.dc||{})}:function(){var e=arguments.callee;return new q.l(e.rc,w.n({path:"/",domain:e.zb.site.domain,secure:e.zb.site.secure,encode:e.zb.encode},e.dc||{}))};n.rc=e;n.zb=O;n.dc=t;return n};var R={};q.Ea=function(e,t){var n=R[e];return n!=r?n:n=R[e]=new t};var U={Explorer:5.5,Safari:2,Firefox:1.4,Opera:1e3};B.Jb=function(){function e(e){return-1<s.toLowerCase().indexOf(e.toLowerCase())}var r={m:"",B:"",version:0,oc:i},s=r.Tb=E.navigator.userAgent;/Opera[\/\s](\d+\.\d+)/.test(s)?r.B="Opera":/MSIE (\d+\.\d+);/.test(s)?r.B="IE":/Navigator[\/\s](\d+\.\d+)/.test(s)?r.B="Netscape":/Chrome[\/\s](\d+\.\d+)/.test(s)?r.B="Chrome":/Safari[\/\s](\d+\.\d+)/.test(s)?(r.B="Safari",/Version[\/\s](\d+\.\d+)/.test(s),r.version=new Number(RegExp.$1)):/Firefox[\/\s](\d+\.\d+)/.test(s)&&(r.B="Firefox");e("Windows")?r.m="Windows":e("OS X")?r.m="Mac":e("Linux")?r.m="Linux":e("Mac")&&(r.m="Mac");e("Android")?r.m="Android":e("iPod")?r.m="iPod":e("iPad")?r.m="iPad":e("iPhone")?r.m="iPhone":(e("blackberry")||e("playbook")||e("BB10"))&&e("applewebkit")?r.m="Blackberry":e("Windows Phone")?r.m="Winphone":e("Kindle")?r.m="Kindle":e("Silk")?r.m="Kindle":e("BNTV250")?r.m="Nook":e("Nook")&&(r.m="Nook");""==r.m&&(r.m=E.orientation!=t?"Mobile":"Other");r.Le=-1<"Android,iPod,iPad,iPhone,Blackberry,Winphone,Kindle,Mobile".indexOf(r.m);if(""==r.B)r.B="Unknown";else if(!r.nd||0==r.nd)r.version=parseFloat(new Number(RegExp.$1));r.oc="IE"==r.B&&8<=r.version;"IE"==r.B&&8>r.version&&e("Trident")&&(r.oc=n);return r}();var z=B.Jb;B.q={};B.q.ra={};B.q.$a=function(e,t,n,r){var i=B.q.ra;if(e){i[t]||(i[t]=[]);i[t].push({pb:e,Ha:n});if("unload"==t){if(w.k(w.Ba)){w.Ba.push(n);return}w.Ba=[]}"propertychange"!=t&&e.addEventListener?e.addEventListener(t,n,!r):e.attachEvent&&e.attachEvent("on"+t,n)}};B.q.ye=function(e,t,n,r,s){var o=B.q;if(s){if(e.getAttribute("_fsr"+t))return i;e.setAttribute("_fsr"+t,"true")}else if(s=o.ra[t])for(o=s.length-1;0<=o;o--){if(w.R)try{s[o].pb.toString()}catch(u){s.splice(o,1);continue}if(s[o].pb==e&&(r||s[o].Ha==n))return i}B.q.$a(e,t,n)};B.q.Qc=function(e,t,r){B.q.$a(e,t,r,n)};B.q.Mb=function(e,t,n){try{"propertychange"!=t&&e.removeEventListener?e.removeEventListener(t,n):e.detachEvent&&e.detachEvent("on"+t,n)}catch(r){}};var W=B.q.$a,X=B.q.Qc,V=B.q.Mb;B.q.Sc=function(){for(var e=w.Ba.length-1;0<=e;e--)try{w.Ba[e].call()}catch(t){}w.Jc(w.Ba);B.q.Vc();w.ac()};W(E,"unload",B.q.Sc);B.q.Vc=function(){if(w){var e=B.q,t;for(t in e.ra){for(var n=e.ra[t],r={};r=n.pop();)e.Mb(r.pb,t,r.Ha),w.Jc(r);delete e.ra[t]}}};B.q.ab=function(){this.Aa=[]};B.q.ab.prototype.Xa=function(e){this.Aa[this.Aa.length]={Qd:i,Ha:e}};B.q.ab.prototype.A=function(){for(var e=0;e<this.Aa.length;e++){var t=this.Aa[e];t.Ha.apply(this,arguments);t.Qd&&(this.Aa.splice(e,1),e--)}};var $=B.q.ab;F.Uc={bd:{}};try{Array.prototype.slice.call(document.getElementsByTagName("html")),makeArray=function(e){return Array.prototype.slice.call(e)}}catch(J){}F.M={};F.M.Da=function(e){var t=0,n=0,r=e.document,i=r.documentElement;"number"==typeof e.innerWidth?(t=e.innerWidth,n=e.innerHeight):i&&(i.clientWidth||i.clientHeight)?(t=i.clientWidth,n=i.clientHeight):r.body&&(r.body.clientWidth||r.body.clientHeight)&&(t=r.body.clientWidth,n=r.body.clientHeight);return{w:t,h:n}};F.M.bb=function(e){var t=0,n=0,r=e.document,i=r.documentElement;"number"==typeof e.pageYOffset?(n=e.pageYOffset,t=e.pageXOffset):r.body&&(r.body.scrollLeft||r.body.scrollTop)?(n=r.body.scrollTop,t=r.body.scrollLeft):i&&(i.scrollLeft||i.scrollTop)&&(n=i.scrollTop,t=i.scrollLeft);return{x:t,y:n}};F.M.Wc=function(t,n){t.scrollTo(0,n);e.document.body.scrollTop=n;e.document.body.scrollLeft=0};j.eb={};j.eb.za=function(e,t){if(e){var n=q.g("m");if(n&&(n=(new Date).getTime()-n,n<1e3*t)){var r=function(){var e=j.z.Nd;e.Ra={rid:O.rid,cid:O.id};(new _.G(e)).na()};r();var i=setInterval(r,1e3*e);setTimeout(function(){clearInterval(i)},1e3*t-n)}}};j.z={};j.z.re={host:"survey.foreseeresults.com",path:"/survey",url:"/display"};j.z.Od={host:"i.4see.mobi",path:"/e",url:"/initialize"};j.z.Nd={host:"i.4see.mobi",path:"/e",url:"/recordHeartbeat"};j.z.t={host:"controller.4seeresults.com",path:"/fsrSurvey",url:"/OTCImg",Ya:3};j.z.event={host:"events.foreseeresults.com",path:"/rec",url:"/process"};j.z.domain={host:"survey.foreseeresults.com",path:"/survey",url:"/FSRImg",Ya:3};j.z.le={host:"replaycontroller.4seeresults.com",path:"/images",enabled:n};j.X=function(e,t){this.options=e;this.fa=t;this.Qb=new $;this.ob=new $;this.Dc=new $;this.wa=this.Na=i;-1<"iphone,ipad,ipod,android,winphone,blackberry,mobile".indexOf(z.m.toLowerCase())&&(this.Na=n);-1<"winphone".indexOf(z.m.toLowerCase())&&(this.wa=n);"IE"==z.B&&7>z.version&&(this.Gd=n)};j.X.prototype.show=function(e,t,s){this.Sd=t;this.kd=s;if(!this.Fb){this.$b=this.Rb=i;var o=this.fa.invite,u=o.isMDOT,a=o.isZoomable||i,f=B.la(O.site,"image_files"),l=this.Na,d=q.g("l"),v=this.qc=m('<div class="fsrC"></div>');u&&F.Y(v,"fsrM");var g=m('<div class="fsrFloatingContainer"></div>'),y=m('<div class="fsrFloatingMid"></div>'),b=m('<div class="fsrInvite"></div>'),x=m('<div class="fsrLogos"></div>');o.siteLogo&&(o=o.siteLogo,"object"==typeof o&&(o=o.hasOwnProperty(d)?o[d]:o["default"]),o=m('<img src="'+f+o+'" class="fsrSiteLogo">'),x.appendChild(o));o=m('<img src="'+f+'fsrlogo.gif" class="fsrCorpLogo">');x.appendChild(o);for(var o=m('<div class="fsrDialogs"></div>'),T=[],N=0,C="",k=0;k<e.length;k++){var L=e[k],M=i;s&&L.locale&&s!=L.locale&&(M=n);if(!M){(M=L.locales)&&M[d]&&(L=w.n(L,M[d]),w.k(L.locale)||(L.locale=d));if(L.skipThisInvite){e.splice(k--,1);continue}var _=L.closeInviteButtonText;_&&(0<C.length&&(C+=" / "),C+=_);u&&17<L.acceptButton.length&&(L.acceptButton=L.acceptButton.substr(0,15)+"...");M=m('<div class="fsrDialog '+(1<e.length?" fsrMultiDialog":"")+'"><h1>'+L.headline+"</h1></div>");M.appendChild(m('<p class="fsrBlurb">'+L.blurb+"</p>"));var D;L.noticeAboutSurvey&&(D=m('<p class="fsrSubBlurb">'+L.noticeAboutSurvey+"</p>"),M.appendChild(D));L.attribution&&M.appendChild(m('<p class="fsrAttribution">'+L.attribution+"</p>"));if(_=L.mobileExitDialog){var P=m('<div class="mobileExit"></div>');P.appendChild(m('<input type="hidden" id="mobileOnExitSupport" value="'+_.support+'"/>'));P.appendChild(m('<div class="mobileExitErrorFieldRequired mobileExitError hideField">'+_.fieldRequiredErrorText+"</div>"));P.appendChild(m('<div class="mobileExitErrorInvalidFormat mobileExitError hideField">'+_.invalidFormatErrorText+"</div>"));var j=m('<input type="email" class="fsrEmailOrNumber" id="mobileOnExitInput" placeholder="'+_.inputMessage+'"/>');X(j,"keyup",function(e,t,n,r){return function(){e.Md(this.value,t,n,r)}}(this,L.acceptButton,_.emailMeButtonText,_.textMeButtonText));if(this.Na){"android"==z.m.toLowerCase()&&B.Sb({position:"static"});var R=function(e){return function(){var t=e.getBoundingClientRect(),n=F.M.bb(E),r=F.M.Da(E);t.top>n.y+r.h&&F.M.Wc(E,t.top+n.y-(r.h-t.height)/2)}}(j);X(j,"focus",function(e,t){return function(){V(E,"scroll",e.pa);V(E,"resize",e.T);setTimeout(R,500);I(t,{overflow:"visible"})}}(this,v));X(j,"blur",function(e,t){return function(){E.scrollTo(0,1);if((!a||z.m.toLowerCase()!="android")&&!e.wa){e.pa();X(E,"scroll",e.pa)}e.T();X(E,"resize",e.T);I(t,{overflow:"hidden"})}}(this,v));this.wa||X(v,"touchmove",function(e){e.preventDefault()})}P.appendChild(j);M.appendChild(P);P=j=r}if(P=L.quizContent){j=m('<div class="fsrQuiz"></div>');j.appendChild(m('<p class="fsrQuizQuestion">'+P.question+"</p>"));for(var U=0;U<P.answers.length;U++){var W=P.answers[U],$=m('<p class="fsrAnswer" id="fsrAns'+k+"_"+U+'"><input name="fsrQuiz'+k+'" type="radio" id="fsrA'+k+"_"+U+'"><label for="fsrA'+k+"_"+U+'">'+W.answer+"</label></p>");j.appendChild($);W.proceedWithSurvey?X($,"click",function(e){return function(){var t=this.parentNode.parentNode;I(h(".fsrQuiz",t),{display:"none"});I(h(".fsrSubBlurb",t),{display:"block"});I(h(".fsrB",t),{display:"block"});e.T.call(e)}}(this)):X($,"click",function(e,t,n){return function(){var i=this.parentNode.parentNode.parentNode;i.innerHTML='<div class="fsrDialog" style="margin-left: 0px;"><h1>'+t.cancelTitle+'</h1><p class="fsrBlurb">'+t.cancelText+'</p><div class="fsrB" style="display: block;"><a class="declineButton">'+n+"</a></div></div>";c(m(".declineButton"),function(e){return function(){e.aa()}}(e));e.pe.call(e);e.T.call(e);i=r}}(this,W,L.closeInviteButtonText))}M.appendChild(j);W=$=j=r}P=r;j=L.locale;U=m('<div class="fsrB"></div>');++N;W=m('<div class="declineButtonContainer"><a href="javascript:void(0)" class="declineButton'+(w.R?" ie":"")+'" tabindex="'+N+'">'+L.declineButton+"</a></div>");++N;$=m('<div class="acceptButtonContainer"><a href="javascript:void(0)" class="acceptButton'+(w.R?" ie":"")+'"  tabindex="'+N+'">'+L.acceptButton+"</a></div>");L.reverseButtons?(U.appendChild(I($,{"float":"left"})),U.appendChild(I(W,{"float":"right"}))):(U.appendChild(W),U.appendChild($));c(h(".declineButton",U),function(e,t){return function(){e.aa(t)}}(this,j));c(h(".acceptButton",U),function(e,t){return function(){q.g("l",t);e.ja(t)}}(this,j));P&&(I(D,{display:"none"}),I(U,{display:"none"}));M.appendChild(U);T.push(M);j=$=W=U=r}L=r}e=m('<div class="fsrFooter"><a href="http://privacy-policy.truste.com/click-with-confidence/ctv/en/www.foreseeresults.com/seal_m" title="Validate TRUSTe privacy certification" target="_blank"><img src="'+f+'truste.png" class="fsrTruste"></a></div>');b.appendChild(x);b.appendChild(o);b.appendChild(m('<div class="fsrCTermination"></div>'));b.appendChild(e);b.appendChild(m('<div class="fsrCTermination"></div>'));y.appendChild(b);g.appendChild(y);v.appendChild(g);!u&&!A.invite.hideCloseButton&&(y=m('<a href="#" class="fsrCloseBtn" title="'+C+'"><div></div></a>'),b.appendChild(y),X(y,"click",function(e){return function(t){e.aa();t&&t.preventDefault?t.preventDefault():E.event&&E.event.returnValue?E.eventReturnValue=i:t.returnValue=i}}(this)),y=r);b=E.document.body;0==b.children.length?b.appendChild(v):b.insertBefore(v,b.firstChild);if(this.Na||w.R&&(7>=z.version||"CSS1Compat"!=E.document.compatMode))y=u?"fsrM":"",this.Gd&&(y+=" fsrActualIE6"),v.className="fsrC ie6 "+y,this.pa=function(e,t,n){return function(){var r=F.M.bb(E);t.style.left=r.x+"px";t.style.top=r.y+"px";r.y<=0&&n&&z.m.toLowerCase()!="blackberry"&&E.scrollTo(0,1);J.call(e)}}(this,v,l),(!a||"android"!=z.m.toLowerCase())&&!this.wa&&X(E,"scroll",this.pa);var J=this.T=function(e,t,n,r,i){return function(){var s=F.M.Da(E);if(i){var o=document.body,u=document.documentElement,o=Math.max(o.scrollHeight,o.offsetHeight,u.clientHeight,u.scrollHeight,u.offsetHeight);I(e,{width:s.w+"px",height:o+"px"});I(t,{position:"relative",left:(t.parentNode.offsetWidth-t.offsetWidth)/2+"px",top:"10px"})}else if(r){o=s.h;I(e,{width:s.w+"px",height:n.offsetHeight-F.M.bb(E).y+"px"});I(t,{position:"relative",left:(t.parentNode.offsetWidth-t.offsetWidth)/2+"px",top:(o-t.offsetHeight)/2+"px"})}else{I(e,{width:s.w+"px",height:s.h+"px"});I(t,{position:"relative",left:(t.parentNode.offsetWidth-t.offsetWidth)/2+"px",top:(t.parentNode.offsetHeight-t.offsetHeight)/2+"px"})}}}(v,g,b,_,this.wa);this.T.call(this);X(E,"resize",this.T);var K=this.pe=function(e,t,n){return function(){I(e,{width:t.offsetWidth+(e.offsetWidth-n.offsetWidth)+"px"})}}(g,o,x),Q=function(e,t){return function(){var n=e.offsetHeight,r=e.parentNode.offsetHeight;t&&(r=F.M.Da(E).h);n=n>r?"rotateX(0deg) rotateZ(0deg) scale("+r/n+")":"rotateX(0deg) rotateZ(0deg) scale(1.0)";r=e.style;r.WebkitTransform=n;r.MozTransform=n;r.msTransform=n;r.transform=n}}(g,_);I(g,{visibility:"hidden"});setTimeout(function(e,t,n,r,i,s,o){return function(){for(var u=0;u<t.length;u++){I(t[u],{marginLeft:(u>0?15:0)+"px"});n.appendChild(t[u])}K.call(e);J.call(e);i&&E.scrollTo(0,1);var u=r.offsetHeight,a=r.parentNode.offsetHeight;s&&(a=F.M.Da(E).h);if(u>a){F.Y(r,"fsrBulgeInstant");u="rotateX(0deg) rotateZ(0deg) scale("+a/u+")";a=r.style;a.WebkitTransform=u;a.MozTransform=u;a.transform=u}else o>0?F.Y(r,"fsrBulgeInstant"):F.Y(r,"fsrBulge");setTimeout(function(){J.call(e);I(r,{visibility:"visible"});h(".fsrLogos")[0].focus()},1)}}(this,T,o,g,l,_,t),1);this.Fa=function(e,t,n,r,i,s,o){return function(){if(s&&o&&w.k(E.orientation)){E.orientation==0||E.orientation==180?F.Cb(t,"fsrLandscape"):F.Y(t,"fsrLandscape");E.scrollTo(0,1);setTimeout(function(){I(r,{width:n.offsetWidth+(r.offsetWidth-i.offsetWidth)+"px"});J.call(e);Q.call(e)},1);setTimeout(function(){Q.call(e)},500)}}}(this,v,o,g,x,u,l);this.Fa.call(this);X(E,"orientationchange",this.Fa);this.ub=function(e){return function(t){(t.keyCode?t.keyCode:t.which)==27&&e.aa()}}(this);X(S,"keyup",this.ub);this.Fb=n;_=b=e=D=M=o=x=b=y=g=v=o=r}};j.X.prototype.Md=function(e,t,r,s){var o=i;e&&(e.match(/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,6})+$/)?(o=n,h(".acceptButton")[0].innerHTML=r):e.replace(/[^\d.]/g,"").match(/(^\d{10}$)/)&&(o=n,h(".acceptButton")[0].innerHTML=s));o||(h(".acceptButton")[0].innerHTML=t)};j.X.prototype.ta=function(){this.Fb&&(this.T&&V(E,"resize",this.T),this.pa&&V(E,"scroll",this.pa),this.Fa&&V(E,"orientationchange",this.Fa),this.ub&&V(S,"keyup",this.ub),this.qc.parentNode.removeChild(this.qc),this.Fb=i,"android"==z.m.toLowerCase()&&B.Sb({position:"fixed"}))};j.X.prototype.ja=function(e){this.Qb.A(e,this.Sd)};j.X.prototype.aa=function(e){this.ob.A(e)};j.X.prototype.Ta=function(e){this.Dc.A(e)};M={width:"1",height:"1",id:"_"+(""+Math.random()).slice(9),allowfullscreen:n,allowscriptaccess:"always",quality:"high",version:[3,0],Pd:r,xd:r,Ib:i,od:i};E.attachEvent&&E.attachEvent("onunload",function(){__flash_unloadHandler=s();__flash_savedUnloadHandler=s()});var K=w.n(w.De,{Ce:M,Cd:function(){var e,t;try{t=navigator.plugins["Shockwave Flash"].description.slice(16)}catch(n){try{t=(e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7"))&&e.GetVariable("$version")}catch(r){try{t=(e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6"))&&e.GetVariable("$version")}catch(i){}}}return(t=/(\d+)[^\d]+(\d+)[^\d]*(\d*)/.exec(t))?[t[1],t[3]]:[0,0]},jb:function(e){if(e===r||e===t)return r;var n=typeof e;"object"==n&&e.push&&(n="array");switch(n){case"string":return e=e.replace(RegExp('(["\\\\])',"g"),"\\$1"),e=e.replace(/^\s?(\d+\.?\d*)%/,"$1pct"),'"'+e+'"';case"array":return"["+g(e,function(e){return K.jb(e)}).join(",")+"]";case"function":return'"function()"';case"object":var n=[],i;for(i in e)e.hasOwnProperty(i)&&n.push('"'+i+'":'+K.jb(e[i]));return"{"+n.join(",")+"}"}return(""+e).replace(/\s/g," ").replace(/\'/g,'"')},Ee:function(e,t){var e=w.n({},e),n='<object width="'+e.width+'" height="'+e.height+'" id="'+e.id+'" name="'+e.id+'"';e.od&&(e.src+=(-1!=e.src.indexOf("?")?"&":"?")+Math.random());n=e.Ib||!w.R?n+(' data="'+e.src+'" type="application/x-shockwave-flash"'):n+' classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"';n+=">";if(e.Ib||w.R)n+='<param name="movie" value="'+e.src+'" />';e.width=e.height=e.id=e.Ib=e.src=r;e.Pd=e.version=e.xd=r;for(var i in e)e[i]&&(n+='<param name="'+i+'" value="'+e[i]+'" />');i="";if(t){for(var s in t)if(t[s]){var o=t[s];i+=s+"="+(/function|object/.test(typeof o)?K.jb(o):o)+"&"}i=i.slice(0,-1);n+='<param name="flashvars" value=\''+i+"' />"}return n+"</object>"},isSupported:function(e){return Q[0]>e[0]||Q[0]==e[0]&&Q[1]>=e[1]}}),Q=w.Kb=K.Cd();w.Ed=Q!=r&&0<Q.length&&0<parseFloat(Q[0]);w.Ed||(Q=w.Kb=[0,0]);var G={};w.stringify=function(e,t,n){var r;if(E.Prototype){r=Array.prototype.toJSON;delete Array.prototype.toJSON}if(!E.JSON||typeof E.JSON.stringify!="function"){var i;tt=et="";if(typeof n=="number")for(i=0;i<n;i+=1)tt+=" ";else typeof n=="string"&&(tt=n);if(!(!(rt=t)||typeof t=="function"||typeof t=="object"&&typeof t.length=="number"))throw Error("_4c.stringify");e=y("",{"":e})}else e=E.JSON.stringify(e,t,n);E.Prototype&&(Array.prototype.toJSON=r);return e};var Y=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,Z=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,et,tt,nt={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rt;E.JSON?G=E.JSON:function(){function e(e){return e<10?"0"+e:e}if(typeof Date.prototype.toJSON!="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":r};Boolean.prototype.toJSON=function(){return this.valueOf()};Number.prototype.toJSON=function(){return this.valueOf()};String.prototype.toJSON=function(){return this.valueOf()}}typeof G.parse!="function"&&(G.parse=function(e,n){function r(e,i){var s,o,u=e[i];if(u&&typeof u=="object")for(s in u)if(Object.prototype.hasOwnProperty.call(u,s)){o=r(u,s);o!==t?u[s]=o:delete u[s]}return n.call(e,i,u)}var i,e=""+e;Y.lastIndex=0;Y.test(e)&&(e=e.replace(Y,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){i=(new Function("return "+e))();return typeof n=="function"?r({"":i},""):i}throw new SyntaxError("JSON.parse")})}();B.ze=G;q.l=function(e,t){e||(e="STORAGE");this.rb=e.replace(/[- ]/g,"");q.l.I||q.l.sb();this.ca=t||{};this.data={};this.Yc=new $;this.qe=4e3};q.l.prototype.set=function(e,t){this.ib();this.I[e]=t;this.ka()};q.l.prototype.reset=function(e){this.I=e;this.ka()};q.l.prototype.get=function(e){this.ib();return e?this.I[e]:this.I};q.l.prototype.ac=function(e){this.ib();delete this.I[e];this.ka()};q.l.prototype.vb=function(){this.I={};var e=this.ca.duration;this.ca.duration=-1;this.ka();e?this.ca.duration=e:delete this.ca.duration};q.l.prototype.ib=function(){this.I={};try{var e=q.l.O(this.rb);if(e&&e.length>0){this.I=G.parse(e);w.k(this.I)||(this.I={})}}catch(t){this.I={}}};q.l.prototype.ka=function(){var e=w.stringify(this.I);this.rb.length+w.Ka(e).length>this.qe&&this.Yc.A(this);q.l.write(this.rb,e,this.ca)};q.l.O=function(e){return(e=E.document.cookie.match("(?:^|;)\\s*"+w.wd(e)+"=([^;]*)"))?w.N(e[1]):r};q.l.write=function(e,t,n){var t=!n||!w.k(n.encode)||n.encode?w.Ka(t):t,e=w.Ka(e),r;for(r in n)if(n[r]){var i=n[r],t=t+(";"+(r==="duration"?"expires":r));switch(r){case"duration":t+="="+(new Date(w.now()+i*w.Ca)).toGMTString();default:t+="="+i}}E.document.cookie=e+"="+t;return e.length+t.length+2};q.l.vb=function(e,t){q.l.write(e,"",w.n(t,{duration:-1}))};q.l.sb=function(e){e&&e.apply(q.l)};q.l.isSupported=function(){return n};j.U={};w.sa=function(e,t){e||(e=w.now());S.cookie="fsr.a"+(O.site.cookie?"."+O.site.cookie:"")+"="+e+";path=/"+(O.site.domain?";domain="+O.site.domain:"")+(t?";expires="+(new Date(w.now()+ -1*w.Ca)).toGMTString()+";":";")+(O.site.secure?"secure":"")};w.za=function(){if(!j.U.timer){w.sa();j.U.timer=setInterval(w.sa,750)}};w.Hc=function(){if(j.U.timer){clearInterval(j.U.timer);delete j.U.timer;w.sa("stopped",n)}};w.Td=function(){if(j.U.timer){clearInterval(j.U.timer);delete j.U.timer;w.sa("paused")}};for(var it=$$FSR.sites,M=0,st=it.length;M<st;M++){var ot;w.C(it[M].path)||(it[M].path=[it[M].path]);for(var ut=0,at=it[M].path.length;ut<at;ut++)if(ot=w.K().match(it[M].path[ut])){O.siteid=M;O.site=$$FSR.sites[M];O.site.domain?"default"==O.site.domain&&(O.site.domain=r):O.site.domain=ot[0];O.site.secure||(O.site.secure=r);O.site.name||(O.site.name=ot[0]);ut="files js_files image_files html_files css_files swf_files".split(" ");for(M=0;M<ut.length;M++)at=ut[M],O.site[at]||$$FSR[at]&&(O.site[at]=$$FSR[at]);break}if(ot)break}w.za();j.H={};j.H.set=function(e,t,n,r){n=l(r);n[1][e]=t;n[0].set("cp",n[1])};j.H.get=function(e,t){return l(t)[0][e]};j.H.bc=function(e,t){var n=l(t);delete n[1][e];n[0].set("cp",n[1])};j.H.append=function(e,t,n,r){r=l(r);r[1][e]=r[1][e]?r[1][e]+","+t:t;if(n){t=r[1][e].split(",");n=t.length>n?t.length-n:0;r[1][e]=t.splice(n,t.length-1-n+1).join()}r[0].set("cp",r[1])};j.H.S=function(e){var e=e||q.g(),t=e.get("sd");w.k(t)||(t=e.get("cd"));t=O.qa[t];e={browser:z.B+" "+z.version,os:z.m.match(/ipod|ipad|iphone/i)?"iOS":z.m,pv:e.get("pv"),url:f(e,"c"),entry:f(e,"ep"),ref_url:f(e,"ru"),locale:f(e,"l"),site:f(O.site.name),section:f(t.section),referrer:f(e,"r"),terms:f(e,"st"),sessionid:f(e,"rid"),replay_id:f(e,"mid"),flash:w.Kb.join(".")};z.m.match(/android|ipod|ipad|iphone|blackberry|firefox/i)&&(e.screen=screen.width+"x"+screen.height);A.meta.user_agent&&(e.user_agent=z.Tb);if(A.analytics.google_local||A.analytics.google){var n=q.l.O("__utma"),t=q.l.O("__utmz");if(n&&n!=""){n=n.split(".");e.first=n[2];e.last=n[3];e.current=n[4];e.visits=n[5]}if(t&&t!=""){var r,n=[];r=["utmgclid","utmcsr","utmccn","utmcmd","utmctr"];for(var i=0;i<r.length;i++)n.push(RegExp(r[i]+"=([^\\|]*)"));if(t.match(n[0])){e.source="Google";e.campaign="Google Adwords";e.medium="cpc"}else{if(r=t.match(n[1]))e.source=r[1];if(r=t.match(n[2]))e.campaign=r[1];if(r=t.match(n[3]))e.medium=r[1]}if(r=t.match(n[4]))e.keyword=r[1]}}t=q.g("cp");n=q.g("meta");e=w.n({},t||{},e||{},n||{});return B.S(e,"cpp")};ot=j.H;E.FSR.CPPS=ot;ot.set=ot.set;ot.get=ot.get;ot.erase=ot.bc;ot.append=ot.append;M={};E.ForeSee=M;M.CPPS=ot;ot.fsr$set=ot.set;ot.fsr$get=ot.get;ot.fsr$erase=ot.bc;ot.fsr$append=ot.append;j.u={};j.u.va=function(){var e,t=A.analytics.google_remote;if(t){var n=O.site.domain;t[n]&&(e=t[n])}return e};j.u.S=function(e){var t={},n=j.u.va();if(n){t.domain="."+O.site.domain;t.id=n.id;t.name=n.name;t.event=e}return B.S(t,"ga")};j.u.gc=function(e){var t,n=j.u.va();n&&(t=n.events[e]);return t};j.u.fireEvent=function(e){var t=j.u.va();if(t){E._gaq=E._gaq||[];(e=j.u.gc(e))&&E._gaq.push(["_trackEvent","foresee survey",e,t.name])}};j.u.Bd=function(e){var t=e;j.u.va()&&E._gat&&(t=E._gat._getTrackerByName()._getLinkerUrl(e));return t};j.u.Ma=function(){var e=j.u.va();if(e){E._gaq=E._gaq||[];E._gaq.push(["_setAccount",e.id]);E._gaq.push(["_setDomainName","."+O.site.domain]);E._gaq.push(["_trackPageview"]);e=document.createElement("script");e.type="text/javascript";e.async=n;e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}};j.j={};j.j.r={Ae:t,ga:1,V:0,Lb:-1,fb:-2};j.j.Ma=function(){if(!w.k(this.hb)){j.j.cd();!w.k(this.hb)&&this.ad()&&this.ed()&&this.$c()&&this.dd()&&this.gd()&&this.jd()&&this.hd()&&this.F(j.j.r.ga)}};j.j.cd=function(){var e=q.g("v");if(w.k(e)){this.L=e;this.hb=this.L>0?n:i}};j.j.F=function(e){this.L=e;this.hb=e<1?i:n;q.g("v",this.L);if(w.k(w.D)){var e=O.replay_id+"_pool",t=new q.Nb(e);t.set("v",this.L);t.ka();if(q.gb.isSupported()){e=new q.gb(e,i);e.set("v",this.L);e.ka()}}};j.j.gd=function(){var e=O.site;if((new q.l(q.ba("fsr.r"),{path:"/",domain:e.domain,secure:e.secure,encode:O.encode})).get("d")){this.F(j.j.r.Lb);return i}return n};j.j.dd=function(){if(q.l.O("fsr.o")){this.F(j.j.r.V);return i}return n};j.j.ad=function(){if(!q.l.O(q.ba("fsr.a"))){this.F(j.j.r.V);return i}return n};j.j.$c=function(){if(U[z.B]&&B.Jb.version<=U[z.B]){this.F(j.j.r.V);return i}return n};j.j.ed=function(){if(!w.f.Q.Ud[z.m.toLowerCase()]){this.F(j.j.r.V);return i}return n};j.j.hd=function(){var e=B.oa();if(e>0&&e<=this.fd())return n;this.F(j.j.r.fb);return i};j.j.jd=function(){if(!w.k(w.D))return n;var e=O.replay_id+"_pool",t=(new q.Nb(e)).get("v");if(w.k(t)){this.F(t);return i}if(q.gb.isSupported()){t=(new q.gb(e,i)).get("v");if(w.k(t)){this.F(t);return i}}return n};j.j.fd=function(){var e=(new Date).getHours(),t=100;if(w.k(O.pools))for(var n=O.pools,r=0,i=n.length;r<i;r++){var s;Object.prototype.toString.call(n[r].path)!=="[object Array]"&&(n[r].path=[n[r].path]);for(var o=0,u=n[r].path.length;o<u;o++)if(s=w.K().match(n[r].path[o])){t=n[r].sp;break}if(s)break}t=(o=q.Ea("fsr.pool",q.La("fsr.pool")))&&o.get("value")==1?100:t;w.C(t)||(t=[{h:0,p:t}]);n=100;o=0;for(r=t.length;o<r;o++)e>=t[o].h&&(n=t[o].p);return n};var ft;j.ha=function(e,t){this.ca=e;this.fa=t};j.ha.prototype.Dd=function(){var e=this.Ad();ft=new j.X(this.ca,this.fa);this.fa.invite.timeout&&(this.se=setTimeout(function(e){return function(){e.ob.A()}}(ft),this.fa.invite.timeout*1e3));ft.Qb.Xa(function(e,t,r){return function(i,s){t.Rb=n;e.he(t)||t.ta();if(r[s+1]){j.log("104",s+2);clearTimeout(e.se);setTimeout(function(){t.show(r[s+1],s+1,i)},500)}else t.$b||t.options.Za.accepted(i)}}(this,ft,e));ft.ob.Xa(function(e){return function(t){e.$b=n;e.ta();e.Rb||e.options.Za.declined(t)}}(ft));ft.Dc.Xa(function(e){return function(t){e.ta();e.options.Za.Ta(t)}}(ft));ft.show(e[0],0)};j.ha.prototype.he=function(e){if(w.kb("mobileOnExitInput")){this.ic(".mobileExitErrorFieldRequired");this.ic(".mobileExitErrorInvalidFormat");var t=this.fa,s=w.trim(w.kb("mobileOnExitInput").value),o=w.trim(w.kb("mobileOnExitSupport").value),u=function(e,t){return function(n){if(n)if(n==1){t.ta();q.g("m",(new Date).getTime());j.eb.za(A.mobileHeartbeat.delay,A.mobileHeartbeat.max);t.options.Za.accepted(t.kd)}else n==2?e.Gc(".mobileExitErrorFieldRequired"):n==3&&e.Gc(".mobileExitErrorInvalidFormat")}}(this,e),e=function(e){return function(){e.ta()}}(e),a=j.z.Od,f=new Date-0+"_"+Math.round(Math.random()*1e13),l=B.hash(f);a.Ra={rid:O.rid,cid:O.id,sid:j.hc(t,t.pop.later),notify:s,a:f,b:l,c:w.Ca,support:o,cpps:j.H.S()};(new _.G(w.n({onSuccess:u,onError:e},a))).na();t=r;return n}return i};j.ha.prototype.ic=function(e){F.Cb(h(e),"showField");F.Y(h(e),"hideField")};j.ha.prototype.Gc=function(e){F.Cb(h(e),"hideField");F.Y(h(e),"showField")};j.ha.prototype.Ad=function(){var e=this.fa.invite.dialogs;w.C(e[0])||(e=Array(e));return e};w._qualified=function(e){ft.Ta(e)};w._accepted=function(e){ft.ja(e)};w._declined=function(e){ft.aa(e)};var lt={invite:t,qualifier:t,locale:t,canceled:i};w.f=function(e){w.n(this,{options:w.n({},e),nc:i,pc:i,Db:r,Ub:i,Oc:i,cc:[],Pe:r,Z:r,ya:r,Zb:r,da:r});O.controller=this;this.xe()};w.f.loaded=new $;w.f.jc=new $;w.f.Lc=new $;w.f.tb=new $;w.f.kc=new $;w.f.mc=new $;w.f.Nc=new $;w.f.Mc=new $;w.f.Cc=new $;w.f.Kc=new $;w.f.prototype.xe=function(){if(w.f.Q.qb)for(var e=[["loaded",w.f.loaded],["initialized",w.f.jc],["surveyDefChanged",w.f.Lc],["inviteShown",w.f.tb],["inviteAccepted",w.f.kc],["inviteDeclined",w.f.mc],["trackerShown",w.f.Nc],["trackerCanceled",w.f.Mc],["qualifierShown",w.f.Cc],["surveyShown",w.f.Kc]],t=0;t<e.length;t++){var n=e[t];w.J(w.f.Q.qb[n[0]])&&n[1].Xa(w.f.Q.qb[n[0]])}};w.f.prototype.t=function(e){switch(e){case 3:e=q.g("t");return w.k(e)&&e===1;case 6:e=q.g("t");return w.k(e)&&e===0;case 2:return w.k(q.g("i"));case 1:return q.g("i")===1;case 4:return w.k(q.g("s"));case 5:return w.k(q.g("m"))}return i};w.f.prototype.load=function(){if(!E.__$$FSRINIT$$__||E.__$$FSRINIT$$__!==n){E.__$$FSRINIT$$__=n;O.auto&&this.execute(this.Ec,n)}};w.f.prototype.execute=function(){var e=arguments;if(O.enabled&&(O.frames||E==E.top)){for(var t=[],r=0;r<e.length;r++)t.push(e[r]);e=w.shift(t);if(this.nc)e.apply(this,t);else{this.cc.push({fn:e,args:t});if(!this.pc){this.pc=n;j.Jd(function(e){return function(){e.sb()}}(this),O.embedded)}}}};w.f.prototype.sb=function(){w.f.loaded.A();this.fc=!w.k(q.g("pv"));this.Ma();if(this.fc&&w.k(w.D)){var e=j.z.le;if(e.enabled&&j.j.L==j.j.r.ga){e.url="/"+O.replay_id+".gif";(new _.G(w.n({onSuccess:function(e){return function(t){e.ld(t);e.loaded()}}(this),onError:function(e){return function(){e.loaded()}}(this)},e))).na();return}}this.loaded()};w.f.prototype.loaded=function(){this.nc=n;setTimeout(function(e){return function(){var t=w.shift(e.cc);if(t){e.execute(t.fn,t.args);setTimeout(function(e){return function(){e.loaded()}}(e),100)}}}(this),100)};w.f.prototype.Ma=function(){this.Ub=n;this.t(3)||w.Hc();if(this.fc){this.W()&&j.j.F(j.j.r.V);var e,t=O.site;A.altcookie&&A.altcookie.name&&(e=q.l.O(A.altcookie.name))&&(!A.altcookie.value||A.altcookie.value==e)&&j.j.F(j.j.r.Lb);e=new q.l(q.ba("fsr.r"),{path:"/",domain:t.domain,secure:t.secure,encode:O.encode});(t=e.get("i"))&&w.now()<e.get("e")&&(O.rid=t);O.rid||A.events.enabled&&A.events.id&&(O.rid=B.zd());O.rid&&q.g("rid",O.rid);if(e=e.get("s")){q.g("sd",e);q.g("lk",1)}if((e=w.Ja())&&e!=""){A.meta.ref_url&&q.g("ru",e);if(A.meta.referrer){var t=e.match(/^(\w+:\/\/)?((\w+-?\w+\.?)+)\/[!]?/),r;t&&t.length>=3&&(r=t[2]);q.g("r",r)}A.meta.terms&&q.g("st",this.td(e)||"")}if(A.meta.entry){r=w.N(w.K());A.meta.entry_params||(r=r.replace(/(.*?)(\?.*)/g,"$1"));q.g("ep",r)}j.j.L==j.j.r.ga&&A.invite.css&&w.Pa(B.la(O.site,"css_files")+A.invite.css,"link",w.xa);this.ee(q.g())}O.rid=q.g("rid");r=A.tracker.timeout;if(A.tracker.adjust&&w.k(q.g("f"))){r=q.g("to");e=(w.now()-q.g("f"))/1e3;r=Math.round((.9*r+.1*e*2)*10)/10;r=r<2?2:r>5?5:r}A.tracker.adjust&&q.g("to",r);w.f.jc.A()};w.f.prototype.Ec=function(){this.me();var e=i;this.ya&&(e=this.Ac(this.ya));if(this.Z){this.de(this.Z,e);e||this.Ac(this.Z);this.be(this.Z);this.fe()}this.ge()};w.f.prototype.me=function(){var e,t;O.sv=B.oa();this.Db=q.Ea("fsr.sp",q.La("fsr.sp"));w.k(q.g("cd"))&&(this.da=q.g("cd"));O.cs=w.N(w.K());A.meta.url_params||(O.cs=O.cs.replace(/\n/g,"").replace(/(.*?)(\?.*)/g,"$1"));A.meta.url&&q.g("c",O.cs);this.language();var r=q.g("pv")?q.g("pv")+1:1;q.g("pv",r);r=q.g("lc")||{};e=this.Ld();if(e.length!=0){for(t=e.length;0<t;){t=O.qa[e[0]];t.idx=e[0];e="d"+t.idx;this.Yb(t.criteria);r[e]||(r[e]={v:0,s:i});t.lc=r[e].v=r[e].v+1;t.ec=r[e].e||0;t.type="current";this.Wb(t);var s=this.rd(this.Kd(t),t.lc,t.ec);if(s>-1){t.ls=r[e].s=n;if(w.C(t.criteria.lf)){t.criteria.lf=t.criteria.lf[s];t.criteria.sp=t.criteria.sp[s];t.pop.when=t.pop.when[s];w.C(t.invite.dialogs)&&(t.invite.dialogs=t.invite.dialogs[s])}if(t.pin){e=q.g("pn");(!w.k(e)||e>t.idx)&&q.g("pn",t.idx)}}else{t.ls=r[e].s=i;if(w.C(t.criteria.lf)){t.criteria.lf=t.criteria.lf[0];t.criteria.sp=t.criteria.sp[0];t.pop.when=t.pop.when[0];w.C(t.invite.dialogs)&&(t.invite.dialogs=t.invite.dialogs[0])}}this.Xb(t);e=q.g("i");if(!w.k(e)&&j.j.L==j.j.r.ga&&t.Vd){e=B.oa();if(!(e>0&&e<=t.Vd)){j.j.F(j.j.r.fb);w.D&&w.D.lb()}}this.Z=t;this.Zb=t.idx;break}q.g("lc",r)}if(w.k(this.da)&&this.da!=this.Zb&&this.da<O.qa.length){t=O.qa[this.da];t.idx=this.da;e="d"+t.idx;this.Yb(t);t.lc=r[e].v||0;t.ls=r[e].s||i;t.type="previous";this.Wb(t);this.Xb(t);this.ya=t;this.da=t.idx;w.f.Lc.A(this.ya,this.Z)}};w.f.prototype.Ac=function(e){return j.j.L<j.j.r.V?i:this.je(e)?n:this.Bc(e)};w.f.prototype.de=function(e,t){q.g("cd",e.idx);if(!t&&e.ls&&!q.g("lk")){var n=q.g("pn");w.k(n)&&n<e.idx||q.g("sd",e.idx)}};w.f.prototype.be=function(e){if(!(j.j.L<j.j.r.V)||O.attach){if(this.t(1)&&!this.t(4)){this.ea(e,"pop",this.vc);this.ea(e,"cancel",this.Ga)}this.t(2)||this.ea(e,"attach",this.Ab);this.t(3)&&this.ea(e,"pause",this.pause);this.t(5)&&j.eb.za(A.mobileHeartbeat.delay,A.mobileHeartbeat.max)}};w.f.prototype.je=function(e){if(!this.oe(e)||!this.t(3))return i;a(this,e,"tracker");return n};w.f.prototype.oe=function(e){if(!e.ls)return i;if(e.type==="previous"){if(e.pop.when!=="later"||e.pop.after!=="leaving-section")return i}else if(e.type==="current"&&e.pop.when!=="now")return i;return n};w.f.prototype.Bc=function(e){var t=n;this.ne(e)||(t=i);if(t){this.ce(e);a(this,e,"invite")}return t};w.f.prototype.ne=function(e){if(!e.invite)return i;var t=this.t(2);if(e.invite.type&&e.invite.type==="static")return i;if(e.invite.type&&e.invite.type==="dynamic"&&t)return n;if(t)return i;t=w.N(w.K());if(e.invite.include){var r=n;e.invite.include.local&&(r=this.xb(e.invite.include.local,t));if(!r){this.Pc(e);return i}}if(e.invite.exclude){r=i;(r=this.xb(e.invite.exclude.local||[],t))||(r=this.xb(e.invite.exclude.referrer||[],w.N(w.Ja())));r||(r=w.f.Q.W&&w.J(w.f.Q.W.ma)?w.f.Q.W.ma():i);if(r){this.Pc(e);return i}}t=e.type==="previous"?"onexit":"onentry";return e.invite&&e.invite.when!=t||!e.ls?i:e.sv>0&&e.sv<=e.criteria.sp};w.f.prototype.ce=function(e){var t=e.alt;if(t)for(var n=B.oa(),r=0,i=0,s=t.length;i<s;i++){r+=t[i].sp;if(n<=r){if(t[i].url){e.pop.what="url";e.pop.url=t[i].url}else if(t[i].script){e.pop.what="script";e.pop.script=t[i].script}delete e.invite;break}}};w.f.prototype.Id=function(e,t){switch(t){case"invite":this.md(e);break;case"tracker":this.uc(e)}};w.f.prototype.xb=function(e,t){for(var r=0,s=e.length;r<s;r++)if(t.match(e[r]))return n;return i};w.f.prototype.Pc=function(e){var t=q.g("lc");e.ec=t["d"+e.idx].e=(t["d"+e.idx].e||0)+1;q.g("lc",t)};w.f.prototype.md=function(e){var t=this.ma,n=this;A.mode==="hybrid"&&(t=this.qd);(new _.G(w.n({onSuccess:function(){t.call(n,e)},onError:function(){t.call(n,e)}},j.z.t))).na()};w.f.prototype.qd=function(e){var t=q.g("h");if(!w.k(t)){var n=this.ma,r=this;(new _.G(w.n({Ra:{"do":0},success:j.z.t.Ya,onSuccess:function(){n.call(r,e)},onFailure:function(){q.g("h",1)}},j.z.domain))).na()}};w.f.prototype.ea=function(e,t,n){if(e.links)for(var r=0,t=e.links[t]||[],i=0,s=t.length;i<s;i++)r+=this.link(t[i].tag,t[i].attribute,t[i].patterns||[],t[i].qualifier,n,e,{sp:t[i].sp,when:t[i].when,invite:t[i].invite,pu:t[i].pu,check:t[i].check})};w.f.prototype.link=function(e,t,n,i,s,o,u){for(var a=0,f=0;f<n.length;f++){for(var l=n[f],l=h(e+"["+t+"*='"+l+"']"),c=0;c<l.length;c++){a++;W(l[c],"click",function(e,t,n,r,i){return function(){r&&w._qualify(r);i.call(e,t,n)}}(this,o,u,i,s))}l=l=r}i=u=o=s=r;return a};w.f.prototype.Wb=function(e){var t=e.criteria.lf;typeof t=="number"&&(e.criteria.lf={v:t,o:">="})};w.f.prototype.Kd=function(e){var t=e.criteria.lf;w.C(t)||(t=[e.criteria.lf]);return t};w.f.prototype.rd=function(e,t,n){for(var r=-1,i=0,s=e.length;i<s;i++)e[i].o==">="&&t>=e[i].v?r=i:e[i].o=="="&&t-n==e[i].v?r=i:e[i].o==">"&&t>e[i].v&&(r=i);return r};w.f.prototype.W=function(){var e=A.exclude,t=w.f.Q.W&&w.J(w.f.Q.W.global)?w.f.Q.W.global():i;return e?w.match(e)||t:t};w.f.prototype.Xb=function(e){e.sv=O.sv;w.C(e.criteria.sp)&&(e.criteria.sp=e.criteria.sp[(new Date).getDay()]);var t=e.name+(e.section?"-"+e.section:""),n=t+(lt.locale?"-"+lt.locale:"");e.criteria.sp=this.Db.get(t)||this.Db.get(n)||e.criteria.sp;e.invite!==i&&(e.invite=w.yb(A.invite,e.invite||{}));t=["tracker","survey","qualifier","cancel","pop"];for(n=0;n<t.length;n++){var r=t[n];e[r]=w.yb(A[r],e[r]||{})}e.repeatdays=A.repeatdays||e.repeatdays;if(!w.C(e.repeatdays)){t=e.repeatdays;e.repeatdays=[t,t]}};w.f.prototype.ve=function(){if(O.enabled&&!this.Oc&&this.Ub){this.Oc=n;this.ue()}};w.f.prototype.ue=function(){if(lt.invite==0){w.D&&w.D.lb();j.log("103")}A.previous&&q.g("p",O.cs);A.tracker.adjust&&q.g("f",w.now())};w.f.prototype.Ld=function(){for(var e=[],t=O.qa,n=0,r=t.length,i=0;n<r;n++)if(!t[n].site||t[n].site==O.site.name){if(t[n].platform){var s="desktop",o=z.m.toLowerCase();o!="windows"&&o!="mac"&&o!="linux"&&(s="mobile");if(t[n].platform!=s)continue}if(w.match(t[n].include)){e[i++]=n;break}}return e};w.f.prototype.ld=function(e){var t=B.oa();if(!(t>0&&t<=e)||e==1){e!=1&&j.j.F(j.j.r.fb);w.D&&w.D.lb(e==1)}};w.f.prototype.ma=function(e){if(!this.Hd){this.Hd=n;var t=this;lt.locale&&q.g("l",lt.locale);if(e.invite){if(e.pop.when=="random"){var r=w.k(e.pop.now)?["now","later"]:["later","now"];if(B.oa()<=e.pop[r[0]]){e.invite.dialogs=e.invite.dialogs[r[0]];e.pop.when=r[0]}else{e.invite.dialogs=e.invite.dialogs[r[1]];e.pop.when=r[1]}}setTimeout(function(){w.f.tb.A(e,q.g());j.u.fireEvent("invite_shown");q.g("i",0);lt.repeatoverride||t.Wa(e,1);j.log("100",O.cs);if(e.invite.type=="page")t.Xd(e);else{w.n(lt,{invite:0,repeatoverride:A.repeatoverride||i});t.Ne=w.now();t.zc(e,"invite");t.Me=w.now()}},(e.invite.delay||0)*1e3)}else setTimeout(function(){w.n(lt,{invite:0,repeatoverride:A.repeatoverride||i});q.g("i",lt.invite);lt.repeatoverride||t.Wa(e,1);t.ja(e)},0)}};w.f.prototype.zc=function(e,t){var n=this;e[t].css?w.Pa(B.la(O.site,"css_files")+e[t].css,"link",function(){n.Fc(e)}):setTimeout(function(){n.Fc(e)},100)};w.f.prototype.Fc=function(e){function t(t){n.aa(e,t)}var n=this,r=0,r={Za:{href:B.la(O.site,"image_files"),accepted:function(t){n.ja(e,t)},declined:t,qualified:function(t){n.Ta(e,t)},close:t}};lt.type=0;for(var i=new j.ha(r,e),s=e.invite?e.invite.hide:[],r=0;r<s.length;r++)I(h("#"+s[r]),{visibility:"hidden"});e.invite&&e.invite.hideFlash&&I(h("object, embed"),{visibility:"hidden"});i.Dd()};w.f.prototype.ja=function(e,t){w.f.kc.A(e,q.g());j.u.fireEvent("invite_accepted");if(t){lt[t]=t;q.g("l",t)}lt.invite=1;j.log("101");q.g("i",1);e.lock&&q.g("lk",1);this.Wa(e,0);j.j.F(j.j.r.ga);w.D&&(w.D.Ie()?w.D.Qe():w.D.Oe());this.ae(e);this.closed(e)};w.f.prototype.aa=function(e,t){w.f.mc.A(e,q.g());j.u.fireEvent("invite_declined");if(t){lt[t]=t;q.g("l",t)}lt.invite=-1;j.log("102");q.g("i",-1);this.Wa(e,1);w.D&&w.D.lb();this.closed(e)};w.f.prototype.closed=function(e){for(var t=e.invite?e.invite.hide:[],n=0;n<t.length;n++)I(h("#"+t[n]),{visibility:"visible"});e.invite&&e.invite.hideFlash&&I(h("object, embed"),{visibility:"visible"})};w.f.prototype.Ta=function(e,t){if(t){lt[t]=t;q.g("l",t)}lt.qualifier=1;j.log("301");this.ie(e)};w.f.prototype.Rd=function(e){lt.repeatoverride=e==1};w.f.prototype.ae=function(e){if(e.pop.when=="later"){if(!e.invite.isMDOT){e.pop.tracker&&this.yc(e);this.ea(e,"pop",this.vc);this.ea(e,"cancel",this.Ga);this.ea(e,"pause",this.pause)}}else if(e.pop.when=="now")this.xc(e);else if(e.pop.when=="both"){this.yc(e);this.Bb(e)}};w.f.prototype.xc=function(e){q.g("s",1);switch(e.pop.what){case"survey":this.Bb(e);break;case"qualifier":this.Yd(e);break;case"url":this.$d(e);break;case"script":this.Zd(e)}};w.f.prototype.ie=function(e){lt.canceled?this.tc(e):this.Bb(e)};w.f.prototype.uc=function(e,t){this.t(3)?this.Ic(e,t):this.xc(e)};w.f.prototype.Bb=function(e){w.f.Kc.A(e,q.g());var t=e.survey,n=e.pop;this.wc(j.hc(e,n.now),t.width,t.height,n.pu,"400")};w.f.prototype.Wd=function(e){var t=A.survey,n="feedback",r=lt.locale;e&&(n+="-"+e);r&&(n+="-"+r);this.wc(n,t.width,t.height,i,"600")};w.f.prototype.wc=function(e,t,n,r,i){var s=j.z.re,o=new Date-0+"_"+Math.round(Math.random()*1e13),u=B.hash(o),o=B.S({sid:e,cid:O.id,pattern:O.cs,a:o,b:u,c:w.Ca,version:O.version}),u=j.H.S(),e=j.u.S(j.u.gc("survey_shown")),s=w.Ia()+"//"+s.host+s.path+s.url+"?"+o+"&"+u;e&&e!=""&&(s=s+"&"+e);s=j.u.Bd(s);this.pop(i,s,(E.screen.width-t)/2,(E.screen.height-n)/2,t,n,r);j.log(i,O.cs)};w.f.prototype.yc=function(e){if(!this.t(3)){w.f.Nc.A(e,q.g());E.fsr$timer=setInterval(w.sa,1e3);this.Sa(e.tracker,n,"200")}};w.f.prototype.Yd=function(e){w.f.Cc.A(e,q.g());this.Sa(e.qualifier,e.pop.pu,"300",e.pop.now)};w.f.prototype.Xd=function(e){w.f.tb.A(e,q.g());q.l.write("fsr.p",w.K(),{path:"/",domain:O.site.domain});this.Sa(e.invite,i,"_self")};w.f.prototype.tc=function(e){this.Sa(e.cancel,i,"500")};w.f.prototype.vc=function(e,t){var r=n;if(!this.t(4)){w.J(t.t)&&(r=t.t());r&&!this.t(6)&&this.uc(e,t)}};w.f.prototype.Ga=function(e){if(!q.g("lk")&&this.t(3)){var t=E.open("","fsr200");if(t){w.f.Mc.A(e,q.g());t.close()}}};w.f.prototype.Ic=function(e,t){var n=this;if(z.B!="Firefox"||!e.qualifier.content)q.g("fo",t&&t.pu?2:1);else{this.Ga(e);setTimeout(function(){j.log("300",O.cs);n.zc(e,"qualifier")},(e.qualifier.delay||0)*1e3)}};w.f.prototype.Sa=function(e,t,n,r){this.page(e);var i=(E.screen.width-e.width)/2,s=(E.screen.height-e.height)/2,o=B.la(O.site,"html_files")+(e.url.pop||e.url),u={siteid:O.siteid,name:O.site.name,domain:O.site.domain};r&&(u.when=r);r=B.S(u);o+="?"+r;r=n;if(O.storageOption==="window"){r=G.parse(E.name);r.popOther=n;r=w.stringify(r)}this.pop(r,o,i,s,e.width,e.height,t);j.log(n,O.cs)};w.f.prototype.Ab=function(e,t){if(!this.t(2)){var n=this;t.sp&&(e.criteria.sp=t.sp);if(t.when||t.qualifier)e.pop.when=t.when;if(e.sv>0&&e.sv<=e.criteria.sp){lt.locale&&q.g("l",lt.locale);t.invite?this.Bc(e):setTimeout(function(){n.ja(e)},0)}}};w.f.prototype.$d=function(e){var t=A.survey.width,n=A.survey.height;this.pop("Other",e.pop.url,(E.screen.width-t)/2,(E.screen.height-n)/2,t,n)};w.f.prototype.Zd=function(e){w.Pa(e.pop.script,"script")};w.f.prototype.pause=function(e){!w.k(e)||e?w.Td():w.za()};w.f.prototype.pop=function(e,t,n,r,s,o,u){var a="",f=e;if(e!="_self"){f="fsr"+e;a="location=0,status=0,scrollbars=1,resizable=1,width="+s+",height="+o+",left="+n+",top="+r+",toolbar=0,menubar=0"}if(z.m=="Winphone")setTimeout(function(e){return function(){E.location=e}}(t),10);else if((e=E.open(t,f,a,i))&&u){e.blur();E.focus()}};w.f.prototype.language=function(){var e=A.language;if(e){lt.locale=e.locale;if(e.src){var n=lt.locale,r,i,s=e.type;switch(e.src){case"location":r=w.N(w.K());break;case"cookie":r=s&&s=="client"?q.l.O(e.name):q.g("lang");break;case"variable":w.C(e.name)||(e.name=[e.name]);for(i=0;i<e.name.length;i++){var o=new Function("return "+e.name[i]);if(s&&s=="client")try{r=o.call(E)}catch(u){r=t}else r=O[e.name];if(r)break}break;case"meta":(i=S.getElementsByName(e.name)).length!=0&&(r=i[0].content);break;case"navigator":r=navigator.browserLanguage||navigator.language;break;case"function":w.J(e.value)&&(r=e.value.call(E,e,this))}r=r||"";e=e.locales||[];s=0;for(o=e.length;s<o;s++){w.C(e[s].match)||(e[s].match=[e[s].match]);var a;i=0;for(var f=e[s].match.length;i<f;i++)if(a=r.match(e[s].match[i])){n=e[s].locale;break}if(a)break}lt.locale=n}}};w.f.prototype.page=function(e){var t=q.g("l");if(t)for(var n=e.locales||[],r=0,i=n.length;r<i;r++)if(n[r].locale==t){w.nb("url",n[r],e);w.nb("width",n[r],e);w.nb("height",n[r],e)}};w.f.prototype.Yb=function(e){var t=lt.locale;if(t)for(var n=e.locales||[],r=0,i=n.length;r<i;r++)if(n[r].locale==t){e.sp=n[r].sp;e.lf=n[r].lf;break}};w.f.prototype.td=function(e){for(var e=w.N(e||w.Ja()),t,n=r,s=["q","p","query"],o=0;o<s.length;o++)if(n=e.match(RegExp("[?&]"+s[o]+"=([^&]*)")))return i;if(!n)return t;(t=decodeURI(n[1]))&&(t=t.replace(/\+/g," "));return t};w.f.prototype.Wa=function(e,t){if(!lt.repeatoverride&&e.repeatdays&&e.repeatdays[t]){var n=new q.l(q.ba("fsr.r"),{path:"/",domain:O.site.domain,secure:O.site.secure,duration:e.repeatdays[t],encode:O.encode}),i=n.get();i.d=e.repeatdays[t];var s=A.events;if(s.pd){i.i=O.rid;var o=new Date;o.setDate(o.getDate()+s.pd);i.e=o.getTime();e.lock&&(i.s=e.idx)}n.reset(i);A.altcookie.name&&q.l.write(A.altcookie.name,A.altcookie.value,{path:A.altcookie.path,domain:A.altcookie.domain,secure:O.site.secure,duration:A.altcookie.persistent?e.repeatdays[t]:r});A.mode=="hybrid"&&(new _.G(w.n({Ra:{"do":1,rw:e.repeatdays[t]*1440}},j.z.domain))).na()}};w.f.prototype.fe=function(){var e=A.cpps;if(e)for(var s in e)if(e.hasOwnProperty(s)){var o=e[s],u="",a,f,l=o.mode,c=o.arg,h=l&&l=="append"?j.H.append:j.H.set;if(!o.url||w.N(w.K()).match(o.url)){if(o.pin)if(u=FSR.H.get(s)){for(var l=i,d=0,v=o.pin.length;d<v;d++)if(u===o.pin[d]){l=n;break}if(l)continue}switch(o.source.toLowerCase()){case"url":f=function(){var e=s,t,n=o.patterns||[],r=h;return function(){for(var i=0,s=n.length;i<s;i++)if(w.N(w.K()).match(n[i].regex)){t=n[i].value;break}t&&t!=""&&r(e,t,c)}};break;case"parameter":f=function(){var e=s,t=o.name,n=h,r;return function(){(r=B.sc(t))&&r!=""&&n(e,r,c)}};break;case"cookie":f=function(){var e=s,t=o.name,n=h;return function(){if((u=q.l.O(t))&&o.parameter){var r=o.parameter,r=r.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),r=RegExp(r+"=([^&#]*)").exec(u);u="";r&&(u=r[1])}u&&u!=""&&n(e,u,c)}};break;case"variable":f=function(){var e=s,n=o.name,u=h,a;return function(){try{a=(new Function("return "+n)).call(E);if(a===t||a===r)a=i}catch(s){a=i}a&&a!=""&&u(e,a,c)}};break;case"meta":f=function(){var e=s,t=o.name,n=h,r;return function(){(a=S.getElementsByName(t)).length!=0&&(r=a[0].content);r&&r!=""&&n(e,r,c)}};break;case"function":f=function(){var e=s,t=h,n,r=o;return function(){w.J(r.value)&&(n=r.value.call(E,s,r,O.controller));n&&n!=""&&t(e,n,c)}};break;case"static":f=function(){var e=s,t=h,n=o.value;return function(){n&&n!=""&&t(e,n,c)}}}o.on&&o.on!="load"&&o.query?W(o.query,o.on,f()):f()()}}};w.f.prototype.ee=function(e){var n=A.cpps;if(n)for(var r in n)if(n.hasOwnProperty(r)){var i=n[r];i.init&&j.H.set(r,i.init,t,e)}};w.f.ia=function(e,t,n,r){var i=q.g("ev")||{};if(r&&r!=""&&(!i["e"+t]||e.repeat)){i["e"+t]=(i["e"+t]||0)+1;j.log(n,r);q.g("ev",i)}};w.f.prototype.ge=function(){if(Math.abs(j.j.L)==j.j.r.ga){var e=A.events;if(e.custom){var n=0,s;for(s in e.custom)if(e.custom.hasOwnProperty(s)){var o=e.custom[s],u=e.codes[s];if(o.enabled){var a;switch(o.source.toLowerCase()){case"url":a=function(){var e=o,t=n,r=u,i=o.patterns||[],s;return function(){for(var n=0,o=i.length;n<o;n++)if(w.N(w.K()).match(i[n])){s=i[n];break}w.f.ia(e,t,r,s)}};break;case"parameter":a=function(){var e=o,t=n,r=o.name,i=u,s;return function(){s=B.sc(r);w.f.ia(e,t,i,s)}};break;case"cookie":a=function(){var e=o,t=n,r=o.name,i=u,s;return function(){s=q.l.O(r);w.f.ia(e,t,i,s)}};break;case"variable":a=function(){var e=o,s=n,a=o.name,f=u,l;return function(){try{l=(new Function("return "+a)).call(E);if(l===t||l===r)l=i}catch(n){l=i}w.f.ia(e,s,f,l)}};break;case"function":a=function(){var e=o,t=n,r=o.value,i=u,s;return function(){w.J(r)&&(s=r.call(E,e,o,O.controller));w.f.ia(e,t,i,s)}};break;case"static":a=function(){var e=o,t=n,r=o.value,i=u;return function(){w.f.ia(e,t,i,r)}}}o.on&&o.on!="load"&&o.query?W(o.query,o.on,a()):a()();n++}}}}};w.popNow=function(e){u(e,"now")};w.popLater=function(e){u(e,"later")};w.popImmediate=function(){u(100,"now")};w.popFeedback=function(e){var t=O.controller;t.execute(t.Wd,e)};w.clearTracker=function(){q.l.vb(q.ba("fsr.r"),{path:"/",domain:O.site.domain,secure:O.site.secure});q.l.vb(q.ba("fsr.s"),{path:"/",domain:O.site.domain,secure:O.site.secure})};w.stopTracker=function(e){O.controller.Ic(w._sd(),{pu:e})};w.run=function(){var e=O.controller;e.execute(e.Ec)};w.invite=function(e,t,r){var i=O.controller;i.execute(i.Ab,w._sd(),{sp:e,when:t,qualifier:r,invite:n})};w.popCancel=function(){O.controller.tc(w._sd())};w.showInvite=function(){O.controller.ma(w._sd())};w.close=function(){O.controller.Ga(w._sd())};w.pause=function(e){O.controller.pause(e)};w._sd=function(){return O.controller.Z};w._pd=function(){return O.controller.ya};w._cancel=function(){lt.canceled=n};w._override=function(e){O.controller.Rd(e)};w._language=function(e){if(e){lt[e]=e;q.g("l",e)}};w._qualify=function(e){lt.canceled=i;if(e){lt.qid=e;q.g("q",e)}};w.Cookie={};w.Cookie.read=function(e){return q.l.O(e)};w.Storage={};w.Storage.read=function(e){return q.g(e)};w.$S=lt;w.Ua(function(){j.j.Ma();if(j.j.L==j.j.r.V)w.Hc();else{(new w.f).load();W(E,"unload",function(){O.controller.ve()})}});w.f.Q={qb:{loaded:s(),initialized:s(),surveydefChanged:s(),inviteShown:s(),inviteAccepted:s(),inviteDeclined:s(),trackerShown:s(),trackerCanceled:s(),qualifierShown:s(),surveyShown:s()},W:{global:function(){return i},ma:function(){return i}},Ud:{windows:n,mac:n,linux:n,ipod:i,ipad:i,iphone:i,android:i,blackberry:i,winphone:i,kindle:i,nook:i,wince:i,mobile:i,other:i}}})(window,$$FSR)}({});$.getObject("Pb.Component.Navigation",!0).DetailBreadcrumbs=function(){function e(e){this.init(e)}var t={offsetElement:null,init:function(e){this.offsetElement=$("#offset");this.bindEvents()},bindEvents:function(){var e=$(document);e.on("Pb.Component.Filmstrip.Filmstrip::filmstrip_offset_update",$.proxy(this.updateOffset,this));e.on("Pb.Component.Detail.MediaManager::media_offset_update",$.proxy(this.updateOffset,this))},updateOffset:function(e){var t=e.currentOffset+1;this.offsetElement.text(t)}};$.extend(e.prototype,t);return e}();$.getObject("Pb",!0).DetailInit=function(){function e(e){var t=Pb.Data.get(Pb.Data.Shared.MEDIA).fullsizeUrl,n;n={mediaUrl:t,firstFetch:!0};Pb.Ajax.ajax({url:e,data:n,type:"get",success:$.proxy(function(e){var t=Pb.Data.get(Pb.Data.Shared.MEDIA),n=e.mediaData;Pb.Data.Shared.put(Pb.Data.Shared.MEDIA_SET,n,"",!1);var r=e.fetcherData.currentOffset;if(n.hasOwnProperty(r)){var i=Pb.Data.get(Pb.Data.Shared.MEDIA_SET)[r];i.placeHold=!1;i.fsWidth=t.fsWidth;i.fsHeight=t.fsHeight;i.rsWidth=t.rsWidth;i.rsHeight=t.rsWidth;i.thumbUrl=t.thumbUrl;i.fullsizeUrl=t.fullsizeUrl;Pb.Data.add(Pb.Data.Shared.MEDIA,i)}var s=$("#stotal");if(s.length>0){s.html(e.fetcherData.total);$(".breadcrumbNav .breadcrumb").css("visibility","visible")}var o=$.Event("Detail::first_batch_received",{currentOffset:r,fetcherData:e.fetcherData,filmStripData:e.filmStripData});$(document).trigger(o)},this)})}function t(){new Pb.Component.Common.Comments({commentTarget:Pb.Data.Shared.get(Pb.Data.Shared.MEDIA)});var e=$.Event("Pb.Component.Detail.Detail::current_media_update",{newTarget:Pb.Data.get(Pb.Data.Shared.MEDIA)});$(document).trigger(e)}return{init:e,initPrivate:t}}();$.getObject("Pb.Component.Detail",!0).Fetcher=function(){function e(e){this.init(e)}var t={libData:null,offset:null,prevOffset:null,total:null,direction:null,context:null,filters:null,init:function(e){this.offset=e.currentOffset;this.prevOffset=this.offset;this.total=e.total;this.context=e.context;this.query=e.query;Pb.Data.add("detailQuery",this.query);this.libData=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET);this.setLibDataMinMax();this.bindEvents()},setLibDataMinMax:function(){var e=0,t,n,r;for(r in this.libData)if(this.libData.hasOwnProperty(r)){if(r==="pbdkey")continue;e===0&&(t=parseInt(r,10));n=parseInt(r,10);e++}Pb.Data.add("libDataMin",t);Pb.Data.add("libDataMax",n)},bindEvents:function(){$(document).on("Pb.Component.Filmstrip.Filmstrip::filmstrip_slide_update",$.proxy(this.handleSlideUpdate,this));$(document).on("Pb.Component.Detail.MediaManager::media_manager_update",$.proxy(this.handleSlideUpdate,this));$(document).on("Pb.Component.RecentUploads.RecentUploadsDetailManager::recentuploads_update",$.proxy(this.handleSlideUpdate,this))},handleSlideUpdate:function(e){var t=Pb.Data.get("libDataMin"),n=Pb.Data.get("libDataMax");e.dir===-1&&e.startOffset!==0&&t!==0?this.fetchMore(e):e.dir===1&&e.startOffset!==this.total&&n!==this.total&&this.fetchMore(e)},fetchMore:function(e){var t="/component/Detail-"+this.context,n=e.dir,r,i;t+="?"+this.query;e.startOffset?r=e.startOffset:r=n===-1?Pb.Data.get("libDataMin"):Pb.Data.get("libDataMax");i={offset:r,dir:n};Pb.Ajax.ajax({url:t,data:i,type:"get",success:$.proxy(function(e){var t,i;n===-1?t=this.prependToData(e):t=this.appendToData(e);Pb.Data.Shared.put(Pb.Data.Shared.MEDIA_SET,t,"",!1);this.libData=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET);this.setLibDataMinMax();i=$.Event("Pb.Component.Detail.Fetcher::libdata_update",{dir:n,offset:r});$(document).trigger(i)},this)})},prependToData:function(e){var t=$.extend(e,this.libData);return t},appendToData:function(e){var t=$.extend(this.libData,e);return t}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Detail",!0).Detail=function(){function e(e){this.init(e)}var t={oldData:null,currentData:null,currentOffset:null,context:null,linkCodesInited:!1,profilePic:null,profileOwnerName:null,profileLink:null,likeCnt:null,viewCnt:null,commentCnt:null,linksHeading:null,description:null,profilePicUrl:"/component/Common-ProfilePic-ProfilePic",init:function(e){this.currentData=Pb.Data.get(Pb.Data.Shared.MEDIA);this.onView();typeof e.currentIndex!="undefined"&&(this.currentOffset=parseInt(e.currentIndex,10));e.context&&(this.context=e.context);this.updatePageState();this.getUpdateableElements();this.attachSharedKey();this.bindEvents();Pb.Component.Ad.AdRefresh.initMediaDetail();$("#linksHelp").tooltip({placement:"left",delay:{show:300,hide:100}})},updatePageState:function(){var e={offset:this.currentOffset},t=document.location.href,n=t.indexOf("?")!==-1?document.location.href.slice(window.location.href.indexOf("?")):"",r=this.currentData.linkUrl+n;$(document).trigger($.Event("HistoryManager::updatePageHistory",{replace:!0,state:e,url:r,title:$("title").text()}))},getUpdateableElements:function(){this.profilePic=$(".profileWrapper img.avatar");this.profileOwnerName=$("#profileOwnerName");this.profileLink=this.profileOwnerName.parent();this.likeCnt=$("#likeCount");this.viewCnt=$("#viewCount");this.commentCnt=$("#commentCount");this.linksHeading=$(".sidebar div.linkcodes").parent().find(".accordion-heading a");var e=$(".mediaDescription"),t=e.find("span.editable-field").first();t.length>0?this.description=t:this.description=e},attachSharedKey:function(){Pb.Data.Shared.attach($(".detailWrapper"),Pb.Data.Shared.MEDIA)},bindEvents:function(){var e=$(document);e.on("Pb.Component.Filmstrip.Filmstrip::filmstrip_offset_update",$.proxy(this.handleCurrentMediaUpdate,this));e.on("Pb.Component.Detail.MediaManager::media_offset_update",$.proxy(this.handleCurrentMediaUpdate,this));e.on("Pb.Component.RecentUploads.RecentUploadsDetailManager::recentuploads_offset_update",$.proxy(this.handleCurrentMediaUpdate,this));e.on("Pb.Component.Detail.Detail::current_media_update",$.proxy(this.updatePageElements,this));History.Adapter.bind(window,"statechange",$.proxy(this.checkHistory,this));this.bindDescription();e.on("click",".comment-post",function(){Pb.Track.tr("detailpage_comment_post_click")})},bindDescription:function(){var e=this;this.mediaDesc=$(".mediaDescription .editable-field").first();this.mediaDesc.length>0&&this.mediaDesc.editInPlace({callback:function(t,n,r){e.saveDescription(n,r);n===""&&(n="Click to add description");return n},show_buttons:!0,save_button:'<button class="btn btn-small btn-primary inplace_save icon-ok"></button>',cancel_button:'<button class="btn btn-small inplace_cancel icon-remove"></button>',default_text:"Click to add description",field_type:"textarea",pb_track:function(){Pb.Track.tr("detailpage_description_click")},pb_validation:function(e,t){var n=!0;e=$.trim(e);if(e.length>2048){var r={status:0,message:"Description cannot be more than 2048 characters",details:""};Pb.Component.Element.Message.show(r);n=!1}return n}})},checkHistory:function(){var e,t,n=History.getState();if(typeof n!="object")return;e=n.data.offset;if(typeof e!="undefined"&&this.currentOffset!==e){t=$("#thumb_"+e).find("a");if(t.length>0)t.trigger("click",["prevnextclick"]);else{var r={};r.oldOffset=this.currentOffset;r.currentOffset=e;this.handleCurrentMediaUpdate(r)}}},handleCurrentMediaUpdate:function(e){var t=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET);this.oldData=t[e.oldOffset];this.currentData=t[e.currentOffset];this.currentOffset=e.currentOffset;Pb.Data.Shared.put(Pb.Data.Shared.MEDIA,this.currentData);var n={offset:e.currentOffset},r,i,s,o=$.browser,u=this.currentData.mediaType==="image"?"photo":this.currentData.mediaType,a=this.currentData.title.length>0?this.currentData.title:this.currentData.name;if(o.msie&&parseInt(o.version,10)===8){r=document.location.href.slice(window.location.href.indexOf("#")+1);i=r.indexOf("?");s=r.indexOf("&_suid");r=r.substring(i,s)}else{r=document.location.href.slice(window.location.href.indexOf("#")+1);i=r.indexOf("?");r=i!==-1?r.substring(i):""}r=r.replace("o="+e.oldOffset,"o="+e.currentOffset);$(document).trigger($.Event("HistoryManager::updatePageHistory",{state:n,url:this.currentData.linkUrl+r,title:a+" "+u+" by "+this.currentData.ownername}));var f=$.Event("Pb.Component.Detail.Detail::current_media_update");f.newTarget=this.currentData;$(document).trigger(f);Pb.Data.has("featureTrackingKey")&&Pb.Track.tr("detail_page_"+Pb.Data.get("featureTrackingKey")+"_view");Pb.Track.tr("detail_page_view");Pb.Track.trf("detail_pagination_click");Pb.Track.trl("media_detail_views");Pb.PageTracker.trackPageView()},updatePageElements:function(){this.updateStats();this.updateProfile();this.updateLinkCodes();this.updateDescription();this.updateFollowButton();setTimeout($.proxy(this.onView,this))},updateLinkCodes:function(){if(!this.linkCodesInited){$(".link-container").empty();var e=new Pb.Component.Common.Links.LinkCodes({selector:".link-container",prefix:"linksModule"});this.linkCodesInited=!0}$(".link-container").trigger({type:"Pb.Component.Common.Links.LinkCodes::refresh",objectData:this.currentData});var t=this.currentData.mediaType;t=t.charAt(0).toUpperCase()+t.slice(1);this.linksHeading.text(t+" Links")},updateStats:function(){this.likeCnt.html(this.currentData.likeCount);this.commentCnt.html(this.currentData.commentCount);this.viewCnt.html(this.currentData.viewCount)},updateProfile:function(){if(this.profileOwnerName.text()!==this.currentData.ownername){this.updateProfilePic();this.profileOwnerName.html(this.currentData.ownername);this.profileLink.attr("href",this.currentData.ownerprofilelink)}},updateProfilePic:function(){if(!this.currentData.profilePicUrl){var e={url:this.profilePicUrl,type:"GET",data:{username:this.currentData.ownername,json:1},success:$.proxy(function(e){if(e.url){this.currentData.profilePicUrl=e.url;this.profilePic.attr("src",e.url)}},this)};Pb.Ajax.ajax(e)}else this.profilePic.attr("src",this.currentData.profilePicUrl)},updateDescription:function(){var e=this.description.find(".inplace_cancel");e.length>0&&e.trigger("click");var t=this.currentData.description?this.currentData.description:this.currentData.io?"Click to add description":"";this.description.text(t);this.currentData.io&&this.bindDescription()},updateFollowButton:function(){var e=$("a.follow");if(e.length>0){var t=Pb.Data.Shared.getData(Pb.Data.Shared.LOGGED_IN_USER_DATA),n=this.currentData.ownername;e.attr("data-followee",n);if(t){var r=t.username;n===r?e.hide():e.show()}}},onView:function(){if(!this.currentData.isPersisted)return;var e="/action/media/onView",t={mediaUrl:this.currentData.fullsizeUrl};Pb.Ajax.ajax({url:e,data:t,success:$.proxy(function(e){return e.status===1?!0:!1},this)})},saveDescription:function(e,t){var n="/action/media/updateDescription",r={description:e,mediaUrl:this.currentData.fullsizeUrl};Pb.Component.Ad.AdRefresh.reloadAds();Pb.Ajax.ajax({url:n,data:r,success:$.proxy(function(e){if(e.status===1){this.currentData.description=e.data.description;this.currentData.isPersisted=!0;return!0}return!1},this)})}};$.extend(e.prototype,t);return e}();$.getObject("Pb",!0).ClientImagePreloader=function(){function e(e){this.init(e)}var t={pb_loadContainer:null,pb_dims:{},totalCount:0,completedCount:0,completedEventName:null,memo:null,init:function(e){},preLoad:function(e,t,n){this.totalCount=t.length;this.completedEventName=e;this.pb_dims[this.completedEventName]={};n&&(this.memo=n);this.checkPreloadContainer();var r=this;for(var i=0;i<t.length;i++){var s=$('<img id="preload_'+(e+i)+'" src="'+t[i]+'" />');this.pb_loadContainer.append(s);if(s[0].complete)this.handlePreLoadedImage(s);else{s[0].onload=function(){s=$(this);r.handlePreLoadedImage(s)};s[0].onerror=function(){s=$(this);r.handleImageLoadError(s)}}}},handlePreLoadedImage:function(e){if(this.completedCount===this.totalCount)return;var t={width:e.width(),height:e.height()},n=e.attr("src");this.pb_dims[this.completedEventName][n]=t;this.completedCount++;this.checkComplete()},handleImageLoadError:function(e){if(this.completedCount===this.totalCount)return;var t={width:0,height:0};this.pb_dims[this.completedEventName][e.attr("src")]=t;this.completedCount++;this.checkComplete()},checkComplete:function(){if(this.completedCount==this.totalCount){var e=$.Event(this.completedEventName);e.dimensions=this.pb_dims[this.completedEventName];this.memo&&(e.memo=this.memo);$(document).trigger(e)}},get:function(e){return this.pb_dims[this.completedEventName][e]},checkPreloadContainer:function(){this.pb_loadContainer=$("#pbPreload");if(this.pb_loadContainer.length===0){$("body").append('<div id="pbPreload" style="overflow:hidden; position:absolute; width: 1px; height: 0px; top: -10px; left: -10px;"></div>');this.pb_loadContainer=$("#pbPreload")}}};$.extend(e.prototype,t);return e}();$.getObject("Pb",!0).ClientImageRescaler=function(){function e(e){this.init(e)}var t={maxWidth:null,maxHeight:null,init:function(e){if(e){e.width&&(this.maxWidth=e.width);e.height&&(this.maxHeight=e.height)}},setMaxWidth:function(e){this.maxWidth=e},setMaxHeight:function(e){this.maxHeight=e},rescale:function(e){var t=e.width,n=e.height;if(t>this.maxWidth){n=this.maxWidth*n/t;t=this.maxWidth}if(n>this.maxHeight){t=t/n*this.maxHeight;n=this.maxHeight}return{width:t,height:n}}};$.extend(e.prototype,t);return e}();(function(e,t){"use strict";var n=e.History=e.History||{},r=e.jQuery;if(typeof n.Adapter!="undefined")throw new Error("History.js Adapter has already been loaded...");n.Adapter={bind:function(e,t,n){r(e).bind(t,n)},trigger:function(e,t,n){r(e).trigger(t,n)},extractEventData:function(e,n,r){var i=n&&n.originalEvent&&n.originalEvent[e]||r&&r[e]||t;return i},onDomLoad:function(e){r(e)}};typeof n.init!="undefined"&&n.init()})(window);(function(e,t){"use strict";var n=e.document,r=e.setTimeout||r,i=e.clearTimeout||i,s=e.setInterval||s,o=e.History=e.History||{};if(typeof o.initHtml4!="undefined")throw new Error("History.js HTML4 Support has already been loaded...");o.initHtml4=function(){if(typeof o.initHtml4.initialized!="undefined")return!1;o.initHtml4.initialized=!0;o.enabled=!0;o.savedHashes=[];o.isLastHash=function(e){var t=o.getHashByIndex(),n;n=e===t;return n};o.saveHash=function(e){if(o.isLastHash(e))return!1;o.savedHashes.push(e);return!0};o.getHashByIndex=function(e){var t=null;typeof e=="undefined"?t=o.savedHashes[o.savedHashes.length-1]:e<0?t=o.savedHashes[o.savedHashes.length+e]:t=o.savedHashes[e];return t};o.discardedHashes={};o.discardedStates={};o.discardState=function(e,t,n){var r=o.getHashByState(e),i;i={discardedState:e,backState:n,forwardState:t};o.discardedStates[r]=i;return!0};o.discardHash=function(e,t,n){var r={discardedHash:e,backState:n,forwardState:t};o.discardedHashes[e]=r;return!0};o.discardedState=function(e){var t=o.getHashByState(e),n;n=o.discardedStates[t]||!1;return n};o.discardedHash=function(e){var t=o.discardedHashes[e]||!1;return t};o.recycleState=function(e){var t=o.getHashByState(e);o.discardedState(e)&&delete o.discardedStates[t];return!0};if(o.emulated.hashChange){o.hashChangeInit=function(){o.checkerFunction=null;var t="",r,i,u,a;if(o.isInternetExplorer()){r="historyjs-iframe";i=n.createElement("iframe");i.setAttribute("id",r);i.style.display="none";n.body.appendChild(i);i.contentWindow.document.open();i.contentWindow.document.close();u="";a=!1;o.checkerFunction=function(){if(a)return!1;a=!0;var n=o.getHash()||"",r=o.unescapeHash(i.contentWindow.document.location.hash)||"";if(n!==t){t=n;if(r!==n){u=r=n;i.contentWindow.document.open();i.contentWindow.document.close();i.contentWindow.document.location.hash=o.escapeHash(n)}o.Adapter.trigger(e,"hashchange")}else if(r!==u){u=r;o.setHash(r,!1)}a=!1;return!0}}else o.checkerFunction=function(){var n=o.getHash();if(n!==t){t=n;o.Adapter.trigger(e,"hashchange")}return!0};o.intervalList.push(s(o.checkerFunction,o.options.hashChangeInterval));return!0};o.Adapter.onDomLoad(o.hashChangeInit)}if(o.emulated.pushState){o.onHashChange=function(t){var r=t&&t.newURL||n.location.href,i=o.getHashByUrl(r),s=null,u=null,a=null,f;if(o.isLastHash(i)){o.busy(!1);return!1}o.doubleCheckComplete();o.saveHash(i);if(i&&o.isTraditionalAnchor(i)){o.Adapter.trigger(e,"anchorchange");o.busy(!1);return!1}s=o.extractState(o.getFullUrl(i||n.location.href,!1),!0);if(o.isLastSavedState(s)){o.busy(!1);return!1}u=o.getHashByState(s);f=o.discardedState(s);if(f){o.getHashByIndex(-2)===o.getHashByState(f.forwardState)?o.back(!1):o.forward(!1);return!1}o.pushState(s.data,s.title,s.url,!1);return!0};o.Adapter.bind(e,"hashchange",o.onHashChange);o.pushState=function(t,r,i,s){if(o.getHashByUrl(i))throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(s!==!1&&o.busy()){o.pushQueue({scope:o,callback:o.pushState,args:arguments,queue:s});return!1}o.busy(!0);var u=o.createStateObject(t,r,i),a=o.getHashByState(u),f=o.getState(!1),l=o.getHashByState(f),c=o.getHash();o.storeState(u);o.expectedStateId=u.id;o.recycleState(u);o.setTitle(u);if(a===l){o.busy(!1);return!1}if(a!==c&&a!==o.getShortUrl(n.location.href)){o.setHash(a,!1);return!1}o.saveState(u);o.Adapter.trigger(e,"statechange");o.busy(!1);return!0};o.replaceState=function(e,t,n,r){if(o.getHashByUrl(n))throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(r!==!1&&o.busy()){o.pushQueue({scope:o,callback:o.replaceState,args:arguments,queue:r});return!1}o.busy(!0);var i=o.createStateObject(e,t,n),s=o.getState(!1),u=o.getStateByIndex(-2);o.discardState(s,i,u);o.pushState(i.data,i.title,i.url,!1);return!0}}o.emulated.pushState&&o.getHash()&&!o.emulated.hashChange&&o.Adapter.onDomLoad(function(){o.Adapter.trigger(e,"hashchange")})};typeof o.init!="undefined"&&o.init()})(window);(function(e,t){"use strict";var n=e.console||t,r=e.document,i=e.navigator,s=e.sessionStorage||!1,o=e.setTimeout,u=e.clearTimeout,a=e.setInterval,f=e.clearInterval,l=e.JSON,c=e.alert,h=e.History=e.History||{},p=e.history;l.stringify=l.stringify||l.encode;l.parse=l.parse||l.decode;if(typeof h.init!="undefined")throw new Error("History.js Core has already been loaded...");h.init=function(){if(typeof h.Adapter=="undefined")return!1;typeof h.initCore!="undefined"&&h.initCore();typeof h.initHtml4!="undefined"&&h.initHtml4();return!0};h.initCore=function(){if(typeof h.initCore.initialized!="undefined")return!1;h.initCore.initialized=!0;h.options=h.options||{};h.options.hashChangeInterval=h.options.hashChangeInterval||100;h.options.safariPollInterval=h.options.safariPollInterval||500;h.options.doubleCheckInterval=h.options.doubleCheckInterval||500;h.options.storeInterval=h.options.storeInterval||1e3;h.options.busyDelay=h.options.busyDelay||250;h.options.debug=h.options.debug||!1;h.options.initialTitle=h.options.initialTitle||r.title;h.intervalList=[];h.clearAllIntervals=function(){var e,t=h.intervalList;if(typeof t!="undefined"&&t!==null){for(e=0;e<t.length;e++)f(t[e]);h.intervalList=null}};h.debug=function(){(h.options.debug||!1)&&h.log.apply(h,arguments)};h.log=function(){var e=typeof n!="undefined"&&typeof n.log!="undefined"&&typeof n.log.apply!="undefined",t=r.getElementById("log"),i,s,o,u,a;if(e){u=Array.prototype.slice.call(arguments);i=u.shift();typeof n.debug!="undefined"?n.debug.apply(n,[i,u]):n.log.apply(n,[i,u])}else i="\n"+arguments[0]+"\n";for(s=1,o=arguments.length;s<o;++s){a=arguments[s];if(typeof a=="object"&&typeof l!="undefined")try{a=l.stringify(a)}catch(f){}i+="\n"+a+"\n"}if(t){t.value+=i+"\n-----\n";t.scrollTop=t.scrollHeight-t.clientHeight}else e||c(i);return!0};h.getInternetExplorerMajorVersion=function(){var e=h.getInternetExplorerMajorVersion.cached=typeof h.getInternetExplorerMajorVersion.cached!="undefined"?h.getInternetExplorerMajorVersion.cached:function(){var e=3,t=r.createElement("div"),n=t.getElementsByTagName("i");while((t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->")&&n[0]);return e>4?e:!1}();return e};h.isInternetExplorer=function(){var e=h.isInternetExplorer.cached=typeof h.isInternetExplorer.cached!="undefined"?h.isInternetExplorer.cached:Boolean(h.getInternetExplorerMajorVersion());return e};h.emulated={pushState:!Boolean(e.history&&e.history.pushState&&e.history.replaceState&&!/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(i.userAgent)&&!/AppleWebKit\/5([0-2]|3[0-2])/i.test(i.userAgent)),hashChange:Boolean(!("onhashchange"in e||"onhashchange"in r)||h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<8)};h.enabled=!h.emulated.pushState;h.bugs={setHash:Boolean(!h.emulated.pushState&&i.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(i.userAgent)),safariPoll:Boolean(!h.emulated.pushState&&i.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(i.userAgent)),ieDoubleCheck:Boolean(h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<7)};h.isEmptyObject=function(e){for(var t in e)return!1;return!0};h.cloneObject=function(e){var t,n;if(e){t=l.stringify(e);n=l.parse(t)}else n={};return n};h.getRootUrl=function(){var e=r.location.protocol+"//"+(r.location.hostname||r.location.host);if(r.location.port||!1)e+=":"+r.location.port;e+="/";return e};h.getBaseHref=function(){var e=r.getElementsByTagName("base"),t=null,n="";if(e.length===1){t=e[0];n=t.href.replace(/[^\/]+$/,"")}n=n.replace(/\/+$/,"");n&&(n+="/");return n};h.getBaseUrl=function(){var e=h.getBaseHref()||h.getBasePageUrl()||h.getRootUrl();return e};h.getPageUrl=function(){var e=h.getState(!1,!1),t=(e||{}).url||r.location.href,n;n=t.replace(/\/+$/,"").replace(/[^\/]+$/,function(e,t,n){return/\./.test(e)?e:e+"/"});return n};h.getBasePageUrl=function(){var e=r.location.href.replace(/[#\?].*/,"").replace(/[^\/]+$/,function(e,t,n){return/[^\/]$/.test(e)?"":e}).replace(/\/+$/,"")+"/";return e};h.getFullUrl=function(e,t){var n=e,r=e.substring(0,1);t=typeof t=="undefined"?!0:t;/[a-z]+\:\/\//.test(e)||(r==="/"?n=h.getRootUrl()+e.replace(/^\/+/,""):r==="#"?n=h.getPageUrl().replace(/#.*/,"")+e:r==="?"?n=h.getPageUrl().replace(/[\?#].*/,"")+e:t?n=h.getBaseUrl()+e.replace(/^(\.\/)+/,""):n=h.getBasePageUrl()+e.replace(/^(\.\/)+/,""));return n.replace(/\#$/,"")};h.getShortUrl=function(e){var t=e,n=h.getBaseUrl(),r=h.getRootUrl();t=t.replace(r,"/");h.isTraditionalAnchor(t)&&(t="./"+t);t=t.replace(/^(\.\/)+/g,"./").replace(/\#$/,"");return t};h.store={};h.idToState=h.idToState||{};h.stateToId=h.stateToId||{};h.urlToId=h.urlToId||{};h.storedStates=h.storedStates||[];h.savedStates=h.savedStates||[];h.normalizeStore=function(){h.store.idToState=h.store.idToState||{};h.store.urlToId=h.store.urlToId||{};h.store.stateToId=h.store.stateToId||{}};h.getState=function(e,t){typeof e=="undefined"&&(e=!0);typeof t=="undefined"&&(t=!0);var n=h.getLastSavedState();!n&&t&&(n=h.createStateObject());if(e){n=h.cloneObject(n);n.url=n.cleanUrl||n.url}return n};h.getIdByState=function(e){var t=h.extractId(e.url),n;if(!t){n=h.getStateString(e);if(typeof h.stateToId[n]!="undefined")t=h.stateToId[n];else if(typeof h.store.stateToId[n]!="undefined")t=h.store.stateToId[n];else{for(;;){t=(new Date).getTime()+String(Math.random()).replace(/\D/g,"");if(typeof h.idToState[t]=="undefined"&&typeof h.store.idToState[t]=="undefined")break}h.stateToId[n]=t;h.idToState[t]=e}}return t};h.normalizeState=function(e){var t,n;if(!e||typeof e!="object")e={};if(typeof e.normalized!="undefined")return e;if(!e.data||typeof e.data!="object")e.data={};t={};t.normalized=!0;t.title=e.title||"";t.url=h.getFullUrl(h.unescapeString(e.url||r.location.href));t.hash=h.getShortUrl(t.url);t.data=h.cloneObject(e.data);t.id=h.getIdByState(t);t.cleanUrl=t.url.replace(/\??\&_suid.*/,"");t.url=t.cleanUrl;n=!h.isEmptyObject(t.data);if(t.title||n){t.hash=h.getShortUrl(t.url).replace(/\??\&_suid.*/,"");/\?/.test(t.hash)||(t.hash+="?");t.hash+="&_suid="+t.id}t.hashedUrl=h.getFullUrl(t.hash);(h.emulated.pushState||h.bugs.safariPoll)&&h.hasUrlDuplicate(t)&&(t.url=t.hashedUrl);return t};h.createStateObject=function(e,t,n){var r={data:e,title:t,url:n};r=h.normalizeState(r);return r};h.getStateById=function(e){e=String(e);var n=h.idToState[e]||h.store.idToState[e]||t;return n};h.getStateString=function(e){var t,n,r;t=h.normalizeState(e);n={data:t.data,title:e.title,url:e.url};r=l.stringify(n);return r};h.getStateId=function(e){var t,n;t=h.normalizeState(e);n=t.id;return n};h.getHashByState=function(e){var t,n;t=h.normalizeState(e);n=t.hash;return n};h.extractId=function(e){var t,n,r;n=/(.*)\&_suid=([0-9]+)$/.exec(e);r=n?n[1]||e:e;t=n?String(n[2]||""):"";return t||!1};h.isTraditionalAnchor=function(e){var t=!/[\/\?\.]/.test(e);return t};h.extractState=function(e,t){var n=null,r,i;t=t||!1;r=h.extractId(e);r&&(n=h.getStateById(r));if(!n){i=h.getFullUrl(e);r=h.getIdByUrl(i)||!1;r&&(n=h.getStateById(r));!n&&t&&!h.isTraditionalAnchor(e)&&(n=h.createStateObject(null,null,i))}return n};h.getIdByUrl=function(e){var n=h.urlToId[e]||h.store.urlToId[e]||t;return n};h.getLastSavedState=function(){return h.savedStates[h.savedStates.length-1]||t};h.getLastStoredState=function(){return h.storedStates[h.storedStates.length-1]||t};h.hasUrlDuplicate=function(e){var t=!1,n;n=h.extractState(e.url);t=n&&n.id!==e.id;return t};h.storeState=function(e){h.urlToId[e.url]=e.id;h.storedStates.push(h.cloneObject(e));return e};h.isLastSavedState=function(e){var t=!1,n,r,i;if(h.savedStates.length){n=e.id;r=h.getLastSavedState();i=r.id;t=n===i}return t};h.saveState=function(e){if(h.isLastSavedState(e))return!1;h.savedStates.push(h.cloneObject(e));return!0};h.getStateByIndex=function(e){var t=null;typeof e=="undefined"?t=h.savedStates[h.savedStates.length-1]:e<0?t=h.savedStates[h.savedStates.length+e]:t=h.savedStates[e];return t};h.getHash=function(){var e=h.unescapeHash(r.location.hash);return e};h.unescapeString=function(t){var n=t,r;for(;;){r=e.unescape(n);if(r===n)break;n=r}return n};h.unescapeHash=function(e){var t=h.normalizeHash(e);t=h.unescapeString(t);return t};h.normalizeHash=function(e){var t=e.replace(/[^#]*#/,"").replace(/#.*/,"");return t};h.setHash=function(e,t){var n,i,s;if(t!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.setHash,args:arguments,queue:t});return!1}n=h.escapeHash(e);h.busy(!0);i=h.extractState(e,!0);if(i&&!h.emulated.pushState)h.pushState(i.data,i.title,i.url,!1);else if(r.location.hash!==n)if(h.bugs.setHash){s=h.getPageUrl();h.pushState(null,null,s+"#"+n,!1)}else r.location.hash=n;return h};h.escapeHash=function(t){var n=h.normalizeHash(t);n=e.escape(n);h.bugs.hashEscape||(n=n.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?"));return n};h.getHashByUrl=function(e){var t=String(e).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");t=h.unescapeHash(t);return t};h.setTitle=function(e){var t=e.title,n;if(!t){n=h.getStateByIndex(0);n&&n.url===e.url&&(t=n.title||h.options.initialTitle)}try{r.getElementsByTagName("title")[0].innerHTML=t.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(i){}r.title=t;return h};h.queues=[];h.busy=function(e){typeof e!="undefined"?h.busy.flag=e:typeof h.busy.flag=="undefined"&&(h.busy.flag=!1);if(!h.busy.flag){u(h.busy.timeout);var t=function(){var e,n,r;if(h.busy.flag)return;for(e=h.queues.length-1;e>=0;--e){n=h.queues[e];if(n.length===0)continue;r=n.shift();h.fireQueueItem(r);h.busy.timeout=o(t,h.options.busyDelay)}};h.busy.timeout=o(t,h.options.busyDelay)}return h.busy.flag};h.busy.flag=!1;h.fireQueueItem=function(e){return e.callback.apply(e.scope||h,e.args||[])};h.pushQueue=function(e){h.queues[e.queue||0]=h.queues[e.queue||0]||[];h.queues[e.queue||0].push(e);return h};h.queue=function(e,t){typeof e=="function"&&(e={callback:e});typeof t!="undefined"&&(e.queue=t);h.busy()?h.pushQueue(e):h.fireQueueItem(e);return h};h.clearQueue=function(){h.busy.flag=!1;h.queues=[];return h};h.stateChanged=!1;h.doubleChecker=!1;h.doubleCheckComplete=function(){h.stateChanged=!0;h.doubleCheckClear();return h};h.doubleCheckClear=function(){if(h.doubleChecker){u(h.doubleChecker);h.doubleChecker=!1}return h};h.doubleCheck=function(e){h.stateChanged=!1;h.doubleCheckClear();h.bugs.ieDoubleCheck&&(h.doubleChecker=o(function(){h.doubleCheckClear();h.stateChanged||e();return!0},h.options.doubleCheckInterval));return h};h.safariStatePoll=function(){var t=h.extractState(r.location.href),n;if(!h.isLastSavedState(t)){n=t;n||(n=h.createStateObject());h.Adapter.trigger(e,"popstate");return h}return};h.back=function(e){if(e!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.back,args:arguments,queue:e});return!1}h.busy(!0);h.doubleCheck(function(){h.back(!1)});p.go(-1);return!0};h.forward=function(e){if(e!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.forward,args:arguments,queue:e});return!1}h.busy(!0);h.doubleCheck(function(){h.forward(!1)});p.go(1);return!0};h.go=function(e,t){var n;if(e>0)for(n=1;n<=e;++n)h.forward(t);else{if(!(e<0))throw new Error("History.go: History.go requires a positive or negative integer passed.");for(n=-1;n>=e;--n)h.back(t)}return h};if(h.emulated.pushState){var d=function(){};h.pushState=h.pushState||d;h.replaceState=h.replaceState||d}else{h.onPopState=function(t,n){var i=!1,s=!1,o,u;h.doubleCheckComplete();o=h.getHash();if(o){u=h.extractState(o||r.location.href,!0);if(u)h.replaceState(u.data,u.title,u.url,!1);else{h.Adapter.trigger(e,"anchorchange");h.busy(!1)}h.expectedStateId=!1;return!1}i=h.Adapter.extractEventData("state",t,n)||!1;i?s=h.getStateById(i):h.expectedStateId?s=h.getStateById(h.expectedStateId):s=h.extractState(r.location.href);s||(s=h.createStateObject(null,null,r.location.href));h.expectedStateId=!1;if(h.isLastSavedState(s)){h.busy(!1);return!1}h.storeState(s);h.saveState(s);h.setTitle(s);h.Adapter.trigger(e,"statechange");h.busy(!1);return!0};h.Adapter.bind(e,"popstate",h.onPopState);h.pushState=function(t,n,r,i){if(h.getHashByUrl(r)&&h.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(i!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.pushState,args:arguments,queue:i});return!1}h.busy(!0);var s=h.createStateObject(t,n,r);if(h.isLastSavedState(s))h.busy(!1);else{h.storeState(s);h.expectedStateId=s.id;p.pushState(s.id,s.title,s.url);h.Adapter.trigger(e,"popstate")}return!0};h.replaceState=function(t,n,r,i){if(h.getHashByUrl(r)&&h.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(i!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.replaceState,args:arguments,queue:i});return!1}h.busy(!0);var s=h.createStateObject(t,n,r);if(h.isLastSavedState(s))h.busy(!1);else{h.storeState(s);h.expectedStateId=s.id;p.replaceState(s.id,s.title,s.url);h.Adapter.trigger(e,"popstate")}return!0}}if(s){try{h.store=l.parse(s.getItem("History.store"))||{}}catch(v){h.store={}}h.normalizeStore()}else{h.store={};h.normalizeStore()}h.Adapter.bind(e,"beforeunload",h.clearAllIntervals);h.Adapter.bind(e,"unload",h.clearAllIntervals);h.saveState(h.storeState(h.extractState(r.location.href,!0)));if(s){h.onUnload=function(){var e,t;try{e=l.parse(s.getItem("History.store"))||{}}catch(n){e={}}e.idToState=e.idToState||{};e.urlToId=e.urlToId||{};e.stateToId=e.stateToId||{};for(t in h.idToState){if(!h.idToState.hasOwnProperty(t))continue;e.idToState[t]=h.idToState[t]}for(t in h.urlToId){if(!h.urlToId.hasOwnProperty(t))continue;e.urlToId[t]=h.urlToId[t]}for(t in h.stateToId){if(!h.stateToId.hasOwnProperty(t))continue;e.stateToId[t]=h.stateToId[t]}h.store=e;h.normalizeStore();s.setItem("History.store",l.stringify(e))};h.intervalList.push(a(h.onUnload,h.options.storeInterval));h.Adapter.bind(e,"beforeunload",h.onUnload);h.Adapter.bind(e,"unload",h.onUnload)}if(!h.emulated.pushState){h.bugs.safariPoll&&h.intervalList.push(a(h.safariStatePoll,h.options.safariPollInterval));if(i.vendor==="Apple Computer, Inc."||(i.appCodeName||"")==="Mozilla"){h.Adapter.bind(e,"hashchange",function(){h.Adapter.trigger(e,"popstate")});h.getHash()&&h.Adapter.onDomLoad(function(){h.Adapter.trigger(e,"hashchange")})}}};h.init()})(window);$.getObject("Pb.History",!0).HistoryManager=function(){function e(){this.init()}var t={pageState:{},pageTitle:null,pageUrl:null,init:function(){this.bindEvents()},bindEvents:function(){$(document).on("HistoryManager::updatePageHistory",$.proxy(function(e){this.updatePageHistory(e)},this))},updatePageHistory:function(e){var t=e.replace?!0:!1;e.state&&this.setCurrentState(e.state);e.url&&this.setPageUrl(e.url);e.title&&this.setPageTitle(e.title);this.updateState(t)},updateState:function(e){if(typeof History!="undefined")try{e?History.replaceState(this.pageState,this.pageTitle,this.pageUrl):History.pushState(this.pageState,this.pageTitle,this.pageUrl)}catch(t){}},setCurrentState:function(e){this.pageState=$.extend(this.pageState,e)},setPageUrl:function(e){this.pageUrl=e},setPageTitle:function(e){this.pageTitle=e}};e.prototype=t;return e}();$.getObject("Pb.History",!0).HistoryManager=new Pb.History.HistoryManager;(function(){var e=typeof window!="undefined"?window:exports,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n=function(){try{document.createElement("$")}catch(e){return e}}();e.btoa||(e.btoa=function(e){for(var r,i,s=0,o=t,u="";e.charAt(s|0)||(o="=",s%1);u+=o.charAt(63&r>>8-s%1*8)){i=e.charCodeAt(s+=.75);if(i>255)throw n;r=r<<8|i}return u});e.atob||(e.atob=function(e){e=e.replace(/=+$/,"");if(e.length%4==1)throw n;for(var r=0,i,s,o=0,u="";s=e.charAt(o++);~s&&(i=r%4?i*64+s:s,r++%4)?u+=String.fromCharCode(255&i>>(-2*r&6)):0)s=t.indexOf(s);return u})})();$.getObject("Pb.Media",!0).MediaIdentifierFactory=function(){function e(){}var t={getIdentifier:function(e){var t;e instanceof Pb.Path.PBPath?t=this.fromPBPath(e):e.path?t=this.fromPBPath(new Pb.Path.PBPath(e.path)):t=null;return t},fromPBPath:function(e){var t=null;if(e.filename!=null){var n="path:";n+=e.location;n+=e.filename;t=btoa(n)}return t}};$.extend(e.prototype,t);return new e}();$.getObject("Pb.Component.Detail",!0).Stats=function(){function e(e){this.init(e)}var t={exifData:[],init:function(e){this.currentMedia=Pb.Data.get(Pb.Data.Shared.MEDIA);this.bindEvents();$.views.helpers({parseExifData:function(e){var t="";for(var n in e)n.length>0&&(t+="<li>"+n+"</li><li>"+e[n]+"</li>");return t}});this.link()},bindEvents:function(){$(document).on("Pb.Component.Media.Media::template-update",$.proxy(this.handleMediaContentUpdate,this));$(".detailStatsWrapper").on("click","#showmore",$.proxy(this.fetchExif,this))},setCurrentMedia:function(e){this.currentMedia=e},handleMediaContentUpdate:function(e){this.setCurrentMedia(e.newTarget);this.hideExif()},link:function(){Pb.JSTemplates.link("#statsExifTemplate","#exifData",[this.exifData]);$("#statsCounts").hide()},fetchExif:function(){$(".moretoggle").hide();$("#statsLoading").show();Pb.Track.tr("detailpage_mediainfo_more_click");var e=new Pb.Path.PBPath(this.currentMedia.path),t=Pb.Media.MediaIdentifierFactory.getIdentifier(e),n={type:"GET",url:"/api/user/"+e.ownername+"/media/"+encodeURIComponent(t)+"/exif",messageHandler:function(){return!0},error:function(){this.showExif([])},success:$.proxy(function(e){e.status===1?this.showExif(e.data):this.showExif([])},this)};Pb.Ajax.ajax(n)},showExif:function(e){this.exifData=e;this.link();$("#statsCounts").show();$("#statsLoading").hide()},hideExif:function(){this.exifData=[];this.link();$("#statsCounts").hide();$("#statsLoading").hide();this.currentMedia.mediaType!=="image"?$(".moretoggle").hide():$(".moretoggle").show()}};$.extend(e.prototype,t);return e}();!function(e){"use strict";var t=function(t,n){this.$element=e(t);this.options=e.extend({},e.fn.button.defaults,n)};t.prototype={constructor:t,setState:function(e){var t="disabled",n=this.$element,r=n.data(),i=n.is("input")?"val":"html";e+="Text";r.resetText||n.data("resetText",n[i]());n[i](r[e]||this.options[e]);setTimeout(function(){e=="loadingText"?n.addClass(t).attr(t,t):n.removeClass(t).removeAttr(t)},0)},toggle:function(){var e=this.$element.parent('[data-toggle="buttons-radio"]');e&&e.find(".active").removeClass("active");this.$element.toggleClass("active")}};e.fn.button=function(n){return this.each(function(){var r=e(this),i=r.data("button"),s=typeof n=="object"&&n;i||r.data("button",i=new t(this,s));n=="toggle"?i.toggle():n&&i.setState(n)})};e.fn.button.defaults={loadingText:"loading..."};e.fn.button.Constructor=t;e(function(){e("body").on("click.button.data-api","[data-toggle^=button]",function(t){var n=e(t.target);n.hasClass("btn")||(n=n.closest(".btn"));n.button("toggle")})})}(window.jQuery);$.getObject("Pb.Component.Common.Follow",!0).FollowAction=function(){function t(t){e=t;i();var n={url:"/action/follow/follow",type:"POST",data:{followType:e.data("type"),followee:e.data("followee"),userId:e.data("user-id")},success:r,error:o};Pb.Ajax.ajax(n)}function n(t){e=t;i();var n={url:"/action/follow/unfollow",type:"POST",data:{followType:e.data("type"),followee:e.data("followee"),userId:e.data("user-id")},success:r,error:o};Pb.Ajax.ajax(n)}function r(e){var t=e.status;t?s():o()}function i(){var t=$.Event("Pb.Component.Common.Follow.FollowAction::action_start");$(e).trigger(t)}function s(){var t=$.Event("Pb.Component.Common.Follow.FollowAction::action_complete");t.action=$(e).text();$(e).trigger(t)}function o(){var t=$.Event("Pb.Component.Common.Follow.FollowAction::action_error");$(e).trigger(t)}var e=null;return{follow:t,unfollow:n}}();$.getObject("Pb.Component.Common.Follow",!0).Button=function(){function e(){this.init.apply(this,arguments)}$.extend(e.prototype,{isLoggedIn:null,init:function(e){this.isLoggedIn=Pb.Data.get("isLoggedIn");this.initEvents()},initEvents:function(){var e=this;$("a.follow.following").live("mouseover mouseout",function(t){t.type==="mouseover"?e.showHover($(this)):e.hideHover($(this))});$("a.follow").live("click",function(t){t.preventDefault();e.toggle($(this))});$("a.follow").live("Pb.Component.Common.Follow.FollowAction::action_start",this.toggleStart);$("a.follow").live("Pb.Component.Common.Follow.FollowAction::action_complete",this.toggleComplete);$("a.follow").live("Pb.Component.Common.Follow.FollowAction::action_error",this.toggleReset)},showHover:function(e){e.find("span").text("Unfollow");e.hasClass("btn-link")||e.addClass("btn-secondary")},hideHover:function(e){e.find("span").text("Following");e.removeClass("btn-secondary");e.find("i").removeClass("sicon-minus-sign")},toggle:function(e){if(!this.isLoggedIn){e.tooltip({delay:{show:2e3,hide:2e3}});e.tooltip("show");return}if(!e.hasClass("disabled"))if(e.hasClass("following")){e.data("complete-text","Follow");Pb.Component.Common.Follow.FollowAction.unfollow(e)}else{e.data("complete-text","Following");Pb.Component.Common.Follow.FollowAction.follow(e)}},toggleStart:function(e){$(e.currentTarget).button("loading")},toggleComplete:function(e){if($(e.currentTarget).data("remove-id")){$("#"+$(e.currentTarget).data("remove-id")).remove();return}if($(e.currentTarget).hasClass("following")){$(e.currentTarget).removeClass("following");$(e.currentTarget).removeClass("btn-secondary");$(e.currentTarget).addClass("btn-primary")}else{$(e.currentTarget).removeClass("btn-primary");$(e.currentTarget).removeClass("btn-secondary");$(e.currentTarget).addClass("following")}$(e.currentTarget).button("complete");$(e.currentTarget).wrapInner("<span>");$(e.currentTarget).prepend("<i>")},toggleReset:function(e){Pb.Component.Element.Message.showDefaultErrorMessage();$(e.currentTarget).button("reset")}});return e}();Pb.InitEventQueue.addToDomReady(function(){new Pb.Component.Common.Follow.Button});$.getObject("Pb.Component.Detail",!0).DetailActions=function(){function e(e){this.init(e)}var t={isLoggedIn:!1,isCompact:!1,actionTargetNormalId:"#detailActions",actionTargetCompactId:"#detailActionsCompact",actionTarget:null,actionTemplate:"#detailActionsTemplate",actionData:[],defaultActionData:[],showPagination:!0,eventRegister:null,currentMedia:null,currentMediaUrl:null,currentMediaIsOwner:!1,rotatePostUrl:"/action/media/rotate",init:function(e){this.showPagination=e.showPagination;this.defaultActionData=e;this.actionData=$.extend(!0,{},this.defaultActionData);this.setCurrentMedia(Pb.Data.Shared.get(Pb.Data.Shared.MEDIA));this.getElements();for(var t=0;t<this.actionData.eventRegister.length;t++)$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:this.actionData.eventRegister[t].eventSelector,eventType:this.actionData.eventRegister[t].eventType,event:this.actionData.eventRegister[t].event}}));this.bindEvents();this.link();this.fetchShareThis()},setCurrentMedia:function(e){this.isLoggedIn=Pb.Data.get("isLoggedIn");this.currentMedia=e;this.currentMediaUrl=e.fullsizeUrl;this.currentMediaIsOwner=e.io;this.actionData.btngroupsocial=this.setOwnerOptionPerms(this.actionData.btngroupsocial);this.actionData.btngroupshare=this.setOwnerOptionPerms(this.actionData.btngroupshare);this.actionData.btngrouptools.items=this.setOwnerOptionPerms(this.actionData.btngrouptools);this.actionData.btngroupnav.items=this.setOwnerOptionPerms(this.actionData.btngroupnav)},setOwnerOptionPerms:function(e){var t=[],n=this.currentMedia.mediaType==="image";for(var r=0;r<e.length;r++){var i=e[r];i.jsAttributes.checkperms?i.jsAttributes.identifier==="edit"?this.currentMediaIsOwner&&n&&t.push(i):i.jsAttributes.identifier==="slideshow"?this.showPagination&&this.currentMedia.context==="album"&&t.push(i):i.jsAttributes.identifier==="btnprev"?this.showPagination&&t.push(i):i.jsAttributes.identifier==="btnnext"?this.showPagination&&t.push(i):i.jsAttributes.identifier==="btnalbum"?this.showPagination&&t.push(i):this.currentMediaIsOwner&&t.push(i):t.push(i)}return t},getElements:function(){this.actionTarget=$("#detailActions")},bindEvents:function(){var e=$(document);e.on("Pb.Component.Media.Media::template-update",$.proxy(this.handleMediaContentUpdate,this));e.on("Pb.Component.Filmstrip.Filmstrip::compact",$.proxy(this.switchToCompactActions,this));e.on("Pb.Component.Filmstrip.Filmstrip::normal",$.proxy(this.switchToNormalActions,this));this.bindActions()},bindActions:function(){var e=$(document);e.on("DetailActions::facebook",$.proxy(function(e){Pb.Track.trf("detail_page_share_facebook_click");$(document).trigger($.Event("Pb.Component.Share.ShareModal::show",{pbData:e.pbData,shareType:"facebook",shareMode:"media",pbEventTarget:e.pbEventTarget}))},this));e.on("DetailActions::twitter",$.proxy(function(e){Pb.Track.trf("detail_page_share_twitter_click");$(document).trigger($.Event("Pb.Component.Share.ShareModal::show",{pbData:e.pbData,shareType:"twitter",shareMode:"media",pbEventTarget:e.pbEventTarget}))},this));e.on("DetailActions::email",$.proxy(function(e){Pb.Track.trf("detail_page_share_email_click");$(document).trigger($.Event("Pb.Component.Share.ShareModal::show",{pbData:e.pbData,shareType:"email",shareMode:"media",pbEventTarget:e.pbEventTarget}))},this));e.on("DetailActions::links",$.proxy(function(e){Pb.Track.trf("detail_page_share_links_click");$(document).trigger($.Event("Pb.Component.Share.ShareModal::show",{pbData:e.pbData,shareType:"links",shareMode:"media",pbEventTarget:e.pbEventTarget}))},this));e.on("DetailActions::slideshow",$.proxy(function(e){document.location="/user/"+Pb.Data.get(Pb.Data.Shared.MEDIA).ownername+"/slideshow/"+Pb.Data.get(Pb.Data.Shared.MEDIA).location},this));e.on("DetailActions::edit",$.proxy(function(e){document.location="/editor?image="+escape(this.currentMediaUrl)+"&detailUrl="+Pb.Data.get(Pb.Data.Shared.MEDIA).linkUrl},this));if(!this.showPagination)return;e.on("click","#btnprev",function(){e.trigger($.Event("Pb.Component.Detail.DetailActions::media_previous_click"))});e.on("click","#btnnext",function(){e.trigger($.Event("Pb.Component.Detail.DetailActions::media_next_click"))});e.on("click","#btnalbum",function(){document.location="/user/"+Pb.Data.get(Pb.Data.Shared.MEDIA).ownername+"/library/"+Pb.Data.get(Pb.Data.Shared.MEDIA).location})},switchToCompactActions:function(){if(this.isCompact)return;this.removeActionTarget();$("#mediaTemplateTarget").append('<div id="detailActionsCompact" class="detailActions detailActionsCompact"></div>');this.actionTarget=$(this.actionTargetCompactId);this.actionTemplate="#detailActionsCompactTemplate";this.link();this.isCompact=!0},switchToNormalActions:function(){if(!this.isCompact)return;this.removeActionTarget();$(".detailfilmstripwrap").before('<div id="detailActions" class="detailActions"></div>');this.actionTarget=$(this.actionTargetNormalId);this.actionTemplate="#detailActionsTemplate";this.bindActions();this.link();this.isCompact=!1},handleMediaContentUpdate:function(e){this.setCurrentMedia(e.newTarget);if(this.isCompact){$("#mediaTemplateTarget").append('<div id="detailActionsCompact" class="detailActions detailActionsCompact"></div>');this.actionTarget=$(this.actionTargetCompactId)}this.link();this.updateShareThis();this.currentMedia.mediaType==="image"?$(".imageOnly").removeClass("hide"):$(".imageOnly").addClass("hide")},fetchShareThis:function(){typeof stLight=="undefined"?$.ajax({url:"http://w.sharethis.com/button/buttons.js",dataType:"script",success:$.proxy(function(){stLight.options({publisher:"ur-69b5b6-88f5-876f-c641-e6cd7f797b5c"});this.updateShareThis()},this),cache:!0}):this.updateShareThis()},updateShareThis:function(){if(typeof stWidget!="undefined"){var e={service:"pinterest",element:document.getElementById("sh-pinterest"),url:this.currentMedia.linkUrl,title:this.currentMedia.titleOrFilename,type:"large",image:this.currentMediaUrl},t={service:"tumblr",element:document.getElementById("sh-tumblr"),url:this.currentMediaUrl,title:this.currentMedia.titleOrFilename,type:"large",image:this.currentMediaUrl},n={service:"googleplus",element:document.getElementById("sh-google"),url:this.currentMedia.linkUrl,title:this.currentMedia.titleOrFilename,type:"large",image:this.currentMediaUrl};stWidget.addEntry(e);stWidget.addEntry(t);stWidget.addEntry(n)}},link:function(){Pb.JSTemplates.link(this.actionTemplate,this.actionTarget,this.actionData)},removeActionTarget:function(){this.actionTarget.off();this.actionTarget.parent()[0].removeChild(this.actionTarget[0])}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Share",!0).ShareModal=function(){function e(){e.superclass.constructor.call(this)}var t,n={currentController:null,privacy:null,init:function(t){var n={eventName:"Pb.Component.Share.ShareModal::show",shownEvent:"Pb.Component.Share.ShareModal::shown",hideEvent:"Pb.Component.Share.ShareModal::hidden",modalId:"#shareModal",modalName:"shareModal",showProgress:!0,refreshAdsOnHide:!0};t&&$.extend(n,t);e.superclass.init.call(this,n);this.initEvents(n)},initEvents:function(e){$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:".shareModalAction",eventType:"click",event:e.eventName}}))},onShow:function(t){var n=t.pbData,r=t.shareMode,i=t.shareType,s=t.pbEventTarget,o;r||(r=$(s).closest("[data-sharemode]").data("sharemode"));i||(i=$(s).closest("[data-sharetype]").data("sharetype"));o=this.getTitle(r,n);t.headerTitle=o;t.modalData={shareMode:r,shareType:i,shareObject:n,pbEventTarget:s};e.superclass.onShow.call(this,t);$(".spinner").hide();(r==="album"||r==="slideshow")&&this.setPrivacyMessage(t);var u=$(this.modalId);u.find(".nav-tabs a").on("shown",$.proxy(function(e){var t=$(e.currentTarget).data("tabtype");$(".privacyMessage .infoText").hide();switch(t){case"email":$(".privacyMessage .shareText").show();this.currentController=Pb.Component.Share.Email;$(document).trigger($.Event("Pb.Component.Share.ShareModal::emailTabShown"));break;case"followers":$(".privacyMessage .shareText").show();this.currentController=Pb.Component.Share.Followers;$(document).trigger($.Event("Pb.Component.Share.ShareModal::followersTabShown"));break;case"links":$(".privacyMessage .shareText").show();this.currentController=Pb.Component.Share.Links;u.find(".linkCodes").children().length===0&&$(document).trigger($.Event("Pb.Component.Share.ShareModal::linksTabShown"));break;case"social":$(".privacyMessage .publicText").show();this.currentController=Pb.Component.Share.SocialShare;$(document).trigger($.Event("Pb.Component.Share.ShareModal::socialTabShown"))}if(this.privacy==="Private"){$(".privacyMessage .shareText").hide();$(".privacyMessage .publicText").show()}},this));$("#shareModalSubmit").on("click",$.proxy(function(e){e.preventDefault();if(!$(this).hasClass("disabled")){var t=$(this.modalId).find("form:visible");t.length&&this.onSubmit(e)}},this));$(".makeAlbumPublic").on("click",$.proxy(function(e){$(".privacyMessage").hide();$(".spinner").show();Pb.Ajax.ajax({url:"/action/album/update",data:{privacyLevel:"public",name:Pb.Data.data.shareModal.shareObject.name,albumPath:Pb.Data.data.shareModal.shareObject.path},success:function(e){if(e.status){var t=Pb.Data.Albums.getCurrentAlbum();t.mergeData(e.data);$(document).trigger($.Event("Pb.Component.Album.Edit.EditAlbum::editAlbumCompleted"));$(".spinner").hide()}else{$(".spinner").hide();$(".privacyMessage").show()}},error:function(e){$(".spinner").hide();$(".privacyMessage").show()}})},this));var a=u.find(".nav-tabs");if(i==="email"){a.find('a[data-tabtype="email"]').tab("show");Pb.Component.Share.SocialShare.setOptions(null)}else if(i==="links")a.find('a[data-tabtype="links"]').tab("show");else if(i==="followers")a.find('a[data-tabtype="followers"]').tab("show");else{a.find('a[data-tabtype="social"]').tab("show");a.find('a[data-tabtype="social"]').trigger($.Event("shown"));if(i==="facebook"||i==="twitter"){Pb.Component.Share.SocialShare.setOptions({service:i});Pb.Component.Share.SocialShare.updateUI()}else Pb.Component.Share.SocialShare.setOptions({showMore:!0})}},setPrivacyMessage:function(e){this.privacy=e.modalData.shareObject.albumStats.privacy.display;var t=e.modalData.shareMode,n=e.modalData.shareType;if(this.privacy!=="Public"){this.privacy==="Password"&&(this.privacy="Password Protected");$(".privacyMessage").html('<i class="icon-exclamtion-sign"></i>This album is '+this.privacy+'. <br/><span class="infoText shareText">Don\'t forget to share the password with your friends!</span><span class="infoText publicText">Make it Public <a href="#" class="makeAlbumPublic">here</a> so your friends can view the '+t+".</span>")}n==="email"&&this.privacy==="Password"?$(".privacyMessage .publicText").hide():$(".privacyMessage .shareText").hide()},onSuccess:function(t){e.superclass.onSuccess.call(this,t);var n=Pb.Data.get(this.modalName);if(n.shareMode==="story"&&!n.shareObject.public)if(typeof Pb.Component.Common.Privacy=="undefined"){var r=n.shareObject;Pb.Ajax.ajax({url:"/action/story/privacy",data:{privacy:1,storyUrl:r.url},success:function(){r.public=!0}})}else $(document).trigger($.Event("Pb.Component.Share.ShareModal::story_public"))},buildSubmitData:function(){var e=null;if(this.currentController){this.submitUrl=this.currentController.getSubmitUrl();e=this.currentController.buildSubmitData(Pb.Data.get(this.modalName))}return e},onFail:function(){$(document).trigger({type:"Pb.Component.Share.ShareModal::error"})},enableSubmit:function(){$("#shareModalSubmit").removeClass("disabled")},disableSubmit:function(){$("#shareModalSubmit").addClass("disabled")},showFooter:function(){$("#shareModal").removeClass("no-footer").find(".modal-footer").show()},hideFooter:function(){$("#shareModal").addClass("no-footer").find(".modal-footer").hide()},getTitle:function(e,t){var n,r;if(e==="album"||e==="slideshow")t.isSlideshow?n="Share this slideshow":t.dirName?n="Share the album: "+t.dirName:n="Share: "+t.ownername+"'s Library";else if(e==="story"){n="Share the story: "+t.title;t.public?$(".storyWarning").hide():$(".storyWarning").show()}else{r=t.mediaType;r==="image"&&(r="photo");n="Share the "+r;t.title&&(n+=": "+t.title)}return n}};Pb.subclass(e,Pb.Component.Element.Modal,n);t=new e;Pb.InitEventQueue.add(function(){t.init()});return t}();$.getObject("Pb.Component.Share",!0).SocialShare=function(){function e(){this.init()}var t={options:null,facebookFeedUrl:"https://www.facebook.com/dialog/feed",twitterFeedUrl:"https://twitter.com/intent/tweet",init:function(){this.initEvents()},initEvents:function(){$(document).on("Pb.Component.Share.ShareModal::shown",$.proxy(this.onModalShown,this));$(document).on("Pb.Component.Share.ShareModal::hidden",$.proxy(this.onModalHidden,this));$(document).on("Pb.Component.Share.ShareModal::socialTabShown",$.proxy(this.onTabShown,this))},onModalShown:function(){var e=Pb.Data.get("shareModal"),t="input[name=defaultMessage_"+e.shareMode+"]",n=$("#socialShare").find("form");$("#socialmessage").attr("placeholder",n.find(t).val());$("#socialShare_more_label").on("click",$.proxy(this.onLessOrMoreClick,this));$("#socialShare_less_label").on("click",$.proxy(this.onLessOrMoreClick,this));$("#socialShare div.connectionInfo").on("Pb_Component_ExternalSite_Connection::success Pb_Component_ExternalSite_Connection::selectCheckbox Pb_Component_ExternalSite_Connection::unselectCheckbox Pb_Component_ExternalSite_Connection::error",$.proxy(this.onServiceClick,this));$("#socialShare .service-selector li > input").on("change",$.proxy(this.onServiceClick,this));this.fetchShareThis();this.reset();this.updateUI()},fetchShareThis:function(){typeof stLight=="undefined"?$.ajax({url:"http://w.sharethis.com/button/buttons.js",dataType:"script",success:$.proxy(function(){stLight.options({publisher:"ur-69b5b6-88f5-876f-c641-e6cd7f797b5c"});this.updateShareThis()},this),cache:!0}):this.updateShareThis()},updateShareThis:function(){if(typeof stWidget!="undefined"){var e=Pb.Data.get("shareModal"),t=this.getExternalShareData(e.shareMode,e.shareObject);$(".extra-service-selector span").empty();$(".extra-service-selector span").each(function(e,n){var r={service:$(this).attr("class"),element:this,url:t.url,title:t.name,type:"large",image:t.picture};stWidget.addEntry(r)})}},onModalHidden:function(){$("#socialShare_more_label").off("click");$("#socialShare_less_label").off("click");$(".service-selector li input").off("change");$(".service-selector").off(".socialShare");$("#socialmessage").val("")},onLessOrMoreClick:function(){$("#socialShare_more_label").is(":visible")?this.toggleMore(!0):this.toggleMore(!1)},onServiceClick:function(e){if(e.type==="Pb_Component_ExternalSite_Connection::success"||e.type==="Pb_Component_ExternalSite_Connection::selectCheckbox"){$(e.currentTarget.parentNode).addClass("selected");e.siteAuth&&e.siteAuth.siteId===2&&e.siteAuth.publishState.toLowerCase()!=="auto"&&$("#shareModal").one("hide",function(){Pb.Component.ExternalSite.AutoPublishModal.onShow()})}else e.type==="Pb_Component_ExternalSite_Connection::unselectCheckbox"||e.type==="Pb_Component_ExternalSite_Connection::error"?$(e.currentTarget.parentNode).removeClass("selected"):$(e.currentTarget.parentNode).toggleClass("selected")},onTabShown:function(){var e=Pb.Data.get("shareModal"),t,n,r,i;if(e&&e.socialShare&&e.socialShare.sites){t=e.socialShare.sites;for(n=0;n<t.length;n++){r={connectionData:t[n],element:"#"+t[n].service+"Connection",promptForAutoPublish:t[n].promptForAutoPublish};i=new Pb.Component.ExternalSite.Connection(r);Pb.Data.add("connection-"+t[n].service,i)}}if(!Pb.Data.get("isLoggedIn")){var s=$("#shareModal").find(".connectionInfo"),o=this.getExternalShareData(e.shareMode,e.shareObject);s.find('input[type="checkbox"]').each(function(){$(this).hide()});$(".service-selector").on("click.socialShare",".facebook-icon, #lbl_facebook, .twitter-icon, #lbl_twitter",$.proxy(function(e){var t=$(e.currentTarget),n,r,i="";if(t.hasClass("facebook-icon")||t.attr("id")==="lbl_facebook"){n={app_id:Pb.Data.get("connection-facebook").connectionData.serviceAppId,link:decodeURIComponent(o.url),name:o.name,picture:decodeURIComponent(o.picture),caption:o.caption,description:o.description,redirect_uri:"http://"+document.location.hostname+"/externalpopup",display:"popup"};i=$.param(n);i=i.replace(/\+/g,"%20");r=this.facebookFeedUrl+"?"+i;window.open(r,"Share","width=550,height=420")}else if(t.hasClass("twitter-icon")||t.attr("id")==="lbl_twitter"){r=this.twitterFeedUrl+"?url="+encodeURIComponent(o.url);o.pbTitle!==""&&(r+="&text="+escape(o.pbTitle));window.open(r,"Share","width=550,height=420")}},this));Pb.Component.Share.ShareModal.hideFooter()}else Pb.Component.Share.ShareModal.showFooter();Pb.Component.Share.ShareModal.enableSubmit()},getSubmitUrl:function(){return $("#socialShare").find("form").attr("action")},buildSubmitData:function(e){var t=$("#socialShare").find("form"),n=t.find(".service-selector").find("input:checked:not(:disabled)"),r=n.map(function(){return this.id}).get().join(","),i=e.shareMode==="slideshow"?e.shareObject.slideshowUrl:e.shareObject.fullsizeUrl||e.shareObject.url,s={targetType:e.shareMode,services:r,message:t.find("#socialShare_message textarea").val()};s.target=i;return s},reset:function(){this.toggleMore(!0)},setOptions:function(e){this.options=e},toggleMore:function(e){if(e){$("#socialShare_more_label").hide();$("#socialShare_less_label").show();$("#socialShare_more_content").show()}else{$("#socialShare_more_label").show();$("#socialShare_less_label").hide();$("#socialShare_more_content").hide()}},updateUI:function(){if(this.options){this.options.showMore&&this.toggleMore(!0);if(this.options.service){var e=$("#service_"+this.options.service);e.trigger("Pb_Component_ExternalSite_Connection::checkboxChange");$("#service_facebook, #service_twitter").removeAttr("checked");$("#service_"+this.options.service).attr("checked","checked")}}},getExternalShareData:function(e,t){var n={url:"",caption:"photobucket.com",description:"",name:"",picture:"",pbTitle:""};if(e==="album"||e==="slideshow"){n.url=e==="slideshow"?t.slideshowUrl:t.url;t.thumbFileName?n.picture=document.location.origin+t.path+"/bth_"+t.thumbFileName:t.media&&t.media.length>0?n.picture=t.media[0].thumbUrl:t.items&&t.items.length>0&&(n.picture=t.items[0].thumbUrl);n.name=t.ownername+"'s ";n.name+=t.isRootAlbum?"library":t.name+" "+e;n.name+=" on Photobucket";n.description=t.description?t.description.text:""}else if(e==="story"){n.url=t.fullsizeUrl;n.picture=t.thumbUrl;t.title.toLowerCase().indexOf(t.storyAuthor.toLowerCase())===-1&&(n.name+=t.storyAuthor+"'s ");n.name+=t.title;t.title.toLowerCase().indexOf("story")===-1&&(n.name+=" story");n.name+=" on Photobucket";n.pbTitle=n.name}else{n.url=t.linkUrl;n.picture=t.thumbUrl;if(t.title!==""){n.name=t.title;n.pbTitle=n.name}else{n.name=t.username+"'s ";n.name+=t.mediaType==="image"?" photo":t.mediaType;n.name+=" on Photobucket"}n.description=t.description}n.url+=n.url.indexOf("?")===-1?"?src=pb_unauth":"&src=pb_unauth";return n}};$.extend(e.prototype,t);return new e}();$.getObject("Pb.Component.ExternalSite",!0).Connection=function(){function e(e){this.init(e)}var t={init:function(e){this.element=$(e.element);this.connectionData=e.connectionData;e.hasOwnProperty("promptForAutoPublish")?this.promptForAutoPublish=e.promptForAutoPublish:this.promptForAutoPublish=!0;this.linkData();this.initEvents()},initEvents:function(){if(Pb.Data.get("isLoggedIn")){this.connectionData.connectMethod==="checkbox"?this.element.find("input[type=checkbox]").on("click Pb_Component_ExternalSite_Connection::checkboxChange",$.proxy(this.connectByCheckbox,this)):this.element.on("click",".connectLink",$.proxy(function(e){e.preventDefault();var t=$(e.currentTarget);this.toggleConnection(t.attr("href"),t.data("connected"))},this));this.element.on("change",".autoShare input",$.proxy(function(e){this.toggleAutoshare(e.currentTarget.checked)},this))}},toggleConnection:function(e,t){t?this.disconnect():this.doConnect(e)},connect:function(e){this.doConnect(e.href)},doConnect:function(e){$(document).one("Pb.Component.ExternalSite.Connect::connect",$.proxy(this.connectCallback,this));Pb.Component.ExternalSite.Connect.connect(e,!this.promptForAutoPublish)},connectByCheckbox:function(e){e.type==="Pb_Component_ExternalSite_Connection::checkboxChange"&&(e.target.checked=!e.target.checked);if(e.target.checked)if(this.connectionData.isConnected)this.element.trigger("Pb_Component_ExternalSite_Connection::selectCheckbox");else{this.doConnect($(e.target).data("connecturl"));e.target.disabled=!0}else this.element.trigger("Pb_Component_ExternalSite_Connection::unselectCheckbox")},connectCallback:function(e){var t,n,r;if(e.status){n=e.connectInfo.siteAuth;this.connectionData.isConnected=!0;this.connectionData.siteUsername=n.siteUsername;this.connectionData.siteUserLink=n.siteUserLink;this.connectionData.siteUserImage=n.siteUserImage;this.connectionData.style==="verbose"?this.connectionData.connectionLabel="Connected as "+n.siteUsername:this.connectionData.connectionLabel=n.siteUsername;if(this.connectionData.actionBtn){var i=this.connectionData.actionBtn;i.classString=i.classString.replace(/btn-primary/,"btn-secondary");i.label="Disconnect";i.iconClass="icon-minus-sign";i.extraAttributes="data-connected='true'"}this.connectionData.autoshare&&(n.publishState&&n.publishState.toLowerCase()==="auto"?this.connectionData.autoshare.boxes[0].value="true":this.connectionData.autoshare.boxes[0].value="false");this.linkData();this.element.trigger({type:"Pb_Component_ExternalSite_Connection::success",siteAuth:n})}else{r={type:"Pb_Component_ExternalSite_Connection::error"};t=this.element.find("input[type=checkbox]");if(t.length){t.attr("disabled",!1);t.attr("checked",!1)}this.element.trigger(r)}},linkData:function(){var e;Pb.JSTemplates.link("#connectionItem",this.element,this.connectionData);if(this.connectionData.connectMethod==="checkbox"&&this.connectionData.isConnected){e=this.element.find("input[type=checkbox]");if(e.length){e.attr("disabled",!1);e.attr("checked",!0)}}this.connectionData.autoshare&&this.element.find(".autoShare input").attr("checked",this.connectionData.autoshare.boxes[0].value==="true")},disconnectSuccess:function(e){if(e.status){this.connectionData.isConnected=!1;if(this.connectionData.actionBtn){var t=this.connectionData.actionBtn;t.classString=t.classString.replace(/btn-secondary/,"btn-primary");t.label="Connect";t.iconClass="";t.extraAttributes="data-connected='false'"}this.connectionData.autoshare&&(this.connectionData.autoshare.boxes[0].value="false");this.linkData()}},disconnect:function(){Pb.Component.ExternalSite.DisconnectConfirm.show(this.connectionData.siteId,$.proxy(this.disconnectSuccess,this))},handleAutoshareSuccess:function(e){var t=this.element.find(".autoShare input");this.connectionData.autoshare.boxes[0].value=t.attr("checked")?"true":"false"},handleAutoshareError:function(e){var t;if(e.data&&e.data.requiredPermissions){t=this.element.find(".actionButton");if(t.length){$(document).one("Pb.Component.ExternalSite.Connect::permissions",$.proxy(function(e){e.status===1?this.toggleAutoshare(!0):this.resetAutoshare()},this));Pb.Component.ExternalSite.Connect.getPermissions(t.attr("href"),e.data.requiredPermissions)}}else this.resetAutoshare()},resetAutoshare:function(){var e=this.element.find(".autoShare input");e.attr("checked",!e.attr("checked"));this.connectionData.autoshare.boxes[0].value=e.attr("checked")?"true":"false"},toggleAutoshare:function(e){Pb.Ajax.ajax({url:"/action/externalSite/updateAutoShare",data:{siteId:this.connectionData.siteId,autoshare:e},success:$.proxy(function(e){e.status?this.handleAutoshareSuccess(e):this.handleAutoshareError(e)},this),error:$.proxy(this.handleAutoshareError,this)})}};e.prototype=t;return e}();$.getObject("Pb.Component.ExternalSite",!0).DisconnectConfirm=function(){function e(){e.superclass.constructor.call(this)}var t,n={init:function(t){var n={modalId:"#disconnectConfirm",modalName:"disconnectConfirm",submitButtonId:"#disconnectSubmit",submitUrl:"/action/externalSite/disconnect",showProgress:!0};t&&$.extend(n,t);e.superclass.init.call(this,n)},show:function(e,t,n){$(this.modalId).find("#siteId").val(e);t&&(this.onSuccess=this.getSuccessCallback(t));n&&(this.onFail=n);this.onShow()},buildSubmitData:function(){var e=$(this.modalId).find("form"),t={siteId:e.find("#siteId").val()};return t},getSuccessCallback:function(e){return function(t){Pb.Component.Common.ProfilePic.ProfilePic.update(t.data.profilePic);$(document).trigger({type:"DisconnectConfirm::success",siteId:t.data.siteId});e.call(this,t)}}};Pb.subclass(e,Pb.Modal.ModalActionBase,n);t=new e;Pb.InitEventQueue.add(function(){t.init()});return t}();$.getObject("Pb.Component.Share",!0).Email=function(){function e(){this.init()}var t={init:function(){this.initEvents()},initEvents:function(){$(document).on("Pb.Component.Share.ShareModal::shown",$.proxy(this.onModalShown,this));$(document).on("Pb.Component.Share.ShareModal::hidden",$.proxy(this.onModalHidden,this));$(document).on("Pb.Component.Share.ShareModal::emailTabShown",$.proxy(this.onTabShown,this))},onCaptchaSuccess:function(){Pb.Component.Share.ShareModal.enableSubmit()},onModalShown:function(){Pb.Component.Element.Form.Honeypot.init($(".shareEmail"));var e=$(".shareEmail").find("form");e.length>0&&e.get(0).reset();var t=Pb.Data.get("shareModal"),n="input[name=defaultMessage_"+t.shareMode+"]";e.find("#message").attr("placeholder",e.find(n).val());var r=$("#shareModal .sliderCaptcha");if(r.length){this.captcha=new Pb.Component.Element.Captcha.Slider({container:r});this.captcha.on("success",$.proxy(this.onCaptchaSuccess,this))}else Pb.Component.Share.ShareModal.enableSubmit();$(document).on("Pb.Component.Share.ShareModal::error",$.proxy(this.onFail,this))},onModalHidden:function(){$(document).off("Pb.Component.Share.ShareModal::error",$.proxy(this.onFail,this))},onTabShown:function(){$("#shareModal #shareModalSubmit").show();Pb.Component.Share.ShareModal.showFooter();var e=$("#shareModal .sliderCaptcha");e.length?$("#shareModalSubmit").addClass("disabled"):$("#shareModalSubmit").removeClass("disabled")},getSubmitUrl:function(){return $(".shareEmail").find("form").attr("action")},buildSubmitData:function(e){var t=$(".shareEmail").find("form"),n,r=e.shareObject.fullsizeUrl,i={targetType:e.shareMode};n=t.find("input");for(var s=0;s<n.length;s++)i[n[s].name]=n[s].value;n=t.find("textarea");for(var s=0;s<n.length;s++)i[n[s].name]=n[s].value;this.captcha&&(i.hashCash=this.captcha.getHashCash());if(!r){r=e.shareObject.url;e.shareMode==="slideshow"&&(r=e.shareObject.slideshowUrl)}i.target=r;return i},setOptions:function(e){this.options=e},onFail:function(){if(this.captcha){Pb.Component.Share.ShareModal.disableSubmit();this.captcha.reset()}}};$.extend(e.prototype,t);return new e}();(function(e){e.fn.drag=function(t,n,r){var i=typeof t=="string"?t:"",s=e.isFunction(t)?t:e.isFunction(n)?n:null;i.indexOf("drag")!==0&&(i="drag"+i);r=(t==s?n:r)||{};return s?this.bind(i,r,s):this.trigger(i)};var t=e.event,n=t.special,r=n.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(t){var n=e.data(this,r.datakey),i=t.data||{};n.related+=1;e.each(r.defaults,function(e,t){i[e]!==undefined&&(n[e]=i[e])})},remove:function(){e.data(this,r.datakey).related-=1},setup:function(){if(e.data(this,r.datakey))return;var n=e.extend({related:0},r.defaults);e.data(this,r.datakey,n);t.add(this,"touchstart mousedown",r.init,n);this.attachEvent&&this.attachEvent("ondragstart",r.dontstart)},teardown:function(){var n=e.data(this,r.datakey)||{};if(n.related)return;e.removeData(this,r.datakey);t.remove(this,"touchstart mousedown",r.init);r.textselect(!0);this.detachEvent&&this.detachEvent("ondragstart",r.dontstart)},init:function(i){if(r.touched)return;var s=i.data,o;if(i.which!=0&&s.which>0&&i.which!=s.which)return;if(e(i.target).is(s.not))return;if(s.handle&&!e(i.target).closest(s.handle,i.currentTarget).length)return;r.touched=i.type=="touchstart"?this:null;s.propagates=1;s.mousedown=this;s.interactions=[r.interaction(this,s)];s.target=i.target;s.pageX=i.pageX;s.pageY=i.pageY;s.dragging=null;o=r.hijack(i,"draginit",s);if(!s.propagates)return;o=r.flatten(o);if(o&&o.length){s.interactions=[];e.each(o,function(){s.interactions.push(r.interaction(this,s))})}s.propagates=s.interactions.length;s.drop!==!1&&n.drop&&n.drop.handler(i,s);r.textselect(!1);r.touched?t.add(r.touched,"touchmove touchend",r.handler,s):t.add(document,"mousemove mouseup",r.handler,s);if(!r.touched||s.live)return!1},interaction:function(t,n){var i=e(t)[n.relative?"position":"offset"]()||{top:0,left:0};return{drag:t,callback:new r.callback,droppable:[],offset:i}},handler:function(i){var s=i.data;switch(i.type){case!s.dragging&&"touchmove":i.preventDefault();case!s.dragging&&"mousemove":if(Math.pow(i.pageX-s.pageX,2)+Math.pow(i.pageY-s.pageY,2)<Math.pow(s.distance,2))break;i.target=s.target;r.hijack(i,"dragstart",s);s.propagates&&(s.dragging=!0);case"touchmove":i.preventDefault();case"mousemove":if(s.dragging){r.hijack(i,"drag",s);if(s.propagates){s.drop!==!1&&n.drop&&n.drop.handler(i,s);break}i.type="mouseup"};case"touchend":case"mouseup":default:r.touched?t.remove(r.touched,"touchmove touchend",r.handler):t.remove(document,"mousemove mouseup",r.handler);if(s.dragging){s.drop!==!1&&n.drop&&n.drop.handler(i,s);r.hijack(i,"dragend",s)}r.textselect(!0);s.click===!1&&s.dragging&&e.data(s.mousedown,"suppress.click",(new Date).getTime()+5);s.dragging=r.touched=!1}},hijack:function(n,i,s,o,u){if(!s)return;var a={event:n.originalEvent,type:n.type},f=i.indexOf("drop")?"drag":"drop",l,c=o||0,h,p,d,v=isNaN(o)?s.interactions.length:o;n.type=i;n.originalEvent=null;s.results=[];do if(h=s.interactions[c]){if(i!=="dragend"&&h.cancelled)continue;d=r.properties(n,s,h);h.results=[];e(u||h[f]||s.droppable).each(function(o,u){d.target=u;n.isPropagationStopped=function(){return!1};l=u?t.dispatch.call(u,n,d):null;if(l===!1){if(f=="drag"){h.cancelled=!0;s.propagates-=1}i=="drop"&&(h[f][o]=null)}else i=="dropinit"&&h.droppable.push(r.element(l)||u);i=="dragstart"&&(h.proxy=e(r.element(l)||h.drag)[0]);h.results.push(l);delete n.result;if(i!=="dropinit")return l});s.results[c]=r.flatten(h.results);i=="dropinit"&&(h.droppable=r.flatten(h.droppable));i=="dragstart"&&!h.cancelled&&d.update()}while(++c<v);n.type=a.type;n.originalEvent=a.event;return r.flatten(s.results)},properties:function(e,t,n){var i=n.callback;i.drag=n.drag;i.proxy=n.proxy||n.drag;i.startX=t.pageX;i.startY=t.pageY;i.deltaX=e.pageX-t.pageX;i.deltaY=e.pageY-t.pageY;i.originalX=n.offset.left;i.originalY=n.offset.top;i.offsetX=i.originalX+i.deltaX;i.offsetY=i.originalY+i.deltaY;i.drop=r.flatten((n.drop||[]).slice());i.available=r.flatten((n.droppable||[]).slice());return i},element:function(e){if(e&&(e.jquery||e.nodeType==1))return e},flatten:function(t){return e.map(t,function(t){return t&&t.jquery?e.makeArray(t):t&&t.length?r.flatten(t):t})},textselect:function(t){e(document)[t?"unbind":"bind"]("selectstart",r.dontstart).css("MozUserSelect",t?"":"none");document.unselectable=t?"off":"on"},dontstart:function(){return!1},callback:function(){}};r.callback.prototype={update:function(){n.drop&&this.available.length&&e.each(this.available,function(e){n.drop.locate(this,e)})}};var i=t.dispatch;t.dispatch=function(t){if(t&&"type"in t&&e.data(this,"suppress."+t.type)-(new Date).getTime()>0){e.removeData(this,"suppress."+t.type);return}return i.apply(this,arguments)};var s=t.fixHooks.touchstart=t.fixHooks.touchmove=t.fixHooks.touchend=t.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(t,n){if(n){var r=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0]||null;r&&e.each(s.props,function(e,n){t[n]=r[n]})}return t}};n.draginit=n.dragstart=n.dragend=r})(jQuery);(function(e,t){function h(e,t,n){var r=u[t.type]||{},i=t.empty||n;if(i&&e==null)return null;if(t.def&&e==null)return t.def;r.floor?e=~~e:e=parseFloat(e);if(e==null||isNaN(e))return t.def;if(r.mod){e%=r.mod;return e<0?r.mod+e:e}return r.min>e?r.min:r.max<e?r.max:e}function p(t){var n=s(),r=n._rgba=[];t=t.toLowerCase();c(i,function(e,i){var s=i.re.exec(t),u=s&&i.parse(s),a,f=i.space||"rgba",l=o[f].cache;if(u){a=n[f](u);n[l]=a[l];r=n._rgba=a._rgba;return!1}});if(r.length!==0){Math.max.apply(Math,r)===0&&e.extend(r,l.transparent);return n}if(t=l[t])return t}function d(e,t,n){n=(n+1)%1;return n*6<1?e+(t-e)*6*n:n*2<1?t:n*3<2?e+(t-e)*(2/3-n)*6:e}var n="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color outlineColor".split(" "),r=/^([\-+])=\s*(\d+\.?\d*)/,i=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],s=e.Color=function(t,n,r,i){return new e.Color.fn.parse(t,n,r,i)},o={rgba:{cache:"_rgba",props:{red:{idx:0,type:"byte",empty:!0},green:{idx:1,type:"byte",empty:!0},blue:{idx:2,type:"byte",empty:!0},alpha:{idx:3,type:"percent",def:1}}},hsla:{cache:"_hsla",props:{hue:{idx:0,type:"degrees",empty:!0},saturation:{idx:1,type:"percent",empty:!0},lightness:{idx:2,type:"percent",empty:!0}}}},u={"byte":{floor:!0,min:0,max:255},percent:{min:0,max:1},degrees:{mod:360,floor:!0}},a=o.rgba.props,f=s.support={},l,c=e.each;o.hsla.props.alpha=a.alpha;s.fn=s.prototype={constructor:s,parse:function(n,r,i,u){if(n===t){this._rgba=[null,null,null,null];return this}if(n instanceof e||n.nodeType){n=n instanceof e?n.css(r):e(n).css(r);r=t}var f=this,d=e.type(n),v=this._rgba=[],m;if(r!==t){n=[n,r,i,u];d="array"}if(d==="string")return this.parse(p(n)||l._default);if(d==="array"){c(a,function(e,t){v[t.idx]=h(n[t.idx],t)});return this}if(d==="object"){n instanceof s?c(o,function(e,t){n[t.cache]&&(f[t.cache]=n[t.cache].slice())}):c(o,function(e,t){c(t.props,function(e,r){var i=t.cache;if(!f[i]&&t.to){if(n[e]==null||e==="alpha")return;f[i]=t.to(f._rgba)}f[i][r.idx]=h(n[e],r,!0)})});return this}},is:function(e){var t=s(e),n=!0,r=this;c(o,function(e,i){var s=t[i.cache],o;if(s){o=r[i.cache]||i.to&&i.to(r._rgba)||[];c(i.props,function(e,t){if(s[t.idx]!=null){n=s[t.idx]==o[t.idx];return n}})}return n});return n},_space:function(){var e=[],t=this;c(o,function(n,r){t[r.cache]&&e.push(n)});return e.pop()},transition:function(e,t){var n=s(e),r=n._space(),i=o[r],a=this[i.cache]||i.to(this._rgba),f=a.slice();n=n[i.cache];c(i.props,function(e,r){var i=r.idx,s=a[i],o=n[i],l=u[r.type]||{};if(o===null)return;if(s===null)f[i]=o;else{l.mod&&(o-s>l.mod/2?s+=l.mod:s-o>l.mod/2&&(s-=l.mod));f[r.idx]=h((o-s)*t+s,r)}});return this[r](f)},blend:function(t){if(this._rgba[3]===1)return this;var n=this._rgba.slice(),r=n.pop(),i=s(t)._rgba;return s(e.map(n,function(e,t){return(1-r)*i[t]+r*e}))},toRgbaString:function(){var t="rgba(",n=e.map(this._rgba,function(e,t){return e==null?t>2?1:0:e});if(n[3]===1){n.pop();t="rgb("}return t+n.join(",")+")"},toHslaString:function(){var t="hsla(",n=e.map(this.hsla(),function(e,t){e==null&&(e=t>2?1:0);t&&t<3&&(e=Math.round(e*100)+"%");return e});if(n[3]==1){n.pop();t="hsl("}return t+n.join(",")+")"},toHexString:function(t){var n=this._rgba.slice(),r=n.pop();t&&n.push(~~(r*255));return"#"+e.map(n,function(e,t){e=(e||0).toString(16);return e.length==1?"0"+e:e}).join("")},toString:function(){return this._rgba[3]===0?"transparent":this.toRgbaString()}};s.fn.parse.prototype=s.fn;o.hsla.to=function(e){if(e[0]==null||e[1]==null||e[2]==null)return[null,null,null,e[3]];var t=e[0]/255,n=e[1]/255,r=e[2]/255,i=e[3],s=Math.max(t,n,r),o=Math.min(t,n,r),u=s-o,a=s+o,f=a*.5,l,c;o===s?l=0:t===s?l=60*(n-r)/u+360:n===s?l=60*(r-t)/u+120:l=60*(t-n)/u+240;f===0||f===1?c=f:f<=.5?c=u/a:c=u/(2-a);return[Math.round(l)%360,c,f,i==null?1:i]};o.hsla.from=function(e){if(e[0]==null||e[1]==null||e[2]==null)return[null,null,null,e[3]];var t=e[0]/360,n=e[1],r=e[2],i=e[3],s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s,u,a,f;return[Math.round(d(o,s,t+1/3)*255),Math.round(d(o,s,t)*255),Math.round(d(o,s,t-1/3)*255),i]};c(o,function(n,i){var o=i.props,u=i.cache,a=i.to,f=i.from;s.fn[n]=function(n){a&&!this[u]&&(this[u]=a(this._rgba));if(n===t)return this[u].slice();var r=e.type(n),i=r==="array"||r==="object"?n:arguments,l=this[u].slice(),p;c(o,function(e,t){var n=i[r==="object"?e:t.idx];n==null&&(n=l[t.idx]);l[t.idx]=h(n,t)});if(f){p=s(f(l));p[u]=l;return p}return s(l)};c(o,function(t,i){if(s.fn[t])return;s.fn[t]=function(s){var o=e.type(s),u=t==="alpha"?this._hsla?"hsla":"rgba":n,a=this[u](),f=a[i.idx],l;if(o==="undefined")return f;if(o==="function"){s=s.call(this,f);o=e.type(s)}if(s==null&&i.empty)return this;if(o==="string"){l=r.exec(s);l&&(s=f+parseFloat(l[2])*(l[1]==="+"?1:-1))}a[i.idx]=s;return this[u](a)}})});c(n,function(t,n){e.cssHooks[n]={set:function(t,r){var i;if(e.type(r)!=="string"||(i=p(r))){r=s(i||r);if(!f.rgba&&r._rgba[3]!==1){var o,u=n==="backgroundColor"?t.parentNode:t;do o=e.curCSS(u,"backgroundColor");while((o===""||o==="transparent")&&(u=u.parentNode)&&u.style);r=r.blend(o&&o!=="transparent"?o:"_default")}r=r.toRgbaString()}t.style[n]=r}};e.fx.step[n]=function(t){if(!t.colorInit){t.start=s(t.elem,n);t.end=s(t.end);t.colorInit=!0}e.cssHooks[n].set(t.elem,t.start.transition(t.end,t.pos))}});e(function(){var e=document.createElement("div"),t=e.style;t.cssText="background-color:rgba(1,1,1,.5)";f.rgba=t.backgroundColor.indexOf("rgba")>-1});l=e.Color.names={aqua:"#00ffff",azure:"#f0ffff",beige:"#f5f5dc",black:"#000000",blue:"#0000ff",brown:"#a52a2a",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkviolet:"#9400d3",fuchsia:"#ff00ff",gold:"#ffd700",green:"#008000",indigo:"#4b0082",khaki:"#f0e68c",lightblue:"#add8e6",lightcyan:"#e0ffff",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightyellow:"#ffffe0",lime:"#00ff00",magenta:"#ff00ff",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",pink:"#ffc0cb",purple:"#800080",violet:"#800080",red:"#ff0000",silver:"#c0c0c0",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}})(jQuery);(typeof Crypto=="undefined"||!Crypto.util)&&function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=window.Crypto={},n=t.util={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return n.rotl(e,8)&16711935|n.rotl(e,24)&4278255360;for(var t=0;t<e.length;t++)e[t]=n.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(Math.random()*256));return t},bytesToWords:function(e){for(var t=[],n=0,r=0;n<e.length;n++,r+=8)t[r>>>5]|=(e[n]&255)<<24-r%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<e.length*32;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++){t.push((e[n]>>>4).toString(16));t.push((e[n]&15).toString(16))}return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(t){if(typeof btoa=="function")return btoa(s.bytesToString(t));for(var n=[],r=0;r<t.length;r+=3){var i=t[r]<<16|t[r+1]<<8|t[r+2];for(var o=0;o<4;o++)r*8+o*6<=t.length*8?n.push(e.charAt(i>>>6*(3-o)&63)):n.push("=")}return n.join("")},base64ToBytes:function(t){if(typeof atob=="function")return s.stringToBytes(atob(t));t=t.replace(/[^A-Z0-9+\/]/ig,"");for(var n=[],r=0,i=0;r<t.length;i=++r%4){if(i==0)continue;n.push((e.indexOf(t.charAt(r-1))&Math.pow(2,-2*i+8)-1)<<i*2|e.indexOf(t.charAt(r))>>>6-i*2)}return n}},r=t.charenc={},i=r.UTF8={stringToBytes:function(e){return s.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(s.bytesToString(e)))}},s=r.Binary={stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e.charCodeAt(n)&255);return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}}();(typeof Crypto=="undefined"||!Crypto.util)&&function(){var e=window.Crypto={},t=e.util={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return t.rotl(e,8)&16711935|t.rotl(e,24)&4278255360;for(var n=0;n<e.length;n++)e[n]=t.endian(e[n]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(Math.random()*256));return t},bytesToWords:function(e){for(var t=[],n=0,r=0;n<e.length;n++,r+=8)t[r>>>5]|=(e[n]&255)<<24-r%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<e.length*32;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++)t.push((e[n]>>>4).toString(16)),t.push((e[n]&15).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(e){if(typeof btoa=="function")return btoa(n.bytesToString(e));for(var t=[],r=0;r<e.length;r+=3)for(var i=e[r]<<16|e[r+1]<<8|e[r+2],s=0;s<4;s++)r*8+s*6<=e.length*8?t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>>6*(3-s)&63)):t.push("=");return t.join("")},base64ToBytes:function(e){if(typeof atob=="function")return n.stringToBytes(atob(e));for(var e=e.replace(/[^A-Z0-9+\/]/ig,""),t=[],r=0,i=0;r<e.length;i=++r%4)i!=0&&t.push(("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(r-1))&Math.pow(2,-2*i+8)-1)<<i*2|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(r))>>>6-i*2);return t}},e=e.charenc={};e.UTF8={stringToBytes:function(e){return n.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(n.bytesToString(e)))}};var n=e.Binary={stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e.charCodeAt(n)&255);return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}}();(function(){var e=Crypto,t=e.util,n=e.charenc,r=n.UTF8,i=n.Binary,s=e.SHA1=function(e,n){var r=t.wordsToBytes(s._sha1(e));return n&&n.asBytes?r:n&&n.asString?i.bytesToString(r):t.bytesToHex(r)};s._sha1=function(e){e.constructor==String&&(e=r.stringToBytes(e));var n=t.bytesToWords(e),i=e.length*8,e=[],s=1732584193,o=-271733879,u=-1732584194,f=271733878,l=-1009589776;n[i>>5]|=128<<24-i%32;n[(i+64>>>9<<4)+15]=i;for(i=0;i<n.length;i+=16){for(var c=s,h=o,p=u,d=f,v=l,g=0;g<80;g++){if(g<16)e[g]=n[i+g];else{var y=e[g-3]^e[g-8]^e[g-14]^e[g-16];e[g]=y<<1|y>>>31}y=(s<<5|s>>>27)+l+(e[g]>>>0)+(g<20?(o&u|~o&f)+1518500249:g<40?(o^u^f)+1859775393:g<60?(o&u|o&f|u&f)-1894007588:(o^u^f)-899497514);l=f;f=u;u=o<<30|o>>>2;o=s;s=y}s+=c;o+=h;u+=p;f+=d;l+=v}return[s,o,u,f,l]};s._blocksize=16;s._digestsize=20})();$.getObject("Pb.Component.Element.Captcha",!0).Slider=function(){function e(e){this.init(e)}var t={container:null,deltaChanges:0,startTime:0,init:function(e){if(!e.container)return;this.container=e.container;this.container.find(".arrow").css({left:4}).removeClass("nodrag");this.bindEvents()},bindEvents:function(){var e=this.container.find(".arrow"),t=this;e.drag("start",function(e,n){if(!t.initialOffset){t.initialOffset=t.container.find(".arrow").offset().left;t.parentOffset=t.container.offset().left;t.mouseOffset=e.pageX-t.initialOffset}t.deltaChanges=0;t.startTime=(new Date).getTime();n.limit={};n.limit.left=t.initialOffset-t.parentOffset;n.limit.right=n.limit.left+(t.container.outerWidth()-8)-$(this).outerWidth();$(this).addClass("dragging")}).drag(function(e,n){var r=e.pageX-t.parentOffset-t.mouseOffset;$(this).css({left:Math.min(n.limit.right,Math.max(n.limit.left,r))});n.deltaX>0&&t.deltaChanges++}).drag("end",function(e,n){$(this).removeClass("dragging");var r=parseInt($(this).css("left"),10),i=n.limit.right,s="",o=(new Date).getTime();if(r/i*100>85&&t.deltaChanges>0){$(this).animate({left:i+"px"},50);t.container.data("hashCash",t.container.data("seed")+":"+t.startTime+":"+o+":"+t.deltaChanges);t.container.trigger("Pb.Component.Element.Captcha.Slider::success",{delta:t.deltaChanges,hash:s});$(this).unbind("drag").addClass("nodrag");t.deltaChanges=0}else $(this).animate({left:4},50)});$("div.sliderCaptcha").tooltip({placement:"right",delay:{show:300,hide:100}})},destroy:function(){var e=this.container.find(".arrow");e.unbind("draginit dragstart drag dragend");this.initialOffset=null;this.parentOffset=null;this.mouseOffset=null},getHashCash:function(){return this.container.data("hashCash")},on:function(e,t){e=="success"&&this.container.on("Pb.Component.Element.Captcha.Slider::success",t)},reset:function(){this.destroy();this.container.find(".arrow").css({left:4}).removeClass("nodrag");this.bindEvents()}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Element.Form",!0).Honeypot=function(){function e(e){e.find(".fpc").each(function(){$(this).attr("value",$(this).data("val"))})}return{init:e}}();(function(){function e(){new Pb.Component.Common.Links.LinkCodes({selector:"#shareModal .linkCodes",prefix:"shareModal",labelType:"verbose"});$("#shareModal .linkCodes").trigger({type:"Pb.Component.Common.Links.LinkCodes::refresh",objectData:Pb.Data.get("shareModal").shareObject});Pb.Component.Share.ShareModal.hideFooter()}$(document).on("Pb.Component.Share.ShareModal::linksTabShown",e)})();$.getObject("Pb.Path",!0).PBPath=function(){function e(e){this.pathString=decodeURIComponent(e);this.parse(this.pathString)}var t={pathFormat:/^\/?([^\/]+)\/([^\/]+)\/([^\/]+)\/(.*\/)?([^\/]+)$/,parse:function(e){var t=this.pathFormat.exec(e);if(t==null){this.albumType=null;this.vee=null;this.ownername=null;this.location=null;this.filename=null}else{this.albumType=t[1];this.vee=t[2];this.ownername=t[3];this.location=t[4]===undefined?"":t[4];this.filename=t[5]}}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Common.Links",!0).LinkCodes=function(){function e(e){this.init(e)}function t(e,t){switch(e){case"email":return"Email & IM";case"direct":return"Direct";case"html":return t==="verbose"?"HTML <span>(for eBay, Craigslist, blogs, websites)</span>":"HTML";case"htmlThumb":return"HTML thumb";case"img":return t==="verbose"?"IMG codes <span>(for forums, boards)</span>":"IMG";case"imgThumb":return"IMG thumb";case"slideshow":return"Slideshow";case"embed":return"Embed";default:return""}}function n(e,n,r,i,s,o){var u=t(e,o),a=null;u&&(a={zclipId:i+"_zeroclipboard_"+r,cclipboardId:i+"_copycode_"+r,ccInputId:i+"_ccinput_"+r,inputLabel:u,inputText:$("<div />").html(n).text(),tracking:"share_file_get_link_code_"+e+"_click",type:s});return a}var r={init:function(e){if(!e.selector)return;this.element=$(e.selector);this.prefix=e.prefix;this.labelType=e.labelType;this.inputType=e.inputType;this.inputType||(this.inputType="input");this.linkCodesData=[];this.initEvents();this.element.length&&Pb.JSTemplates.link("#copyCodeTemplate",this.element,this.linkCodesData)},initEvents:function(){this.element.on("Pb.Component.Common.Links.LinkCodes::refresh",$.proxy(this.refresh,this))},populateCodes:function(e){var t=[],n=0;if($.isArray(e)){for(n=0;n<e.length;n++){e[n].zclipId=this.prefix+"_zeroclipboard_"+n;e[n].cclipboardId=this.prefix+"_copycode_"+n;e[n].ccInputId=this.prefix+"_ccinput_"+n}$.observable(this.linkCodesData).refresh(e);this.bindCopyCodes()}else if(!$.isEmptyObject(e)){t=this.buildLinkCodesFromArray(e);$.observable(this.linkCodesData).refresh(t);this.bindCopyCodes()}else this.element.html('<p class="noLinkCodes">No link options enabled</p>')},buildLinkCodesFromArray:function(e){var t,r=0,i,s=[];for(t in e)if(e.hasOwnProperty(t)){i=n(t,e[t],r,this.prefix,this.inputType,this.labelType);if(i){s.push(i);r++}}return s},refresh:function(e){var t,n,r,i,s,o;if(e.objectData&&e.objectData.linkcodes){t=e.objectData.linkcodes;if(typeof t=="string"){t=$.parseJSON(t);e.objectData.linkcodes=t}this.populateCodes(t)}else if(e.objectData.type==="Pb_Component_Media_GridThumbnail"){if(e.objectData.linkCodesConfig){o=e.objectData.linkCodesConfig;t=[];for(s=0;s<o.length;s++)t[o[s]]="Loading...";$.observable(this.linkCodesData).refresh(this.buildLinkCodesFromArray(t))}else $.observable(this.linkCodesData).refresh([]);n=new Pb.Path.PBPath(e.objectData.path);r=Pb.Media.MediaIdentifierFactory.getIdentifier(n);i={type:"GET",url:"/api/user/"+n.ownername+"/media/"+encodeURIComponent(r)+"/links",error:$.proxy(this.onRetrieveLinksError,this),success:$.proxy(function(t){this.onRetrieveLinksSuccess(t,e.objectData)},this)};Pb.Ajax.ajax(i)}else if(e.objectData.type==="album"){var u;if(e.objectData.linkCodesConfig){o=e.objectData.linkCodesConfig;t=[];for(s=0;s<o.length;s++)t[o[s]]="Loading...";$.observable(this.linkCodesData).refresh(this.buildLinkCodesFromArray(t))}else $.observable(this.linkCodesData).refresh([]);u=e.objectData.path.split("/");if(u.length<3)return;var a=u[2];n=u.slice(3).join("/");i={type:"GET",url:"/api/user/"+a+"/album/"+n+"/links",error:$.proxy(this.onRetrieveLinksError,this),success:$.proxy(function(t){this.onRetrieveLinksSuccess(t,e.objectData)},this)};Pb.Ajax.ajax(i)}},bindCopyCodes:function(){var e=Pb.Component.Common.CopyCode.CopyCode,t=0;for(t=0;t<this.linkCodesData.length;t++)e.createZeroClipboard("#"+this.linkCodesData[t].ccInputId,!1)},onRetrieveLinksError:function(e,t,n){typeof console!="undefined"&&console.error(n)},onRetrieveLinksSuccess:function(e,t){t.linkcodes=e.data;this.populateCodes(e.data)}};$.extend(e.prototype,r);$.views.helpers({buildLinkCodeData:n,getLinkCodeLabel:t,unescapeLinkCode:function(e){return $("<div />").html(e).text()}});return e}();(function(){"use strict";var e=function(e,t){var n=e.style[t];e.currentStyle?n=e.currentStyle[t]:window.getComputedStyle&&(n=document.defaultView.getComputedStyle(e,null).getPropertyValue(t));if(n=="auto"&&t=="cursor"){var r=["a"];for(var i=0;i<r.length;i++)if(e.tagName.toLowerCase()==r[i])return"pointer"}return n},t=function(e){if(!c.prototype._singleton)return;e||(e=window.event);var t;this!==window?t=this:e.target?t=e.target:e.srcElement&&(t=e.srcElement);c.prototype._singleton.setCurrent(t)},n=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},r=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)},i=function(e,t){if(e.addClass){e.addClass(t);return e}if(t&&typeof t=="string"){var n=(t||"").split(/\s+/);if(e.nodeType===1)if(!e.className)e.className=t;else{var r=" "+e.className+" ",i=e.className;for(var s=0,o=n.length;s<o;s++)r.indexOf(" "+n[s]+" ")<0&&(i+=" "+n[s]);e.className=i.replace(/^\s+|\s+$/g,"")}}return e},s=function(e,t){if(e.removeClass){e.removeClass(t);return e}if(t&&typeof t=="string"||t===undefined){var n=(t||"").split(/\s+/);if(e.nodeType===1&&e.className)if(t){var r=(" "+e.className+" ").replace(/[\n\t]/g," ");for(var i=0,s=n.length;i<s;i++)r=r.replace(" "+n[i]+" "," ");e.className=r.replace(/^\s+|\s+$/g,"")}else e.className=""}return e},o=function(t){var n={left:0,top:0,width:t.width||t.offsetWidth||0,height:t.height||t.offsetHeight||0,zIndex:1000050},r=e(t,"zIndex");r&&r!="auto"&&(n.zIndex=parseInt(r,10));while(t){var i=parseInt(e(t,"borderLeftWidth"),10),s=parseInt(e(t,"borderTopWidth"),10);$(t).scrollLeft()&&(n.left+=$(t).scrollLeft()*-1);n.left+=isNaN(t.offsetLeft)?0:t.offsetLeft;n.left+=isNaN(i)?0:i;n.top+=isNaN(t.offsetTop)?0:t.offsetTop;n.top+=isNaN(s)?0:s;t=t.offsetParent}return n},u=function(e){return(e.indexOf("?")>=0?"&":"?")+"nocache="+(new Date).getTime()},a=function(e){var t=[];e.trustedDomains&&(typeof e.trustedDomains=="string"?t.push("trustedDomain="+e.trustedDomains):t.push("trustedDomain="+e.trustedDomains.join(",")));return t.join("&")},f=function(e,t){if(t.indexOf)return t.indexOf(e);for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1},l=function(e){if(typeof e=="string")throw new TypeError("ZeroClipboard doesn't accept query strings.");return e.length?e:[e]},c=function(e,t){e&&(c.prototype._singleton||this).glue(e);if(c.prototype._singleton)return c.prototype._singleton;c.prototype._singleton=this;this.options={};for(var n in d)this.options[n]=d[n];for(var r in t)this.options[r]=t[r];this.handlers={};c.detectFlashSupport()&&v()},h,p=[];c.prototype.setCurrent=function(t){h=t;this.reposition();t.getAttribute("title")&&this.setTitle(t.getAttribute("title"));this.setHandCursor(e(t,"cursor")=="pointer")};c.prototype.setText=function(e){if(e&&e!==""){this.options.text=e;this.ready()&&this.flashBridge.setText(e)}};c.prototype.setTitle=function(e){e&&e!==""&&this.htmlBridge.setAttribute("title",e)};c.prototype.setSize=function(e,t){this.ready()&&this.flashBridge.setSize(e,t)};c.prototype.setHandCursor=function(e){this.ready()&&this.flashBridge.setHandCursor(e)};c.version="1.1.7";var d={moviePath:"http://pic2.pbsrc.com/flash/ZeroClipboardFV3.swf",trustedDomains:document.location.hostname,text:null,hoverClass:"zeroclipboard-is-hover",activeClass:"zeroclipboard-is-active",allowScriptAccess:"always"};c.setDefaults=function(e){for(var t in e)d[t]=e[t]};c.destroy=function(){c.prototype._singleton.unglue(p);var e=c.prototype._singleton.htmlBridge;e.parentNode.removeChild(e);delete c.prototype._singleton};c.detectFlashSupport=function(){var e=!1;try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")&&(e=!0)}catch(t){navigator.mimeTypes["application/x-shockwave-flash"]&&(e=!0)}return e};var v=function(){var e=c.prototype._singleton,t=document.getElementById("global-zeroclipboard-html-bridge");if(!t){var n='      <object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" id="global-zeroclipboard-flash-bridge" width="100%" height="100%">         <param name="movie" value="'+e.options.moviePath+u(e.options.moviePath)+'"/>         <param name="allowScriptAccess" value="'+e.options.allowScriptAccess+'"/>         <param name="scale" value="exactfit"/>         <param name="loop" value="false"/>         <param name="menu" value="false"/>         <param name="quality" value="best" />         <param name="bgcolor" value="#ffffff"/>         <param name="wmode" value="transparent"/>         <param name="flashvars" value="'+a(e.options)+'"/>         <embed src="'+e.options.moviePath+u(e.options.moviePath)+'"           loop="false" menu="false"           quality="best" bgcolor="#ffffff"           width="100%" height="100%"           name="global-zeroclipboard-flash-bridge"           allowScriptAccess="always"           allowFullScreen="false"           type="application/x-shockwave-flash"           wmode="transparent"           pluginspage="http://www.macromedia.com/go/getflashplayer"           flashvars="'+a(e.options)+'"           scale="exactfit">         </embed>       </object>';t=document.createElement("div");t.id="global-zeroclipboard-html-bridge";t.setAttribute("class","global-zeroclipboard-container");t.setAttribute("data-clipboard-ready",!1);t.style.position="absolute";t.style.left="-9999px";t.style.top="-9999px";t.style.width="15px";t.style.height="15px";t.style.zIndex="1000050";t.innerHTML=n;document.body.appendChild(t)}e.htmlBridge=t;e.flashBridge=document["global-zeroclipboard-flash-bridge"]||t.children[0].lastElementChild};c.prototype.resetBridge=function(){this.htmlBridge.style.left="-9999px";this.htmlBridge.style.top="-9999px";this.htmlBridge.removeAttribute("title");this.htmlBridge.removeAttribute("data-clipboard-text");s(h,this.options.activeClass);h=null;this.options.text=null};c.prototype.ready=function(){var e=this.htmlBridge.getAttribute("data-clipboard-ready");return e==="true"||e===!0};c.prototype.reposition=function(){if(!h)return!1;var e=o(h);this.htmlBridge.style.top=e.top+"px";this.htmlBridge.style.left=e.left+"px";this.htmlBridge.style.width=e.width+"px";this.htmlBridge.style.height=e.height+"px";this.htmlBridge.style.zIndex=e.zIndex+1;this.setSize(e.width,e.height)};c.dispatch=function(e,t){c.prototype._singleton.receiveEvent(e,t)};c.prototype.on=function(e,t){var n=e.toString().split(/\s/g);for(var r=0;r<n.length;r++){e=n[r].toLowerCase().replace(/^on/,"");this.handlers[e]||(this.handlers[e]=t)}this.handlers.noflash&&!c.detectFlashSupport()&&this.receiveEvent("onNoFlash",null)};c.prototype.addEventListener=c.prototype.on;c.prototype.off=function(e,t){var n=e.toString().split(/\s/g);for(var r=0;r<n.length;r++){e=n[r].toLowerCase().replace(/^on/,"");for(var i in this.handlers)i===e&&this.handlers[i]===t&&delete this.handlers[i]}};c.prototype.removeEventListener=c.prototype.off;c.prototype.receiveEvent=function(e,t){e=e.toString().toLowerCase().replace(/^on/,"");var n=h;switch(e){case"load":if(t&&parseFloat(t.flashVersion.replace(",",".").replace(/[^0-9\.]/gi,""))<10){this.receiveEvent("onWrongFlash",{flashVersion:t.flashVersion});return}this.htmlBridge.setAttribute("data-clipboard-ready",!0);break;case"mouseover":i(n,this.options.hoverClass);break;case"mouseout":s(n,this.options.hoverClass);this.resetBridge();break;case"mousedown":i(n,this.options.activeClass);break;case"mouseup":s(n,this.options.activeClass);break;case"datarequested":var r=n.getAttribute("data-clipboard-target"),o=r?document.getElementById(r):null;if(o){var u=$(o).closest(".copycode").attr("data-clipboard-text");u&&this.setText(u)}else{var a=n.getAttribute("data-clipboard-text");a&&this.setText(a)}break;case"complete":this.options.text=null}if(this.handlers[e]){var f=this.handlers[e];typeof f=="function"?f.call(n,this,t):typeof f=="string"&&window[f].call(n,this,t)}};c.prototype.glue=function(e){e=l(e);for(var r=0;r<e.length;r++)if(f(e[r],p)==-1){p.push(e[r]);n(e[r],"mouseover",t)}};c.prototype.unglue=function(e){e=l(e);for(var n=0;n<e.length;n++){r(e[n],"mouseover",t);var i=f(e[n],p);i!=-1&&p.splice(i,1)}};typeof module!="undefined"?module.exports=c:window.ZeroClipboard=c})();$.getObject("Pb.Component.Common.CopyCode",!0).CopyCode=function(){function e(e){var t=e.closest(".zeroclipboard").data("tracking");t&&Pb.Track.trf(t)}function t(t){t.next(".ccplaceholder").remove();t.attr("readonly",!1);t.click(function(){t.select();e(t)});$(t).on("keydown cut",function(e){e.keyCode!==9&&e.preventDefault()})}function n(n,r){var i=$(n),s=swfobject.getFlashPlayerVersion(),o,u,a,f,l,c,h,p,d;if(r||s.major<9){t(i);return}o=new ZeroClipboard;f=i.val();l=i.closest(".copycode");c=i.closest(".zeroclipboard");if(!l.length||!c.length){a=n.split(" ");if(a.length===1)p=n.split("_");else{h=a[a.length-1];p=h.split("_")}d=p[0];d.match(/^[.#]/)&&(d=d.substring(1));u=p[2];o.glue(d+"_copycode_"+u,d+"_zeroclipboard_"+u,f)}else o.glue(l[0],c[0],f);o.addEventListener("onComplete",function(t,n){i=$(this).find("input");i.length===0&&(i=$(this).find("textarea"));n.text===i.val()&&i.val("Copied").css("backgroundColor","#FFFF66").fadeTo("normal",.4,function(){$(this).fadeTo("normal",1,function(){$(this).css("backgroundColor","#FFFFFF").val(n.text)});e(i)})})}return{createZeroClipboard:n}}();$.getObject("Pb.Component.Detail",!0).Options=function(){function e(e){this.init(e)}var t={isLoggedIn:!1,isCompact:!1,actionTargetNormalId:"#detailOptions",actionTargetCompactId:"#detailOptionsCompact",actionTarget:null,actionTemplate:"#detailOptionsTemplate",actionData:[],defaultActionData:[],eventRegister:null,currentMedia:null,currentMediaUrl:null,currentMediaIsOwner:!1,rotatePostUrl:"/action/media/rotate",init:function(e){this.defaultActionData=e;this.actionData=$.extend(!0,{},this.defaultActionData);this.setCurrentMedia(Pb.Data.Shared.get(Pb.Data.Shared.MEDIA));this.getElements();for(var t=0;t<this.actionData.eventRegister.length;t++)$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:this.actionData.eventRegister[t].eventSelector,eventType:this.actionData.eventRegister[t].eventType,event:this.actionData.eventRegister[t].event}}));this.bindEvents();this.link();this.fetchShareThis();$(this.actionTargetNormalId).tooltip({placement:"right",selector:".btn",delay:{show:300,hide:100}});$(".sharing_list").on("click",function(e){var t=$(e.target).parents(".sh_btn").attr("id");(t==="wordpress"||t==="sharethis")&&Pb.Track.trf("detail_page_share_"+t+"_click")});$("#more_sharing_more").click(function(){$("#more_sharing_less").removeClass("dim");$(this).addClass("dim");$(".sharing_list").addClass("more")});$("#more_sharing_less").click(function(){$("#more_sharing_more").removeClass("dim");$(this).addClass("dim");$(".sharing_list").removeClass("more")})},fetchShareThis:function(){typeof stLight=="undefined"?$.ajax({url:"http://w.sharethis.com/button/buttons.js",dataType:"script",success:$.proxy(function(){stLight.options({publisher:"ur-69b5b6-88f5-876f-c641-e6cd7f797b5c"});stLight.subscribe("click",this.trackShareThis);this.updateShareThis()},this),cache:!0}):this.updateShareThis()},updateShareThis:function(){if(typeof stWidget!="undefined"){$(".sharing_list span").empty();var e=this;$(".sharing_list span").each(function(t,n){stWidget.addEntry({service:$(this).attr("id"),element:this,url:e.currentMedia.linkUrl,title:e.currentMedia.titleOrFilename,type:"large",image:e.currentMedia.fullsizeUrl})})}},trackShareThis:function(e,t){Pb.Track.trf("detail_page_share_"+t+"_"+e)},setCurrentMedia:function(e){this.isLoggedIn=Pb.Data.get("isLoggedIn");this.currentMedia=e;this.currentMediaUrl=e.fullsizeUrl;this.currentMediaIsOwner=e.io;this.actionData.iconLink.items=this.setOwnerOptionPerms(this.actionData.iconLink)},setOwnerOptionPerms:function(e){var t=[],n=this.currentMedia.mediaType==="image";for(var r=0;r<e.length;r++){var i=e[r];i.jsAttributes.checkperms?i.jsAttributes.identifier==="edit2"?this.currentMediaIsOwner&&n&&t.push(i):i.jsAttributes.identifier==="crop"?this.currentMediaIsOwner&&n&&t.push(i):i.jsAttributes.identifier==="prints"?this.currentMediaIsOwner&&n&&t.push(i):i.jsAttributes.identifier==="effects"?this.currentMediaIsOwner&&n&&t.push(i):i.jsAttributes.identifier==="move"?this.currentMediaIsOwner&&t.push(i):i.jsAttributes.identifier==="rotateleft"?this.currentMediaIsOwner&&n&&t.push(i):i.jsAttributes.identifier==="rotateright"?this.currentMediaIsOwner&&n&&t.push(i):i.jsAttributes.identifier==="delete"?this.currentMediaIsOwner&&t.push(i):i.jsAttributes.identifier==="download"?this.currentMedia.cd&&this.currentMedia.downloadUrl&&t.push(i):i.jsAttributes.identifier==="copy"?this.currentMedia.cd&&t.push(i):i.jsAttributes.identifier==="flag"?this.currentMediaIsOwner||t.push(i):i.jsAttributes.identifier==="story"?this.currentMediaIsOwner&&this.currentMedia.mediaType!=="flash"&&this.currentMedia.mediaType!=="slideshow"&&t.push(i):this.currentMediaIsOwner&&t.push(i):t.push(i)}return t},getElements:function(){this.actionTarget=$("#detailOptions")},bindEvents:function(){var e=$(document);e.on("Pb.Component.Media.Media::template-update",$.proxy(this.handleMediaContentUpdate,this));this.bindActions()},bindActions:function(){var e=$(document);e.on("Options::download",$.proxy(function(e){window.location.href=this.currentMedia.downloadUrl;Pb.Component.Ad.AdRefresh.reloadAds()},this));e.on("Options::move",$.proxy(function(e){$(document).trigger($.Event("CopyMoveMediaModal::show",{pbData:e.pbData,pbEventTarget:e.pbEventTarget}))},this));e.on("Options::edit2",$.proxy(function(e){document.location="/editor?image="+escape(this.currentMediaUrl)+"&detailUrl="+Pb.Data.get(Pb.Data.Shared.MEDIA).linkUrl},this));e.on("Options::effects",$.proxy(function(e){document.location="/editor?image="+escape(this.currentMediaUrl)+"&tool=effects&detailUrl="+Pb.Data.get(Pb.Data.Shared.MEDIA).linkUrl},this));e.on("Options::crop",$.proxy(function(e){document.location="/editor?image="+escape(this.currentMediaUrl)+"&tool=crop&detailUrl="+Pb.Data.get(Pb.Data.Shared.MEDIA).linkUrl},this));e.on("Options::delete",$.proxy(function(e){$(document).trigger($.Event("DeleteMediaModal::show",{pbData:e.pbData,pbEventTarget:e.pbEventTarget}))},this));e.on("Options::copy",$.proxy(function(e){$(document).trigger($.Event("CopyMoveMediaModal::show",{pbData:e.pbData,pbEventTarget:e.pbEventTarget}))},this));e.on("Options::rotateleft",$.proxy(function(e){var t={mediaUrl:this.currentMediaUrl,degrees:90},n={url:this.rotatePostUrl,type:"POST",data:t,showProgressModal:!0,progressTitle:"Rotating photo",success:$.proxy(function(e){this.handleEditResponse(e)},this)};Pb.Ajax.ajax(n)},this));e.on("Options::rotateright",$.proxy(function(e){var t={mediaUrl:this.currentMediaUrl,degrees:270},n={url:this.rotatePostUrl,type:"POST",data:t,showProgressModal:!0,progressTitle:"Rotating photo",success:$.proxy(function(e){this.handleEditResponse(e)},this)};Pb.Ajax.ajax(n)},this));e.on("Options::prints",$.proxy(function(e){open(this.currentMedia.printLink,"_blank")},this));e.on("Options::story",$.proxy(function(e){Pb.Component.Story.AddToModal.onShow(e)},this))},handleMediaContentUpdate:function(e){this.setCurrentMedia(e.newTarget);if(this.isCompact){$("#mediaTemplateTarget").append('<div id="detailOptionsCompact" class="detailOptions detailOptionsCompact"></div>');this.actionTarget=$(this.actionTargetCompactId)}this.link();this.updateShareThis();this.currentMedia.mediaType==="image"?$(".imageOnly").removeClass("hide"):$(".imageOnly").addClass("hide")},link:function(){Pb.JSTemplates.link(this.actionTemplate,this.actionTarget,this.actionData)},removeActionTarget:function(){this.actionTarget.off();this.actionTarget.parent()[0].removeChild(this.actionTarget[0])},handleEditResponse:function(e){e.status===1&&setTimeout(function(){document.location.reload()},1e3)}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Media.Delete",!0).DeleteMediaModal=function(){function e(){e.superclass.constructor.call(this)}var t={init:function(t){var n={eventName:"DeleteMediaModal::show",modalId:"#deleteMediaModal",modalName:"deleteMediaModal",submitButtonId:"#deleteMediaSubmitButton",submitUrl:"/action/media/delete",showProgress:!0,refreshAdsOnHide:!0};t&&$.extend(n,t);e.superclass.init.call(this,n);this.initEvents()},initEvents:function(){$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:".deleteMediaAction",eventType:"click",event:this.eventName}}))},buildSubmitData:function(){var e=$(this.modalId).find("> form [name=mediaPath]"),t=[];e.each(function(){t.push($(this).val())});return{mediaPath:t}},onShow:function(t){e.superclass.onShow.call(this,t);var n=$(this.modalId).find("form"),r=[],i,s=[],o,u,a;this.modalData=t.pbData;this.refreshOnSuccess=!0;t.hasOwnProperty("refreshOnSuccess")&&(this.refreshOnSuccess=t.refreshOnSuccess);if($.isArray(this.modalData))for(o=0;o<this.modalData.length;o++){r.push(this.modalData[o].titleOrFilename);s.push(this.modalData[o].path)}else{r.push(this.modalData.titleOrFilename);s.push(this.modalData.path)}if(r.length===1){i="'"+r[0]+"'";a="It"}else{i="the selected "+r.length+" photos or videos";a="They"}i=unescape(i.replace(/\+/g," "));$("#deleteMediaTitle").text(i);$("#deleteMediaPronoun").text(a);$(this.modalId).find("input[name=mediaPath]").remove();for(o=0;o<s.length;o++){u=$('<input type="hidden" name="mediaPath" />');u.val(s[o]);n.append(u)}},onSuccess:function(e){e.status===1&&(!this.refreshOnSuccess||Pb.Data.Albums?$(document).trigger("MediaDelete::deleteMediaCompleted",e.data):location.href=e.data.albumUrl)}};Pb.subclass(e,Pb.Component.Element.Modal,t);var n=new e;n.init();return n}();$.getObject("Pb.Component.Media.CopyMove",!0).CopyMoveMediaModal=function(){function e(){e.superclass.constructor.call(this)}var t={copy:!0,location:null,destUrl:null,chooser:null,init:function(t){var n={eventName:"CopyMoveMediaModal::show",modalId:"#copyMoveMediaModal",modalName:"copyMoveMediaModal",submitButtonId:"#copyMoveMediaSubmitButton",showProgress:!0,refreshAdsOnHide:!0};t&&$.extend(n,t);e.superclass.init.call(this,n);this.initEvents(n)},initEvents:function(e){$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:".copyMoveMediaAction",eventType:"click",event:e.eventName}}))},buildSubmitData:function(){var e=$("#copyMoveMediaSubdomain").val(),t=$(this.modalId).find("> form [name=mediaUrl]"),n;if(this.copy){this.submitUrl="/action/media/copy";n=t.val()}else{this.submitUrl="/action/media/move";n=[];t.each(function(){n.push($(this).val())})}var r={albumPath:$("#copyMoveMediaAlbumPath").val(),mediaUrl:n,albumUrl:this.destUrl,subdomain:e};return r},onShow:function(t){var n=Pb.Data.get("isLoggedIn");if(!n){location.href="/login?returnUrl="+encodeURIComponent(document.location);return}this.modalData=t.pbData;$.isArray(this.modalData)||(this.modalData=[this.modalData]);this.determineMode(t.pbEventTarget);t.headerTitle=this.getHeaderTitle();this.refreshOnSuccess=!0;t.hasOwnProperty("refreshOnSuccess")&&(this.refreshOnSuccess=t.refreshOnSuccess);this.bulkAction=!1;t.hasOwnProperty("bulkAction")&&(this.bulkAction=t.bulkAction);e.superclass.onShow.call(this,t);var r=$("#copyMoveMediaAlbumChooser");r.on("AlbumChooserDropdown::albums_loading.copyMoveMediaModal",$.proxy(this.onAlbumsLoading,this));r.on("AlbumChooserDropdown::albums_loaded.copyMoveMediaModal",$.proxy(this.onAlbumsLoaded,this));r.on("AlbumChooserDropdown::album_selected.copyMoveMediaModal",$.proxy(this.onAlbumSelected,this));var i=Pb.Data.get("currentAlbum");this.chooser=new Pb.Component.Album.Chooser.AlbumChooserDropdown({albumChooserId:"#copyMoveMediaAlbumChooser",filter:i?"self":"none"});this.loadAlbums(this.getAlbumPath())},loadAlbums:function(e){$("#copyMoveMediaSubmitButton").val(this.getButtonLabel()).attr("disabled",!0);this.chooser.loadAlbums(e)},onAlbumsLoading:function(){$("#copyMoveMediaAlbumChooser .dropdown").hide()},onAlbumsLoaded:function(){$("#copyMoveMediaAlbumChooser .dropdown").show();this.chooser.setSelectedAlbum()},onAlbumSelected:function(e){this.destUrl=e.albumData.albumurl;$("#copyMoveMediaSubmitButton").attr("disabled",!1)},onSuccess:function(e){if(e.status===1)if(!this.refreshOnSuccess||Pb.Data.Albums){var t="CopyMoveMediaModal::moveSuccess";this.copy&&(t="CopyMoveMediaModal::copySuccess");$(document).trigger({type:t,response:e})}else{var n=e.data.albumUrl;location.host.indexOf("media.")>=0&&(n=location.protocol+"//"+location.host.replace("media.","")+n);location.href=n}},determineMode:function(e){var t=$(e);if(typeof t!="object"){this.copy=!0;return}var n=t.data("copymovemode");n?this.copy=n==="move"?!1:!0:this.copy=t.text().toLowerCase()==="move"?!1:!0},getHeaderTitle:function(e){return this.copy?"Copy to album":"Move to album"},prepareDataForTemplate:function(e){e.label=this.getLabel();e.mediaUrls=this.getMediaUrls();e.albumPath=this.getAlbumPath();e.copy=this.copy;return e},getLabel:function(){var e="Where do you want to ",t,n=[],r;this.copy?e+="copy ":e+="move ";for(r=0;r<this.modalData.length;r++)n.push(this.modalData[r].titleOrFilename);n.length===1?t="'"+n[0]+"'":t="the selected "+n.length+" photos or videos";t=unescape(t.replace(/\+/g," "));e+=t;e+=" to?";return e},getMediaUrls:function(){var e,t,n=[];for(e=0;e<this.modalData.length;e++){t=this.modalData[e].fullsizeUrl;n.push(t)}return n},getAlbumPath:function(){return this.modalData.length>0?this.modalData[0].albumPath:null},getButtonLabel:function(){return this.copy?"Copy":"Move"}};Pb.subclass(e,Pb.Component.Element.Modal,t);var n=new e;n.init();return n}();(function(){function e(){e.superclass.constructor.call(this)}var t={modal:null,init:function(t){var n={modalId:"#reportModal",modalName:"reportModal",eventName:"ReportModal::show",submitUrl:"/action/flag/media",submitButtonId:"#reportModalSubmitButton"};t&&$.extend(n,t);e.superclass.init.call(this,n);this.initEvents()},initEvents:function(){$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:".showReportModal",eventType:"click",event:this.eventName}}))},bindModalEvents:function(){var t=$(this.modalId);if(t.length){t.find("input[name=type]").on("change",$.proxy(this.onTypeChange,this));e.superclass.bindModalEvents.call(this)}},onShow:function(t){t.pbData&&t.pbData.fullsizeUrl&&(this.mediaUrl=t.pbData.fullsizeUrl);this.mediaUrl||(this.mediaUrl=$(t.pbEventTarget).data("url"));e.superclass.onShow.call(this,t)},onHide:function(e){var t=$(this.modalId).find("form");t.length&&t.get(0).reset();this.mediaUrl=null},onSubmit:function(t){t.preventDefault();this.validate()&&e.superclass.onSubmit.call(this,t)},buildSubmitData:function(){var e=$(this.modalId).find("form"),t={type:e.find('input[name="type"]:checked').val(),comment:e.find("#reportComment").val(),email:e.find("#reportEmail").val(),mediaUrl:this.mediaUrl};return t},validate:function(){var e=$(this.modalId).find("form"),t=e.find('input[name="type"]:checked'),n=e.find("#reportComment"),r=e.find("#reportEmail"),i;if(t.val()==="racism"||t.val()==="other"){$(".control-group",this.form).removeClass("error");$(".help-inline",this.form).html("");if(n.val()===""){i="Please provide comments for your report";n.parents(".control-group").addClass("error");n.parents(".controls").find(".help-inline").html(i);return!1}if(r.val()===""){i="Please provide an email address";r.parents(".control-group").addClass("error");r.parents(".controls").find(".help-inline").html(i);return!1}}return!0},onTypeChange:function(e){var t=$(e.currentTarget).val(),n=$(this.modalId);if(t==="nudity"){n.find(".reportExtra").hide();n.find("input[type=submit]").show()}else if(t==="dmca"){n.find(".reportExtra").hide();Pb.Component.Element.Message.show({status:1,message:'If you own the copyright to material on the Photobucket site, please file an official Digital Millennium Copyright Act (DMCA) complaint by following the instructions posted on our <a href="/copyright/" target="_blank">Copyright policy page</a>.'});n.find("input[type=submit]").hide()}else{n.find(".reportExtra").show();n.find("input[type=submit]").show()}}};Pb.subclass(e,Pb.Component.Element.Modal,t);var n=new e;n.init()})();$.getObject("Pb.Component.Story",!0).AddToModal=function(){function e(){e.superclass.constructor.call(this)}$.extend(e.prototype,Pb.InputValidator.prototype,{modal:null,sourceData:null,mode:null,destination:"",organizerMode:!1,mediaDetailMode:!1,CREATING_YOUR_STORY:"Creating your Story",CHOOSE_A_STORY:"Choose a Story",init:function(t){var n={eventName:"Pb.Component.Story.AddToModal::show",modalId:"#storyAddToModal",modalName:"storyAddToModal",showProgress:!0,submitUrl:"/action/story/add"};t&&$.extend(n,t);this.modal=$(n.modalId);e.superclass.init.call(this,n);this.initEvents(n)},initEvents:function(e){$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:".storyAddToModal",eventType:"click",event:e.eventName}}));var t=this;$(document).on("Organizer::active",function(){t.organizerMode=!0});$(document).on("Organizer::inactive",function(){t.organizerMode=!1});this.modal.on("submit",function(e){e.stopPropagation();e.preventDefault();t.submitForm(e)});this.modal.on("click","#noBtn",function(e){var t=$("#addToStoryThumbnailList .insetBox").attr("data-storyid");if(t!==undefined){e.stopPropagation();e.preventDefault();var n="/user/"+$("#userName").text(),r="/story/"+t,i="?selector=true&album="+encodeURI($(e.currentTarget).data("albumPath"));document.location.href=n+r+i}});this.modal.on("click",".selectAction",function(e){e.stopPropagation();e.preventDefault();t.onSelectAction(e)});this.modal.on("click",".storyThumbnail .thumbnailMedia, .storyThumbnail .thumbnailOverlay",$.proxy(function(e){e.stopPropagation();e.preventDefault();$("#addToStoryThumbnailList .thumbnail").removeClass("insetBox");$(e.currentTarget).parents(".thumbnail").addClass("insetBox");var t=Pb.Data.Shared.get(Pb.Data.Shared.ALBUM)?Pb.Data.Shared.get(Pb.Data.Shared.ALBUM).isPublic==="0":!Pb.Data.Shared.get(Pb.Data.Shared.MEDIA).public;$(e.currentTarget).parents(".thumbnail").data("privacy")==="public"&&t&&Pb.Component.Element.Message.show({status:1,message:"You are about to add a private photo or video to a public Story."});this.destination=$(e.currentTarget).find("a:first").attr("href")},this));$(document).on("LibraryNavigation::albumSet",$.proxy(function(e){this.setModalTitle()},this))},onShow:function(t){var n=$(t.pbEventTarget),r,i,s,o,u;this.mode=n.data("mode");this.mediaDetailMode=t.type==="Options::story";this.setModalTitle();if(this.mode==="album"){if(Pb.Data.Albums){u=Pb.Data.Albums.getCurrentAlbum();this.sourceData=u.getProperty("path");o=u.getProperty("mediaCount")>0}else{o=$(t.pbEventTarget).data("validsource");this.sourceData=n.data("albumpath")}if(!o){Pb.Component.Element.Message.show({message:"This Story requires at least one photo or video."});return}}else if(this.mode==="media"){r=[];i=t.pbData;$(i).each(function(e,t){r.push(t.linkUrl)});this.sourceData=r}s=Pb.Data.get("storyCount");e.superclass.onShow.call(this);if(!s){this.setAlbumScreen();this.modal.find(".albumChoiceBody").show()}else this.modal.find(".choiceBody").show();this.modal.find(".modal-footer").hide();this.modal.find("#storyAddForm").css("width","400px")},submitForm:function(e){this.modal.find(".modal-header .title").html(this.CREATING_YOUR_STORY);this.onSubmit(e)},buildSubmitData:function(e){var t={destination:this.destination,mode:this.mode,sourceData:this.sourceData};return t},setModalTitle:function(){var e="Add selected items to Story";if(Pb.Data.Albums){var t=Pb.Data.Albums.getCurrentAlbum(),n=t.getProperty("dirName");n='Add "'+n+'" to Story';this.modal.find(".modal-header .title").text(n)}this.organizerMode&&this.modal.find(".modal-header .title").text(e);if(this.mediaDetailMode){var r="Add media to Story";this.modal.find(".modal-header .title").text(r)}},setAlbumScreen:function(){if(Pb.Data.Albums){var e=Pb.Data.Albums.getCurrentAlbum(),t=e.getProperty("dirName"),n=e.getProperty("mediaCount");t="Do you want to add all "+n+' photos from "'+t+'"?';this.modal.find(".albumChoiceBody .title").text(t);this.modal.find("#noBtn").data("albumPath",e.getProperty("path"));if(n>150){t='Do you want to add the first 150 photos from "'+t+'"?';this.modal.find(".albumChoiceBody .title").text(t)}}},onSuccess:function(e){document.location.href=e.data.redirect},onSelectAction:function(e){var t=$(e.currentTarget),n=t.data("mode");if(n==="album"&&!this.organizerMode&&!this.mediaDetailMode){this.setModalTitle();this.setAlbumScreen();this.modal.find(".choiceBody").hide();this.modal.find(".findStoryBody").hide();this.modal.find(".patentPending").hide();this.modal.find(".albumChoiceBody").show();this.modal.find("#storyAddForm").css("width","400px");this.modal.find(".modal-footer").hide();this.modal.addClass("no-footer");$(window).trigger("resize.modal")}else if(n==="select"){this.modal.find(".choiceBody").hide();this.modal.find(".findStoryBody").show();this.modal.find("#storyAddForm").css("width","900px");this.modal.find(".modal-footer").show();this.modal.removeClass("no-footer");this.modal.find(".modal-header .title").html(this.CHOOSE_A_STORY);$(window).trigger("resize.modal")}else(n==="create"||this.organizerMode||this.mediaDetailMode)&&this.modal.find("form").trigger("submit")},onHide:function(){this.modal.find(".findStoryBody").hide();this.modal.find(".albumChoiceBody").hide();e.superclass.onHide.call()}});Pb.subclass(e,Pb.Modal.ModalActionBase,e.prototype);var t=new e;Pb.InitEventQueue.add(function(){t.init()});return t}();$.getObject("Pb.Component.Story",!0).Paginate=function(){function e(e){this.init(e)}$.extend(e.prototype,{query:null,offset:0,total:0,pageSize:24,previous:null,next:null,container:null,loadingIndicator:".loadIndicator",init:function(e){e.query&&(this.query=e.query);e.startOffset>-1&&(this.offset=e.startOffset);this.total=e.total;this.pageSize=e.pageSize;this.container=e.container;this.onLoadMore=e.onLoadMore;this.onLoadMoreViaQuery=e.onLoadMoreViaQuery;this.previous=e.previous;this.next=e.next;this.page=0;this.pageHeight=$(this.container).parent().height();this.initEvents()},initEvents:function(){$(this.next).on("click",$.proxy(function(e){this.page++;this.showLoadingIndicator();this.query===null?this.onLoadMore(this.offset,this.pageSize):this.onLoadMoreViaQuery(this.offset,this.query)},this));$(this.previous).on("click",$.proxy(function(e){this.showLoadingIndicator();this.page--;var t=parseInt($(this.container).css("margin-top")),n=t+this.pageHeight;$(this.container).css("margin-top",n+"px");$(this.next).show();this.page===0&&$(this.previous).hide();this.hideLoadingIndicator()},this))},onLoadMore:function(e,t){},onLoadMoreViaQuery:function(e,t){},moreLoaded:function(e){if(this.page>0){$(this.previous).show();$(this.container).css("margin-top","-"+this.pageHeight*this.page+"px")}else $(this.previous).hide();e<this.pageSize?$(this.next).hide():$(this.next).show();e>0&&(this.offset+=e);this.hideLoadingIndicator()},resetOffset:function(){this.offset=0},showLoadingIndicator:function(){this.loadingIndicator!==null&&$(this.loadingIndicator).removeClass("hide")},hideLoadingIndicator:function(){this.loadingIndicator!==null&&$(this.loadingIndicator).addClass("hide")}});return e}();$.getObject("Pb.Component.Story",!0).ThumbnailList=function(){function e(e){this.init(e)}var t=new Pb.ThumbnailListBase,n={pbDataKey:null,fetchParams:null,fetchServiceUrl:null,container:"",templateTarget:null,ic:null,objects:[],query:null,offset:null,total:null,init:function(e){this.pbDataKey=e.pbDataKey;this.ic=e.ic;this.query=this.ic.query;this.templateTarget=e.templateTarget;this.container=e.container;this.thumbSize=e.thumbSize;this.pageSize=e.pageSize;this.initEvents();var t=Pb.Data.Shared.get(this.pbDataKey);if(t){$(t).each($.proxy(function(e,t){t.sizeClass=this.thumbSize+"Thumbnail"},this));this.appendToObjects(t)}else if(this.offset===null){t=[];Pb.Data.Shared.put(this.pbDataKey,t);this.linkTemplate(t);this.offset=0;this.activate();this.fetchStories()}},initEvents:function(){this.ic.onLoadMoreViaQuery=$.proxy(this.onLoadMoreViaQuery,this)},configureInfiniteCollection:function(){this.ic.reset(this.offset,this.total,this.query,$.proxy(this.onLoadMoreViaQuery,this))},fetchStories:function(){var e=Pb.Data.Shared.get(this.pbDataKey);(!this.total||e.length<this.total)&&this.ic.loadMore()},activate:function(){this.configureInfiniteCollection()},onLoadMoreViaQuery:function(e){this.fetchParams={offset:e,size:this.thumbSize,pageSize:this.pageSize};this.fetchServiceUrl="/component/Story-ThumbnailList?"+this.query;this.fetchMoreContent()},onObjectsAppended:function(e){var t=e.length;this.offset+=t;this.ic.moreLoaded(t);t>0&&$("#storiesView").removeClass("emptyView")},handleFetchMoreContent:function(e){this.total=e.total;this.ic.total=this.total;this.total===0&&$("#storiesView").addClass("emptyView");this.appendToObjects(e.objects)}};$.extend(e.prototype,n,t);return e}();$.getObject("Pb.Component.Common.Likes",!0).Likes=function(){function e(){this.init()}var t={isLoggedIn:null,likeUrl:"/action/likes/like",unlikeUrl:"/action/likes/unlike",clickTarget:null,init:function(){this.isLoggedIn=Pb.Data.get("isLoggedIn");var e=$(document);e.on("click","a.like",$.proxy(this.handleLikeClick,this));e.on("click","a.unlike",$.proxy(this.handleUnLikeClick,this));e.on("mouseenter","a.unlike",$.proxy(this.handleUnLikeHoverOn,this));e.on("mouseleave","a.unlike",$.proxy(this.handleUnLikeHoverOut,this));e.on("click","a.likelogin",$.proxy(this.handleLikeLogin,this))},handleUnLikeHoverOn:function(e){var t=$(e.currentTarget),n=t.find(".liketext"),r=t.find(".heart");t.removeClass("btn-secondary").addClass("btn-primary");r.removeClass("heartfill").addClass("heartempty");n.text("UnLike")},handleUnLikeHoverOut:function(e){var t=$(e.currentTarget),n=t.find(".liketext"),r=t.find(".heart");t.removeClass("btn-primary").addClass("btn-secondary");r.removeClass("heartempty").addClass("heartfill");n.text("Liked")},handleLikeClick:function(e){if(!this.isLoggedIn){var t=$(e.currentTarget);t.tooltip({delay:{show:2e3,hide:2e3}});t.tooltip("show");return}this.clickTarget=$(e.currentTarget);var n=this.clickTarget.data("likeurl"),r={likeableUrl:n};Pb.Ajax.ajax({url:this.likeUrl,data:r,success:$.proxy(this.handleLikeResponse,this)})},handleLikeResponse:function(e){if(e.status===1){if(this.clickTarget.data("context")==="detail"){var t=this.clickTarget.siblings(".unlike");t.show();this.clickTarget.hide();var n=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA),r=parseInt(n.likeCount,10);isNaN(r)||(n.likeCount=r>=0?r+1:0);n.isLiked=!0;n.isPersisted=!0;$("#likeCount").html(n.likeCount)}if(this.clickTarget.data("context")==="as"){var i=this.clickTarget.parents(".activityEvent"),s=i.attr("id").split("_").pop(),o=i.data("objectid"),u=$.Event("Pb.Component.Common.Likes::like_added");u.rowIndex=s;u.objectId=o;$(".activitiesTarget").trigger(u)}else $(document).trigger($.Event("Pb.Component.Common.Likes::like_click"));if(this.clickTarget.data("context")==="story"){this.clickTarget.hide();this.clickTarget.siblings().filter(".unlike").show();var a=$("#end-of-story").find(".stat.likes .count"),f=parseInt(a.text(),10);isNaN(f)||(f=f>=0?f+1:0);a.text(f)}}},handleUnLikeClick:function(e){if(!this.isLoggedIn){var t=$(e.currentTarget);t.tooltip({delay:{show:2e3,hide:2e3}});t.tooltip("show");return}this.clickTarget=$(e.currentTarget);var n=this.clickTarget.data("likeurl"),r={likeableUrl:n};Pb.Ajax.ajax({url:this.unlikeUrl,data:r,success:$.proxy(this.handleUnLikeResponse,this)})},handleUnLikeResponse:function(e){if(e.status===1){if(this.clickTarget.data("context")==="detail"){var t=this.clickTarget.siblings(".like");t.show();this.clickTarget.hide();var n=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA),r=parseInt(n.likeCount,10);isNaN(r)||(n.likeCount=r>0?r-1:0);n.isLiked=!1;$("#likeCount").html(n.likeCount)}if(this.clickTarget.data("context")==="as"){var i=this.clickTarget.parents(".activityEvent"),s=i.attr("id").split("_").pop(),o=i.data("objectid"),u=$.Event("Pb.Component.Common.Likes::like_removed");u.rowIndex=s;u.objectId=o;$(".activitiesTarget").trigger(u)}if(this.clickTarget.data("context")==="story"){this.clickTarget.hide();this.clickTarget.siblings().filter(".like").show();var a=$("#end-of-story").find(".stat.likes .count"),f=parseInt(a.text(),10)-1;a.text(f)}}},handleLikeLogin:function(e){var t=encodeURIComponent(document.location.href);document.location.href="/login?returnUrl="+t}};$.extend(e.prototype,t);return e}();Pb.InitEventQueue.addToDomReady(function(){var e=new Pb.Component.Common.Likes.Likes});$.getObject("Pb.Component.Media",!0).Media=function(){function o(e){this.init(e)}var e=900,t=675,n=620,r=465,i=320,s=240,u={currentTarget:null,canEdit:!1,canCopy:!1,showPagination:!0,mediaTemplateTarget:null,mediaImg:null,mediaTitle:null,mediaDesc:null,commentCnt:null,shroud:null,rescaler:null,windowResizeBound:!1,winWidth:null,pendingLoad:!1,mediaMaxDims:{},swfDims:{},expressInstallPath:"/resources/common/swf/expressInstall.swf",init:function(e){e.currentTarget&&(this.currentTarget=e.currentTarget);e.canEdit&&(this.canEdit=!0);e.canCopy&&(this.canCopy=!0);this.showPagination=e.showPagination;this.rescaler=new Pb.ClientImageRescaler;this.getElements();this.setMediaMaxDims();this.addHelpers();this.bindEvents();this.preloadMediaFullsize()},getElements:function(){this.mediaTemplateTarget=$("#mediaTemplateTarget");this.mediaImg=$("#fullsizeMedia");this.shroud=$("#mediaLoadingShroud")},addHelpers:function(){var e={shortText:function(e,t){return e?e.length>t?e.substring(0,t-3)+"...":e:""},toggleFullTitleLink:function(e,t){return e?e.length>t:!1}};$.views.helpers(e);return e},bindEvents:function(){var e=$(document);e.on("Detail::first_batch_received",$.proxy(function(){this.currentTarget=Pb.Data.get(Pb.Data.Shared.MEDIA)},this));e.on("Pb.Component.Media.Media::preloadMediaFullsize",$.proxy(this.handleMediaFullsizePreload,this));e.on("Pb.Component.Media.Media::template-update",$.proxy(this.handleTemplateUpdate,this));e.on("Pb.Component.Media.Media::replacePlaceHolder",$.proxy(this.resizeMediaToFitWindow,this));e.on("Pb.Component.Detail.Detail::current_media_update",$.proxy(this.handleMediaContentUpdate,this));e.on("click",".like",function(){Pb.Track.tr("detailpage_like_click")});e.on("click",".unlike",function(){Pb.Track.tr("detailpage_unlike_click")});var t=$("#mediaTemplateTarget");t.on("click","#zoomModalBtn",$.proxy(function(e){if(this.currentTarget.mediaType==="video")return;Pb.Track.tr("detail_page_zoom_click");Pb.Component.Media.ZoomModal.onShow(e)},this));if(!this.showPagination)return;$(window).resize($.proxy(function(){var e=$(window).width();if(e!==this.winWidth){this.winWidth=e;this.resizeMediaToFitWindow()}},this));if(!this.canEdit&&!this.canCopy){e.on("contextmenu",".imageController",function(e){e.preventDefault()});e.on("contextmenu",".mediawrapper",function(e){e.preventDefault()})}else{e.on("mousedown",".is_moz .imageController",function(e){if(e.button===2){e.stopPropagation();$(".contentWrapper").addClass("contextMenu");$(".imageController").hide()}});e.on("hover",".is_moz .contextMenu",$.proxy(this.mozHideContextMenu,this));e.on("hover",".is_moz .contextMenu img",$.proxy(this.mozHideContextMenu,this));e.on("mouseup",".imageController",$.proxy(function(e){e.button===2&&this.showContextMenu(e)},this));e.on("contextmenu",".imageController",$.proxy(this.showContextMenu,this))}},mozShowContextMenu:function(e){e.stopPropagation();$(".contentWrapper").addClass("contextMenu");$(".imageController").hide()},mozHideContextMenu:function(e){$(".contextMenu").removeClass("contextMenu");$(".imageController").show()},showContextMenu:function(e){e.stopPropagation();$(".imageController").hide();setTimeout(function(){$(".imageController").show()},1e3)},bindInPlaceEditors:function(){if(!this.canEdit)return;var e=this;this.mediaTitle=$("#mediaTitle");this.mediaTitle.length>0&&this.mediaTitle.find(".editable-field").first().editInPlace({callback:function(t,n,r){e.updateTitle(n,r);n===""&&(n="Click to add title");return n},show_buttons:!0,save_button:'<button class="btn btn-small btn-primary inplace_save icon-ok"></button>',cancel_button:'<button class="btn btn-small inplace_cancel icon-remove"></button>',default_text:"Click to add title",short_text:!1,maxlength:250,checkFullValue:!0,pb_track:function(){Pb.Track.tr("detailpage_title_click")},pb_validation:function(e){var t=!0;e=$.trim(e);if(e.length>250){var n={status:0,message:"Title cannot be more than 250 characters",details:""};Pb.Component.Element.Message.show(n);t=!1}return t},pb_helpers:this.addHelpers()})},preloadMediaFullsize:function(){if(this.currentTarget.mediaType!=="image")this.resizeMediaToFitWindow();else if(!this.currentTarget.fsWidth){var e=new Pb.ClientImagePreloader,t=[this.currentTarget.fullsizeUrl];e.preLoad("Pb.Component.Media.Media::preloadMediaFullsize",t)}},handleMediaFullsizePreload:function(e){var t=e.dimensions[this.currentTarget.fullsizeUrl];this.currentTarget.fsWidth=t.width;this.currentTarget.fsHeight=t.height;this.currentTarget.nextClass="hidden";this.currentTarget.prevClass="hidden";if(this.currentTarget.rsWidth==="")if(t.width>this.mediaMaxDims.width||t.height>this.mediaMaxDims.height){var n=new Pb.ClientImageRescaler(this.mediaMaxDims),r=n.rescale(t);this.currentTarget.rsWidth=r.width;this.currentTarget.rsHeight=r.height;this.mediaImg.css({width:this.currentTarget.rsWidth+"px",height:this.currentTarget.rsHeight+"px"})}else this.mediaImg.css({width:this.currentTarget.fsWidth+"px",height:this.currentTarget.fsHeight+"px"});this.mediaImg.attr("src",this.currentTarget.fullsizeUrl);this.hideShroud();if(!this.windowResizeBound){this.windowResizeBound=!0;this.resizeMediaToFitWindow()}},handleMediaContentUpdate:function(e){this.currentTarget=e.newTarget;this.resizeMediaToFitWindow()},resizeMediaToFitWindow:function(e){var t,n,r,o,u=$(window),a=u.width(),f=$(".detailActionsWrapper"),l=f.outerWidth()-10;this.setMediaMaxDims();this.mediaTemplateTarget.html("");this.linkToTemplate();this.bindInPlaceEditors();r=$(".mediawrapper");o=r.find("table");if(this.currentTarget.mediaType==="video"||this.currentTarget.mediaType==="slideshow")if(a<1024){n=this.mediaMaxDims.width;t=this.mediaMaxDims.height}else{n=this.swfDims.width;t=this.swfDims.height}else{if(!this.currentTarget.fsWidth){this.currentTarget.placeHold=!0;this.pendingLoad=!0;this.setMinDefault();return}a<1024?this.rescaler.setMaxWidth(this.mediaMaxDims.width):this.rescaler.setMaxWidth(l);this.rescaler.setMaxHeight(this.mediaMaxDims.height);var c={width:this.currentTarget.fsWidth,height:this.currentTarget.fsHeight},h=this.rescaler.rescale(c);t=h.height;n=h.width}var p,d,v;if(n<i&&t<s){p=i;d=s;v=t<s?(s-t)/2:0}else if(n<i&&t>=s){p=i;d=t;v=0}else if(n>=i&&t<s){p=n;d=s;v=(s-t)/2}else{p=n;d=t}r.css({width:p+"px",height:d+"px"});o.css({width:Math.min(n,this.mediaMaxDims.width)+"px",height:Math.min(t,this.mediaMaxDims.height)+"px",marginTop:v+"px",marginBottom:v+"px"});this.currentTarget.rsWidth=n;this.currentTarget.rsHeight=t;this.currentTarget.placeHold&&this.replacePlaceHolder();$("#fullsizeMedia").css({width:n+"px",height:t+"px"});var m=$(".tagContainer").outerWidth(!0)+$("#metadataTarget").outerWidth(!0);$("#tagList").css({width:$("#mediaTemplateTarget").outerWidth(!0)-m+"px"})},replacePlaceHolder:function(){var e=$("#"+this.currentTarget.placeHolderId);e.length>0&&e.attr("src",this.currentTarget.fullsizeUrl).css({width:this.currentTarget.rsWidth,height:this.currentTarget.rsHeight});this.currentTarget.placeHold=!1;this.pendingLoad=!1},setMediaMaxDims:function(){var i,s,o,u,a=$(window);if(a.width()<=1024){i=n;s=r;o=i}else{i=e;s=t;o=$(".detailActionsWrapper").outerWidth()-10}this.mediaMaxDims={width:i,height:s};Pb.Data.add("mediaMaxDims",this.mediaMaxDims);u=o/4*3;this.swfDims={width:o,height:u}},setMinDefault:function(){var e={width:this.mediaMaxDims.width+"px",height:this.mediaMaxDims.height+"px"};$(".mediawrapper").css(e);$(".mediawrapper > table").css(e);$(".mediawrapper img").css(e)},linkToTemplate:function(){var e,t=this.currentTarget.mediaType;switch(t){case"video":case"slideshow":case"flash":e="swfTemplate";break;default:if(!this.currentTarget.rsWidth){this.currentTarget.rsWidth=this.mediaMaxDims.width;this.currentTarget.placeHold=!0}e="imageTemplate"}this.currentTarget.likebutton[0].likeurl=this.currentTarget.fullsizeUrl;Pb.JSTemplates.link(e,this.mediaTemplateTarget,this.currentTarget);Pb.JSTemplates.link("#metatitleTemplate","#metatitleTarget",this.currentTarget);Pb.JSTemplates.link("#metadataTemplate","#metadataTarget",this.currentTarget);this.hideShroud();this.updateLikeButtonState(this.currentTarget);var n=$.Event("Pb.Component.Media.Media::template-update",{mediaType:t,newTarget:this.currentTarget});$(document).trigger(n);var r=$("#mediaTemplateTarget"),i=r.find("div#previous"),s=r.find("div#next");s.on("click",function(e){$(document).trigger($.Event("Pb.Component.Media.Media::media_next_click"))});i.on("click",function(e){$(document).trigger($.Event("Pb.Component.Media.Media::media_previous_click"))})},updateLikeButtonState:function(e){var t=$(".metaStats .like"),n=$(".metaStats .unlike");t.data("likeurl",e.fullsizeUrl);n.data("likeurl",e.fullsizeUrl);if(e.isLiked){t.hide();n.show()}else{t.show();n.hide()}},handleTemplateUpdate:function(e){if(e.mediaType==="video"){var t=$(document.documentElement);t.hasClass("is_iPad")||t.hasClass("is_iPhone")||t.hasClass("is_android")?this.loadVideoTag():this.loadFlashVideo()}else e.mediaType==="slideshow"?this.loadSlideshow():e.mediaType==="flash"&&this.loadSwf()},loadVideoTag:function(){var e=$("#flashcontent");e.html("");var t=this.currentTarget.fullsizeUrl;t=t.replace(/^http:\/\/i/,"http://vid");t=t.replace(/^http:\/\/gi/,"http://gvid");var n='<video width="'+this.swfDims.width+'" height="'+this.swfDims.height+'" controls="controls" autoplay="autoplay">';n+='<source src="'+t+'" type="video/mp4" />';n+="Your browser does not support the video tag.";n+="</video>";e.html(n)},loadFlashVideo:function(){var e=this.currentTarget.fullsizeUrl;e=e.replace(/^http:\/\/i/,"http://vid");e=e.replace(/^http:\/\/gi/,"http://gvid");var t="http://static.pbsrc.com/flash/onSiteVideo.swf",n={file:e,os:1,ap:1},r={wmode:"transparent",allowScriptAccess:"always",allowNetworking:"all",allowFullscreen:"true"};swfobject.embedSWF(t,"flashcontent",this.swfDims.width,this.swfDims.height,"6.0.65",this.expressInstallPath,n,r)},loadSlideshow:function(){var e="/resources/common/swf/pbwidget.swf",t={pbwurl:this.currentTarget.fullsizeUrl},n={wmode:"transparent"};swfobject.embedSWF(e,"flashcontent",this.swfDims.width,this.swfDims.height,"6.0.65",this.expressInstallPath,t,n)},loadSwf:function(){var e=this.currentTarget.fullsizeUrl,t={},n={wmode:"transparent",allowScriptAccess:"never",allowNetworking:"internal"};swfobject.embedSWF(e,"flashcontent",this.swfDims.width,this.swfDims.height,"6.0.65",this.expressInstallPath,t,n)},updateTitle:function(e,t){var n="/action/media/updateTitle",r={title:e,mediaUrl:this.currentTarget.fullsizeUrl};Pb.Component.Ad.AdRefresh.reloadAds();Pb.Ajax.ajax({url:n,data:r,success:$.proxy(function(e){if(e.status===1){this.currentTarget.title=e.data.title;this.currentTarget.isPersisted=!0;return!0}return!1},this)})},hideShroud:function(){this.shroud.hide()}};$.extend(o.prototype,u);return o}();(function(e){function n(e,t){this.settings=e;this.dom=t;this.originalValue=null;this.fullValue=null;this.didInsertDefaultText=!1;this.shouldDelayReinit=!1}function r(e){if(e.url||e.callback)return;throw new Error("Need to set either url: or callback: option for the inline editor to work.")}function i(e){if(""===e)return;var t=new Image;t.src=e}function s(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function o(e){return undefined===e||null===e?!1:0===e.length?!1:!0}e.fn.editInPlace=function(t){var s=e.extend({},e.fn.editInPlace.defaults,t);r(s);i(s.saving_image);return this.each(function(){var t=e(this);if(t.data("editInPlace"))return;t.data("editInPlace",!0);var r=new n(s,t);r.init();t.data("editInPlaceEditor",r)})};e.fn.editInPlace.defaults={pb_validation:null,pb_track:null,openOnClick:!0,url:"",bg_over:"#ffc",bg_out:"transparent",hover_class:"editHover",show_buttons:!1,save_button:'<button class="inplace_save">Save</button>',cancel_button:'<button class="inplace_cancel">Cancel</button>',params:"",field_type:"text",default_text:"(Click here to add text)",use_html:!1,textarea_rows:10,textarea_cols:25,select_text:"Choose new value",select_options:"",short_text:!0,text_size:null,saving_text:undefined,saving_image:"",saving_animation_color:"transparent",value_required:!1,element_id:"element_id",update_value:"update_value",original_value:"original_value",original_html:"original_html",save_if_nothing_changed:!1,on_blur:"save",cancel:"",callback:null,callback_skip_dom_reset:!1,success:null,error:null,error_sink:function(e,t){alert(t)},preinit:null,postclose:null,delegate:null};var t={shouldOpenEditInPlace:function(e,t,n){},willOpenEditInPlace:function(e,t){},didOpenEditInPlace:function(e,t){},shouldCloseEditInPlace:function(e,t,n){},willCloseEditInPlace:function(e,t){},didCloseEditInPlace:function(e,t){},missingCommaErrorPreventer:""};e.extend(n.prototype,{isOpened:!1,init:function(){this.setDefaultTextIfNeccessary();this.connectOpeningEvents()},reinit:function(){if(this.shouldDelayReinit)return;this.triggerCallback(this.settings.postclose,this.dom);this.triggerDelegateCall("didCloseEditInPlace");this.markEditorAsInactive();this.connectOpeningEvents()},setDefaultTextIfNeccessary:function(){if(""!==e.trim(this.dom.html()))return;this.dom.html(this.settings.default_text);this.didInsertDefaultText=!0},connectOpeningEvents:function(){var e=this;this.dom.bind("mouseenter.editInPlace",function(){e.addHoverEffect()}).bind("mouseleave.editInPlace",function(){e.removeHoverEffect()});this.settings.openOnClick&&this.dom.bind("click.editInPlace",function(t){e.openEditor(t)})},disconnectOpeningEvents:function(){this.dom.unbind(".editInPlace")},addHoverEffect:function(){this.settings.hover_class?this.dom.addClass(this.settings.hover_class):this.dom.css("background-color",this.settings.bg_over)},removeHoverEffect:function(){this.settings.hover_class?this.dom.removeClass(this.settings.hover_class):this.dom.css("background-color",this.settings.bg_out)},openEditor:function(e){if(!this.shouldOpenEditor(e))return;typeof this.settings.pb_track=="function"&&this.settings.pb_track();this.disconnectOpeningEvents();this.removeHoverEffect();this.removeInsertedDefaultTextIfNeccessary();this.saveOriginalValue();this.markEditorAsActive();this.replaceContentWithEditor();this.setInitialValue();this.workAroundMissingBlurBug();this.connectClosingEventsToEditor();this.triggerDelegateCall("didOpenEditInPlace")},shouldOpenEditor:function(e){return this.isClickedObjectCancelled(e.target)?!1:!1===this.triggerCallback(this.settings.preinit,this.dom)?!1:!1===this.triggerDelegateCall("shouldOpenEditInPlace",!0,e)?!1:this.isOpened?!1:!0},removeInsertedDefaultTextIfNeccessary:function(){if(!this.didInsertDefaultText||this.dom.html()!==this.settings.default_text)return;this.dom.html("");this.didInsertDefaultText=!1},isClickedObjectCancelled:function(t){if(!this.settings.cancel)return!1;var n=e(t).parents().andSelf(),r=n.filter(this.settings.cancel);return 0!==r.length},saveOriginalValue:function(){if(this.settings.use_html)this.originalValue=this.dom.html();else{if(this.settings.checkFullValue){var e;this.dom.next().length?e=this.dom.next().val():e=this.dom.val();e.length>0&&(this.fullValue=e)}this.originalValue=s(this.dom.text())}},restoreOriginalValue:function(){var e;if(this.originalValue===""){e=this.settings.default_text;this.didInsertDefaultText=!0}else e=this.originalValue;this.setClosedEditorContent(e)},setClosedEditorContent:function(e){this.settings.use_html?this.dom.html(e):this.dom.text(e)},workAroundMissingBlurBug:function(){var e=this.dom.find(":input");this.dom.parents(":last").find(".editInPlace-active :input").not(e).blur()},replaceContentWithEditor:function(){var e=this.settings.show_buttons?'<span class="editctrls">'+this.settings.cancel_button+" "+this.settings.save_button+"</span>":"",t=this.createEditorElement();this.dom.html('<form class="inplace_form" style="display: inline; margin: 0; padding: 0;"></form>').find("form").append(t).append(e)},createEditorElement:function(){if(-1===e.inArray(this.settings.field_type,["text","textarea","select"]))throw"Unknown field_type <fnord>, supported are 'text', 'textarea' and 'select'";var t=null;"select"===this.settings.field_type?t=this.createSelectEditor():"text"===this.settings.field_type?t=e('<input type="text" '+this.inputNameAndClass()+' size="'+this.settings.text_size+'"'+(this.settings.maxlength?' maxlength="'+this.settings.maxlength+'"':"")+" />"):"textarea"===this.settings.field_type&&(t=e("<textarea "+this.inputNameAndClass()+(this.settings.maxlength?' maxlength="'+this.settings.maxlength+'" ':"")+' rows="'+this.settings.textarea_rows+'" '+' cols="'+this.settings.textarea_cols+'" />'));return t},setInitialValue:function(){var e=this.triggerDelegateCall("willOpenEditInPlace",this.originalValue);this.settings.checkFullValue&&this.fullValue&&(e=this.fullValue);var t=this.dom.find(":input");t.val(e);t.val()!==e&&t.val("")},inputNameAndClass:function(){return' name="inplace_value" class="inplace_field" '},createSelectEditor:function(){var t=e("<select"+this.inputNameAndClass()+">"+'<option disabled="true" value="">'+this.settings.select_text+"</option>"+"</select>"),n=this.settings.select_options;e.isArray(n)||(n=n.split(","));for(var r=0;r<n.length;r++){var i=n[r];e.isArray(i)||(i=i.split(":"));var o=s(i[1]||i[0]),u=s(i[0]),a=e("<option>").val(o).text(u);t.append(a)}return t},connectClosingEventsToEditor:function(){function t(t){e.handleCancelEditor(t);return!1}function n(t){e.handleSaveEditor(t);return!1}var e=this,r=this.dom.find("form");r.find(".inplace_field").focus().select();r.find(".inplace_cancel").click(t);r.find(".inplace_save").click(n);this.settings.show_buttons||("save"===this.settings.on_blur?r.find(".inplace_field").blur(n):r.find(".inplace_field").blur(t));r.keyup(function(e){var n=27;if(n===e.which)return t()});this.bindSubmitOnEnterInInput();r.submit(n)},bindSubmitOnEnterInInput:function(){if("textarea"===this.settings.field_type)return;var e=this;this.dom.find(":input").keydown(function(t){var n=13;if(n===t.which)return e.dom.find("form").submit()})},handleCancelEditor:function(t){if(!1===this.triggerDelegateCall("shouldCloseEditInPlace",!0,t))return;var n=this.dom.find(":input").val();n=this.triggerDelegateCall("willCloseEditInPlace",n);this.restoreOriginalValue();var r=this.dom.parent();r.removeClass("error");r.find(".help-inline").each(function(){e(this).remove()});this.reinit()},handleSaveEditor:function(t){if(!this.triggerDelegateCall("shouldCloseEditInPlace",!0,t))return;var n=this.dom.find(":input").val();n=this.triggerDelegateCall("willCloseEditInPlace",n);if(this.isDisabledDefaultSelectChoice()||this.isUnchangedInput(n)){this.handleCancelEditor(t);return}if(this.didForgetRequiredText(n)){this.handleCancelEditor(t);this.reportError("Error: You must enter a value to save this field");return}n=e.trim(n);if(n===this.originalValue){this.handleCancelEditor(t);return}if(typeof this.settings.pb_validation=="function"){var r=this.settings.pb_validation(n,this.originalValue);if(!r)return}this.showSaving(n);this.settings.callback?this.handleSubmitToCallback(n):this.handleSubmitToServer(n)},didForgetRequiredText:function(e){return this.settings.value_required&&(""===e||undefined===e||null===e)},isDisabledDefaultSelectChoice:function(){return this.dom.find("option").eq(0).is(":selected:disabled")},isUnchangedInput:function(e){return!this.settings.save_if_nothing_changed&&this.originalValue===e},showSaving:function(t){if(this.settings.callback&&this.settings.callback_skip_dom_reset)return;var n=t;o(this.settings.saving_text)&&(n=this.settings.saving_text);o(this.settings.saving_image)&&(n=e("<img />").attr("src",this.settings.saving_image).attr("alt",n));this.dom.html(n)},handleSubmitToCallback:function(t){this.enableOrDisableAnimationCallbacks(!0,!1);var n=this.triggerCallback(this.settings.callback,this.id(),t,this.originalValue,this.settings.params,this.savingAnimationCallbacks());if(this.settings.checkFullValue&&this.settings.pb_helpers){var r=this.settings.pb_helpers;if(r.toggleFullTitleLink(n,40)){this.dom.next().val(n);e("#mediaTitleFull").text(n);this.settings.short_text&&(n=r.shortText(n,40));e("#mediaTitleFullLink").show()}else if(n==="Click to add title"){e("#mediaTitleOverlayWrap").hide();e("#mediaTitleFullLink").hide();this.fullValue="";e("#mediaTitleFull").text("");e("#fullText").val("")}}if(this.settings.callback_skip_dom_reset)return;if(undefined===n){this.reportError("Error: Failed to save value: "+t);this.restoreOriginalValue()}else this.dom.html(n);if(this.didCallNoCallbacks()){this.enableOrDisableAnimationCallbacks(!1,!1);this.reinit()}},handleSubmitToServer:function(t){var n=this.settings.update_value+"="+encodeURIComponent(t)+"&"+this.settings.element_id+"="+this.dom.attr("id")+(this.settings.params?"&"+this.settings.params:"")+"&"+this.settings.original_html+"="+encodeURIComponent(this.originalValue)+"&"+this.settings.original_value+"="+encodeURIComponent(this.originalValue);this.enableOrDisableAnimationCallbacks(!0,!1);this.didStartSaving();var r=this;e.ajax({url:r.settings.url,type:"POST",data:n,dataType:"html",complete:function(e){r.didEndSaving()},success:function(e){var t=e||r.settings.default_text;r.dom.html(t);r.triggerCallback(r.settings.success,e)},error:function(e){r.dom.html(r.originalHTML);r.settings.error?r.triggerCallback(r.settings.error,e):r.reportError("Failed to save value: "+e.responseText||"Unspecified Error")}})},triggerCallback:function(e){if(!e)return;var t=Array.prototype.slice.call(arguments,1);return e.apply(this.dom[0],t)},triggerDelegateCall:function(t,n,r){if(!this.settings.delegate||!e.isFunction(this.settings.delegate[t]))return n;var i=this.settings.delegate[t](this.dom,this.settings,r);return undefined===i?n:i},reportError:function(e){this.triggerCallback(this.settings.error_sink,this.id(),e)},id:function(){return this.dom.attr("id")},markEditorAsActive:function(){this.dom.addClass("editInPlace-active");this.isOpened=!0},markEditorAsInactive:function(){this.dom.removeClass("editInPlace-active");this.isOpened=!1},savingAnimationCallbacks:function(){var e=this;return{didStartSaving:function(){e.didStartSaving()},didEndSaving:function(){e.didEndSaving()}}},enableOrDisableAnimationCallbacks:function(e,t){this.didStartSaving.enabled=e;this.didEndSaving.enabled=t},didCallNoCallbacks:function(){return this.didStartSaving.enabled&&!this.didEndSaving.enabled},assertCanCall:function(e){if(!this[e].enabled)throw new Error("Cannot call "+e+" now. See documentation for details.")},didStartSaving:function(){this.assertCanCall("didStartSaving");this.shouldDelayReinit=!0;this.enableOrDisableAnimationCallbacks(!1,!0);this.startSavingAnimation()},didEndSaving:function(){this.assertCanCall("didEndSaving");this.shouldDelayReinit=!1;this.enableOrDisableAnimationCallbacks(!1,!1);this.reinit();this.stopSavingAnimation()},startSavingAnimation:function(){var e=this;this.dom.animate({backgroundColor:this.settings.saving_animation_color},400).animate({backgroundColor:"transparent"},400,"swing",function(){setTimeout(function(){e.startSavingAnimation()},10)})},stopSavingAnimation:function(){this.dom.stop(!0).css({backgroundColor:""})},missingCommaErrorPreventer:""})})(jQuery);$.getObject("Pb.Component.Media",!0).ZoomModal=function(){function e(){e.superclass.constructor.call(this)}var t,n={templateLinked:!1,modalData:[],init:function(t){var n={modalId:"#zoomModal",modalName:"zoomModal",showProgress:!0,refreshAdsOnHide:!0,shownEvent:"Pb.Component.Media.ZoomModal::shown",hideEvent:"Pb.Component.Media.ZoomModal::hide"};t&&$.extend(n,t);$.views.helpers({getImageUrl:function(){var e=Pb.Data.get(Pb.Data.Shared.MEDIA);return e.fullsizeUrl}});e.superclass.init.call(this,n)},prepareDataForTemplate:function(e){return e},onShow:function(t){e.superclass.onShow.call(this,t);this.fitModal();$(window).resize(this.fitModal);$("#zoomModal").on("click",".zoomOriginal",function(){$(".contentWrapper").addClass("zoomed");var e=Pb.Data.get(Pb.Data.Shared.MEDIA);Pb.JSTemplates.link("#zoomOriginalTemplate",".contentWrapper",e);$("#zoomModal").modal("hide")});$(".zoomOriginal").tooltip({placement:"top",delay:{show:300,hide:100}})},fitModal:function(){var e=Pb.Data.get(Pb.Data.Shared.MEDIA),t=e.fsHeight,n=10,r=$(window).height(),i=$(window).width();$(".zoomModal").css("max-height",r-n+"px");$(".zoomModal").css("max-width",i-n+"px");$(".zoomModal").find("img").css("max-height",r-n*2+"px");$(".zoomModal").find("img").css("max-width",i-n*2+"px");parseInt($(".zoomModal").css("min-height"),10)>r&&$(".zoomModal").css("min-height",r+"px");var s=$(".zoomModal").height(),o=(s-t)/2;o>0&&$(".zoomModal").find("img").css("margin-top",o+"px")}};Pb.subclass(e,Pb.Component.Element.Modal,n);t=new e;Pb.InitEventQueue.add(function(){t.init()});return t}();$.getObject("Pb.Component.Common",!0).Comments=function(){function e(e){this.init(e)}var t={context:"detail",defaultAddText:"Add your comments here...",commentTarget:null,commentInput:null,commentPost:null,commentPostUrl:"/action/comment/addcomment",commentDeleteUrl:"/action/comment/deletecomment",commentFlagUrl:"/action/comment/flagcomment",commentsFetchUrl:"/component/Common-Comments-List",commentParentContainer:".commentwrapper",currentCommentBody:null,init:function(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);this.bindEvents()},bindEvents:function(){$(this.commentParentContainer).tooltip({placement:"right",selector:".btn"});$(this.commentParentContainer).on("click",".comment-post",$.proxy(this.postComment,this));$(this.commentParentContainer).on("focus keydown click",".comment-addcontent",$.proxy(function(e){$(e.currentTarget).val()===this.defaultAddText&&$(e.currentTarget).val("")},this));$(this.commentParentContainer).on("keyup blur change mouseout",".comment-addcontent",$.proxy(function(e){$(e.target).val().length===0&&this.populateDefaultText($(e.target))},this));$(this.commentParentContainer).on("click","a.comment-delete",$.proxy(function(e){confirm("Are you sure you want to delete this comment?")&&this.deleteComment(e)},this));$(document).on("click","a.commentlogin",function(){var e=document.location.href;document.location.href="/login?returnUrl="+encodeURIComponent(e)});$(document).on("click","a.comment-flag",$.proxy(this.flagComment,this));$(this.commentParentContainer).on("click",".paginateCommentsAction",$.proxy(this.handleCommentPagination,this));if(this.context==="detail"){$(document).on("Pb.Component.Detail.Detail::current_media_update",$.proxy(this.handleMediaPagination,this));this.commentTarget=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA);this.fetchComments()}},postComment:function(e){e.preventDefault();var t=$(e.currentTarget),n=t.parents(".comment-create"),r=n.find(".comment-addcontent"),i=n.find("form"),s=r.val();this.currentCommentBody=r;if(s===this.defaultAddText)return;if($.trim(s)===""){this.currentCommentBody.val(this.defaultAddText);return}if(s.length>500){var o={status:0,message:"A comment cannot be more than 500 characters",details:""};Pb.Component.Element.Message.show(o);return}var u={commentableUrl:t.data("commentableurl"),comment:s,context:this.context},a=i.find("input");for(var f=0;f<a.length;f++)u[a[f].name]=a[f].value;var l={url:this.commentPostUrl,type:"POST",data:u,success:$.proxy(this.handlePostComment,this)};Pb.Ajax.ajax(l)},handlePostComment:function(e){if(e.status!==1)return;var t=e.data;if(this.context==="activity"){var n=this.currentCommentBody.parents(".activityEvent"),r=n.attr("id").split("_").pop(),i=n.data("objectid"),s=$.Event("Pb.Component.Common.Comments::comment_added");s.commentData=t;s.objectId=i;s.rowIndex=r;$(".activitiesTarget").trigger(s)}else if(this.context==="detail"){var o=this.stripCacheBuster(this.commentTarget.fullsizeUrl),u=this.stripCacheBuster(t.comment.commentableUrl);if(u!==o)this.handleExpiredCommentTarget(t);else{this.commentTarget.commentsPageData.offset++;this.commentTarget.commentsPageData.total++;this.commentTarget.commentCount++;this.commentTarget.isPersisted=!0;$.observable(this.commentTarget.commentsData).insert(0,t.comment);this.updateCommentCounts()}}this.currentCommentBody.val(this.defaultAddText)},handleExpiredCommentTarget:function(e){var t=Pb.Data.get(Pb.Data.Shared.MEDIA_SET);for(var n in t){var r=t[n],i=this.stripCacheBuster(r.fullsizeUrl),s=this.stripCacheBuster(e.comment.commentableUrl);if(i===s){r.commentCount++;r.isPersisted=!0;r.commentsPageData||(r.commentsPageData={offset:0,total:0});r.commentsPageData.offset++;r.commentsPageData.total++;r.commentsData||(r.commentsData=[]);r.commentsData.unshift(e.comment);break}}},deleteComment:function(e){var t=$(e.currentTarget),n={commentableUrl:t.data("commentableurl"),commentId:t.data("commentid")},r={url:this.commentDeleteUrl,type:"POST",data:n,success:$.proxy(function(e){this.handleDeleteComment(e,n)},this)};Pb.Ajax.ajax(r)},handleDeleteComment:function(e,t){if(e.status===1){var n,r=this.commentTarget.commentsData;for(var i=0;i<r.length;i++)if(parseInt(r[i].commentid,10)===t.commentId){n=i;break}$.observable(r).remove(n);this.commentTarget.commentsPageData.offset--;this.commentTarget.commentsPageData.total--;this.commentTarget.commentCount--;this.updateCommentCounts()}},flagComment:function(e){var t=$(e.currentTarget),n={commentableUrl:t.data("commentableurl"),commentId:t.data("commentid")};Pb.Ajax.ajax({url:this.commentFlagUrl,data:n,success:$.proxy(function(t){this.handleFlagComment($(e.currentTarget),t)},this)})},handleFlagComment:function(e,t){t.status===1&&e.text("Marked as inappropriate")},handleMediaPagination:function(e){this.commentTarget=e.newTarget;$(".comment-create").css("visibility","hidden");$(".comment-post").data("commentableurl",this.commentTarget.fullsizeUrl);this.fetchComments()},handleCommentPagination:function(e){var t=this.commentTarget.commentsData;if(typeof t=="undefined")return;if(t.length>=this.commentTarget.commentsPageData.total)return;var n={commentableUrl:this.commentTarget.fullsizeUrl,offset:this.commentTarget.commentsPageData.offset};Pb.Ajax.ajax({url:this.commentsFetchUrl,data:n,success:$.proxy(function(n){if(!n)return;var r=n.comments;this.commentTarget.commentsPageData.offset=parseInt(n.offset,10);this.commentTarget.commentsPageData.total=parseInt(n.total,10);$.observable(t).insert(t.length,r);this.updateCommentCounts();this.toggleLoadMore($(e.currentTarget))},this),type:"get"})},updateCommentCounts:function(){var e=this.commentTarget.commentCount;$("#commentCount").html(e);this.context==="detail"&&this.commentTarget&&$("#panelCommentCount").html(e+" comments")},fetchComments:function(){$("#commentList").html("");var e=this.commentTarget.commentsData;if(typeof e=="undefined"){this.commentTarget.commentsData=[];this.commentTarget.commentsPageData={offset:0,total:0};var t={commentableUrl:this.commentTarget.fullsizeUrl},n=this.commentTarget;Pb.Ajax.ajax({url:this.commentsFetchUrl,data:t,success:$.proxy(function(e){n.commentsEnabled=e.commentsEnabled;var t=e.comments,r={offset:e.offset,total:parseInt(e.total,10)};n.commentsPageData=r;n.commentsData=t;n.commentCount=r.total;if(n.fullsizeUrl===this.commentTarget.fullsizeUrl){this.toggleCommentArea();this.updateList(n.commentsData);this.updateCommentCounts()}},this),type:"get"})}else{this.toggleCommentArea();this.updateList(e);this.updateCommentCounts()}},toggleCommentArea:function(){if(this.commentTarget.commentsEnabled){$(".comment-disabled").hide();$(".comment-form").show();this.populateDefaultText($(".comment-addcontent"))}else{$(".comment-form").hide();$(".comment-disabled").show()}$(".comment-create").css("visibility","visible")},updateList:function(e){var t=$("#commentList"),n=t.parent().find(".paginateCommentsAction");n.length>0&&this.toggleLoadMore(n);Pb.JSTemplates.link("#commentRowTemplate",t,e)},toggleLoadMore:function(e){var t=this.commentTarget.commentsData;t.length>=this.commentTarget.commentsPageData.total?e.hide():e.show()},populateDefaultText:function(e){e.val(this.defaultAddText)},stripCacheBuster:function(e){var t=e.indexOf("?t=");return t!==-1?e.substr(0,t):e}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Common",!0).Tags=function(){function e(e){this.init(e)}var t={config:null,taggableUrl:null,addTagUrl:"/action/tag/addtag",deleteTagUrl:"/action/tag/deletetag",currentTarget:null,Pb_data_key:null,trackprefix:"",init:function(e){this.Pb_data_key=e.data_key;this.trackprefix=e.trackprefix;this.currentTarget=Pb.Data.get(this.Pb_data_key);if(this.currentTarget){this.taggableUrl=this.currentTarget.fullsizeUrl;var t={newTarget:this.currentTarget};this.fetchTags(t)}var n=this;this.config={over:function(){$(this).addClass("delete");$(this).next().show();$(this).bind("click",function(){Pb.Track.tr(e.trackprefix+"delete_tag_click");var t=confirm("Delete?");if(t){var r=$(this);n.deleteTag(r.text());r.next().remove();r.remove()}})},timeout:500,out:function(){$(this).removeClass("delete");$(this).next().hide();$(this).unbind("click")}};this.bindEvents()},bindEvents:function(){$(document).on("Pb.Component.Detail.Detail::current_media_update",$.proxy(this.fetchTags,this));$(document).on("Pb.Component.Common.Privacy::post_privacy_update",$.proxy(function(e){e.newTarget=this.currentTarget;this.fetchTags(e)},this));$(".inputTag").on("keyup",$.proxy(function(){var e=$(".inputTag").val();if(e.length>=50){$("#imageTagsCG").addClass("warning");$("#imageTagsHI").removeClass("hide");$(".inputTag").val(e.substring(0,50))}else{$("#imageTagsCG").removeClass("warning");$("#imageTagsHI").addClass("hide")}},this));$("#addTagsButton").click($.proxy(this.submitTag,this));$(".submitTag").click($.proxy(this.submitTag,this));$(".inputTag").keypress($.proxy(function(e){e.keyCode===13&&this.submitTag(e)},this));this.bindTags()},submitTag:function(e){e.preventDefault();Pb.Track.tr(this.trackprefix+"add_tag_click");var t=$(".inputTag").val();if(t.length>50){var n={status:0,message:"Tag cannot be more than 50 characters",details:""};Pb.Component.Element.Message.show(n);return}this.addTag(t);$(".inputTag").val("");$(".inputTag").focus()},bindTags:function(){(this.currentTarget.io||this.currentTarget.isOwner)&&$(".tag").hoverIntent(this.config)},addTag:function(e){if(e==="")return;var t={taggableUrl:this.taggableUrl,tagname:e,dataKey:this.Pb_data_key},n={url:this.addTagUrl,type:"POST",data:t,success:$.proxy(this.handleAddTag,this)};$("#collapse_1").css("height","");Pb.Ajax.ajax(n)},handleAddTag:function(e){if(e.status===1&&$.isArray(e.data)){this.currentTarget.tagData=e.data;this.currentTarget.isPersisted=!0;Pb.JSTemplates.link("#tagTemplate","#tagList",this.currentTarget.tagData);this.bindTags()}},deleteTag:function(e){var t={taggableUrl:this.taggableUrl,tagname:e,dataKey:this.Pb_data_key},n={url:this.deleteTagUrl,type:"POST",data:t,success:$.proxy(this.handleDeleteTag,this)};Pb.Ajax.ajax(n)},handleDeleteTag:function(e){if(e.status===1){if($.isArray(e.data)){this.currentTarget.tagData=e.data;Pb.JSTemplates.link("#tagTemplate","#tagList",this.currentTarget.tagData)}$(document).trigger($.Event("Pb.Component.Common.Tags::tagDeleted",e.data))}},fetchTags:function(e){$("#tagList").html("");this.currentTarget=e.newTarget;$("#addTagsButton").toggleClass("hide",!this.currentTarget.io);var t=this.currentTarget.tagData;this.taggableUrl=this.currentTarget.fullsizeUrl;if(typeof t=="undefined"&&this.currentTarget.isPersisted){var n="/component/Common-Tags-Tags",r={o:this.taggableUrl,dataKey:this.Pb_data_key},i=this.currentTarget;Pb.Ajax.ajax({url:n,data:r,type:"get",success:$.proxy(function(e){i.tagData=e;i.fullsizeUrl===this.currentTarget.fullsizeUrl&&this.updateList(e)},this)})}else this.updateList(t);setTimeout($.proxy(this.bindTags,this),1e3)},updateList:function(e){if(e&&e.length>0){$(".mediaTags").css("visibility","visible");Pb.JSTemplates.link("#tagTemplate","#tagList",e)}else{this.currentTarget.io||$(".mediaTags").css("visibility","hidden");$("#tagList").html("")}}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Tags",!0).TagsModal=function(){function e(){e.superclass.constructor.call(this)}var t={init:function(t){var n={eventName:"TagsModal::show",modalId:"#tagsModal",modalName:"tagsModal",submitUrl:"/action/tag/editTaggableTags",showProgress:!0,refreshAdsOnHide:!0};t&&$.extend(n,t);e.superclass.init.call(this,n);this.initEvents(n)},updateObservable:function(e){$.observable(this.tags).insert(this.tags.length,{tagName:e})},initEvents:function(e){$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:".showTagsModal",eventType:"click",event:e.eventName}}));var t=this;Pb.InitEventQueue.add(function(){$("#tagsForm").on("click","#addTagButton",$.proxy(function(e){e.preventDefault();this.addTag()},t)).on("click",".tag-btn",$.proxy(function(e){e.preventDefault();var n=$(e.currentTarget),r=t.tags;$(r).each(function(e,r){if(n.data("tag")===r.tagName){$.observable(t.tags).remove(e);return}});!this.tags.length&&$(this.modalId).find("[name=addTagsOnly]").val()&&$("#tagSubmitButton").addClass("disabled")},t)).on("submit",function(e){e.preventDefault()}).on("keyup","#tagInput",$.proxy(function(e){e.which===13&&this.addTag()},t)).on("click","#tagSubmitButton",$.proxy(t.onSubmit,t))})},addTag:function(){var e=$("#tagInput"),t=$.trim(e.val()),n;t.length>0&&this.updateObservable(e.val());e.val("");$("div.tagsContainer").scrollTop($(".tagsContainer").offset().top);n=e.closest(".control-group");if(n.hasClass("error")){n.removeClass("error");n.find(".help-inline").empty()}$(this.modalId).find("[name=addTagsOnly]").val()&&(this.tags.length===0?$("#tagSubmitButton").addClass("disabled"):$("#tagSubmitButton").removeClass("disabled"))},buildSubmitData:function(){var e=$(this.modalId).find("form"),t=e.find("[name=taggableUrl]"),n=e.find("[name=taggableType]").val(),r,i,s=[],o;r=[];t.each(function(){r.push($(this).val())});for(o=0;o<this.tags.length;o++)s.push(this.tags[o].tagName);i={taggableType:n,taggableUrls:r,tags:s,addTagsOnly:e.find("[name=addTagsOnly]").val()};return i},onShow:function(t){var n=Pb.Data.get("isLoggedIn"),r,i=[],s,o=$(this.modalId).find("> form"),u;if(!n){location.href="/login?returnUrl="+encodeURIComponent(document.location);return}this.modalData=t.pbData;this.tags=[];Pb.Data.tags=this.tags;if($.isArray(t.pbData)){for(r=0;r<this.modalData.length;r++){u=this.modalData[r].fullsizeUrl;i.push(u)}$(this.modalId).find(".title").text("Add Tags");$(this.modalId).find("[name=addTagsOnly]").val("true");this.tags=[];$("#tagSubmitButton").addClass("disabled")}else{u=this.modalData.fullsizeUrl;i.push(u);this.modalData.tagData&&(this.tags=this.modalData.tagData);$(this.modalId).find(".title").text("Manage Tags");$(this.modalId).find("[name=addTagsOnly]").val("false")}Pb.JSTemplates.link("#tagsContainerTemplate",".tagsContainer",this.tags);$(this.modalId).find("input[name=taggableUrl]").remove();for(r=0;r<i.length;r++){s=$('<input type="hidden" name="taggableUrl" />');s.val(i[r]);o.append(s)}e.superclass.onShow.call(this,t);$("#tagInput").focus()},onSubmit:function(t){if($("#tagSubmitButton").hasClass("disabled"))return;e.superclass.onSubmit.call(this,t)},onSuccess:function(e){e.status===1&&$(document).trigger({type:"TagsModal::success",response:e})}};Pb.subclass(e,Pb.Modal.ModalActionBase,t);var n=new e;n.init();return n}();(function(e){function t(t){var n=t||window.event,r=[].slice.call(arguments,1),i=0,s=!0,o=0,u=0;return t=e.event.fix(n),t.type="mousewheel",n.wheelDelta&&(i=n.wheelDelta/120),n.detail&&(i=-n.detail/3),u=i,n.axis!==undefined&&n.axis===n.HORIZONTAL_AXIS&&(u=0,o=-1*i),n.wheelDeltaY!==undefined&&(u=n.wheelDeltaY/120),n.wheelDeltaX!==undefined&&(o=-1*n.wheelDeltaX/120),r.unshift(t,i,o,u),(e.event.dispatch||e.event.handle).apply(this,r)}var n=["DOMMouseScroll","mousewheel"];if(e.event.fixHooks)for(var r=n.length;r;)e.event.fixHooks[n[--r]]=e.event.mouseHooks;e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=n.length;e;)this.addEventListener(n[--e],t,!1);else this.onmousewheel=t},teardown:function(){if(this.removeEventListener)for(var e=n.length;e;)this.removeEventListener(n[--e],t,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})})(jQuery);(function(e){function t(e,t){var n=parseInt(e.css(t),10);if(n)return n;var r=e[0].currentStyle;return r&&r.width&&parseInt(r.width,10)}function n(t,n){var r=e(n);return r.length<2?r:t.parent().find(n)}function i(t,i){var s=this,o=t.add(s),u=t.children(),f=0,l=i.vertical;r||(r=s),u.length>1&&(u=e(i.items,t)),i.size>1&&(i.circular=!1),e.extend(s,{getConf:function(){return i},getIndex:function(){return f},getSize:function(){return s.getItems().size()},getNaviButtons:function(){return m.add(g)},getRoot:function(){return t},getItemWrap:function(){return u},getItems:function(){return u.find(i.item).not("."+i.clonedClass)},move:function(e,t){return s.seekTo(f+e,t)},next:function(e){return s.move(i.size,e)},prev:function(e){return s.move(-i.size,e)},begin:function(e){return s.seekTo(0,e)},end:function(e){return s.seekTo(s.getSize()-1,e)},focus:function(){r=s;return s},addItem:function(t){t=e(t),i.circular?(u.children().last().before(t),u.children().first().replaceWith(t.clone().addClass(i.clonedClass))):(u.append(t),g.removeClass("disabled")),o.trigger("onAddItem",[t]);return s},seekTo:function(t,n,c){t.jquery||(t*=1);if(i.circular&&t===0&&f==-1&&n!==0)return s;if(!i.circular&&t<0||t>s.getSize()||t<-1)return s;var h=t;t.jquery?t=s.getItems().index(t):h=s.getItems().eq(t);var p=e.Event("onBeforeSeek");if(!c){o.trigger(p,[t,n]);if(p.isDefaultPrevented()||!h.length)return s}var v=l?{top:-h.position().top}:{left:-h.position().left};f=t,r=s,n===undefined&&(n=i.speed),u.animate(v,n,i.easing,c||function(){o.trigger("onSeek",[t])});return s}}),e.each(["onBeforeSeek","onSeek","onAddItem"],function(t,n){e.isFunction(i[n])&&e(s).bind(n,i[n]),s[n]=function(t){t&&e(s).bind(n,t);return s}});if(i.circular){var h=s.getItems().slice(-1).clone().prependTo(u),p=s.getItems().eq(1).clone().appendTo(u);h.add(p).addClass(i.clonedClass),s.onBeforeSeek(function(e,t,n){if(!e.isDefaultPrevented()){if(t==-1){s.seekTo(h,n,function(){s.end(0)});return e.preventDefault()}t==s.getSize()&&s.seekTo(p,n,function(){s.begin(0)})}});var v=t.parents().add(t).filter(function(){if(e(this).css("display")==="none")return!0});v.length?(v.show(),s.seekTo(0,0,function(){}),v.hide()):s.seekTo(0,0,function(){})}var m=n(t,i.prev).click(function(e){e.stopPropagation(),s.prev()}),g=n(t,i.next).click(function(e){e.stopPropagation(),s.next()});i.circular||(s.onBeforeSeek(function(e,t){setTimeout(function(){e.isDefaultPrevented()||(m.toggleClass(i.disabledClass,t<=0),g.toggleClass(i.disabledClass,t>=s.getSize()-1))},1)}),i.initialIndex||m.addClass(i.disabledClass)),s.getSize()<2&&m.add(g).addClass(i.disabledClass),i.mousewheel&&e.fn.mousewheel&&t.mousewheel(function(e,t){if(i.mousewheel){s.move(t<0?1:-1,i.wheelSpeed||50);return!1}});if(i.touch){var y={};u[0].ontouchstart=function(e){var t=e.touches[0];y.x=t.clientX,y.y=t.clientY},u[0].ontouchmove=function(e){if(e.touches.length==1&&!u.is(":animated")){var t=e.touches[0],n=y.x-t.clientX,r=y.y-t.clientY;s[l&&r>0||!l&&n>0?"next":"prev"](),e.preventDefault()}}}i.keyboard&&e(document).bind("keydown.scrollable",function(t){if(!(!i.keyboard||t.altKey||t.ctrlKey||t.metaKey||e(t.target).is(":input"))){if(i.keyboard!="static"&&r!=s)return;var n=t.keyCode;if(!(!l||n!=38&&n!=40)){s.move(n==38?-1:1);return t.preventDefault()}if(!l&&(n==37||n==39)){s.move(n==37?-1:1);return t.preventDefault()}}}),i.initialIndex&&s.seekTo(i.initialIndex,0,function(){})}e.tools=e.tools||{version:"v1.2.6"},e.tools.scrollable={conf:{activeClass:"active",circular:!1,clonedClass:"cloned",disabledClass:"disabled",easing:"swing",initialIndex:0,item:"> *",items:".items",keyboard:!0,mousewheel:!1,next:".next",prev:".prev",size:1,speed:400,vertical:!1,touch:!0,wheelSpeed:0}};var r;e.fn.scrollable=function(t){var n=this.data("scrollable");if(n)return n;t=e.extend({},e.tools.scrollable.conf,t),this.each(function(){n=new i(e(this),t),e(this).data("scrollable",n)});return t.api?n:this}})(jQuery);(function(e){function n(t,n){var r=e(n);return r.length<2?r:t.parent().find(n)}var t=e.tools.scrollable;t.navigator={conf:{navi:".navi",naviItem:null,activeClass:"active",indexed:!1,idPrefix:null,history:!1}};e.fn.navigator=function(r){typeof r=="string"&&(r={navi:r}),r=e.extend({},t.navigator.conf,r);var i;this.each(function(){function h(e,n,r){t.seekTo(n),r.preventDefault(),f&&history.pushState({i:n})}function p(){return s.find(r.naviItem||"> *")}function v(t){var n=e("<"+(r.naviItem||"a")+"/>").click(function(n){h(e(this),t,n)});t===0&&n.addClass(u),r.indexed&&n.text(t+1),r.idPrefix&&n.attr("id",r.idPrefix+t);return n.appendTo(s)}var t=e(this).data("scrollable"),s=r.navi.jquery?r.navi:n(t.getRoot(),r.navi),o=t.getNaviButtons(),u=r.activeClass,f=r.history&&history.pushState,l=t.getConf().size;t&&(i=t),t.getNaviButtons=function(){return o.add(s)},f&&(history.pushState({i:0}),e(window).bind("popstate",function(e){var n=e.originalEvent.state;n&&t.seekTo(n.i)}));p().length?p().each(function(t){e(this).click(function(n){h(e(this),t,n)})}):e.each(t.getItems(),function(e){e%l==0&&v(e)}),t.onBeforeSeek(function(e,t){setTimeout(function(){if(!e.isDefaultPrevented()){var n=t/l,r=p().eq(n);r.length&&p().removeClass(u).eq(n).addClass(u)}},1)}),t.onAddItem(function(e,n){var r=t.getItems().index(n);r%l==0&&v(r)})});return r.api?i:this}})(jQuery);$.getObject("Pb.Component.Filmstrip",!0).Filmstrip=function(){function e(e){this.init(e)}var t={libData:null,libDataMax:null,libDataMin:null,thumbData:null,currentOffset:0,total:null,currentThumb:null,startThumb:null,endThumb:null,mediaPrevArrow:null,mediaNextArrow:null,filmstripWrapper:null,filmstripLoading:null,filmstripPrevArrow:null,filmstripNextArrow:null,scrollableWrapper:".detailCompWrapper",scrollableId:null,itemContainer:null,scrollableWidth:0,scrollableHeight:0,thumbPaddingBorder:20,verticalHeight:450,verticalThumbHeight:90,maxThumbDims:{width:82,height:82},placeHoldThumb:null,hasResized:!1,contentUpdateInfo:null,win:null,isCompact:!1,windowWidth:null,isFetching:!1,lastFetchOffset:null,lastSlideIndex:null,slideExpired:!1,filmstripCompactEvent:"Pb.Component.Filmstrip.Filmstrip::compact",filmstripNormalEvent:"Pb.Component.Filmstrip.Filmstrip::normal",preloadThumbsEvent:"Pb.Component.Filmstrip.Filmstrip::preloadFilmstripThumbs",filmstripSlideEvent:"Pb.Component.Filmstrip.Filmstrip::filmstrip_slide_update",filmstripArrowClickEvent:"Pb.Component.Filmstrip.Filmstrip::filmstrip_arrow_click",fullsizePreloadEvent:"Pb.Component.Filmstrip.Filmstrip::filmstrip_fullsize_preloaded",filmstripOffsetUpdateEvent:"Pb.Component.Filmstrip.Filmstrip::filmstrip_offset_update",init:function(e){this.placeHoldThumb=Pb.Data.get("picUrl")+"backgrounds/placeholder_thumb.jpg";e.currentOffset&&(this.currentOffset=parseInt(e.currentOffset,10));e.total&&(this.total=e.total);typeof e.scrollableWrapper!="undefined"&&(this.scrollableWrapper=e.scrollableWrapper);this.scrollableId="#"+e.scrollableId;this.libData=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET);this.libDataMin=Pb.Data.get("libDataMin");this.libDataMax=Pb.Data.get("libDataMax");this.getElements();this.bindEvents();this.configureScrollable()},getElements:function(){this.win=$(window);this.filmstripWrapper=$("div.detailfilmstripwrap");this.mediaPrevArrow=$("#mediaTemplate div#previous");this.mediaNextArrow=$("#mediaTemplate div#next");this.filmstripPrevArrow=this.filmstripWrapper.find("a.prev");this.filmstripNextArrow=this.filmstripWrapper.find("a.next");this.filmstripLoading=$("#filmstripLoadingShroud")},bindEvents:function(){var e=$(document);this.win.resize($.proxy(function(){this.hasResized=!0;this.configureScrollable()},this));e.bind("preloadFullsize",$.proxy(function(e){this.handlePreloadedFullsize(e)},this));e.on("Pb.Component.Media.Media::media_previous_click",$.proxy(function(e){Pb.Track.trf("detail_pagination_previous_click");this.move(-1)},this)).on("Pb.Component.Media.Media::media_next_click",$.proxy(function(e){Pb.Track.trf("detail_pagination_next_click");this.move(1)},this)).on("Pb.Component.Detail.DetailActions::media_next_click",$.proxy(function(e){this.move(1)},this)).on("Pb.Component.Detail.DetailActions::media_previous_click",$.proxy(function(e){this.move(-1)},this));e.on("Pb.Component.Media.Media::template-update",$.proxy(this.toggleMediaArrow,this));e.on("keyup.mediadetail",$.proxy(this.onKeyUp,this));e.on("Pb.Component.Media.ZoomModal::shown",function(){$(document).off("keyup.mediadetail")});e.on("Pb.Component.Media.ZoomModal::hide",$.proxy(function(e){$(document).on("keyup.mediadetail",$.proxy(this.onKeyUp,this))},this));e.on(this.preloadThumbsEvent,$.proxy(this.handlePreloadThumbs,this));e.on("Pb.Component.Detail.Fetcher::libdata_update",$.proxy(this.updateLibData,this));this.filmstripPrevArrow.on("click",$.proxy(function(e){Pb.Track.trf("detail_filmstrip_previous_click");var t=$.Event(this.filmstripArrowClickEvent);$(document).trigger(t);this.moveSlide(-1)},this));this.filmstripNextArrow.on("click",$.proxy(function(e){Pb.Track.trf("detail_filmstrip_next_click");var t=$.Event(this.filmstripArrowClickEvent);$(document).trigger(t);this.moveSlide(1)},this));$("#detailfilmstrip").on("click","a",$.proxy(function(e,t){this.handleThumbClick(e,t)},this))},onKeyUp:function(e){var t=e.target.tagName;if(t==="INPUT"||t==="TEXTAREA")return;var n=e.keyCode;if(n===37||n===188){Pb.Track.trf("detail_pagination_left_keyboard_click");this.move(-1)}else if(n===39||n===190){Pb.Track.trf("detail_pagination_right_keyboard_click");this.move(1)}},updateLibData:function(e){this.libData=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET);this.libDataMin=Pb.Data.get("libDataMin");this.libDataMax=Pb.Data.get("libDataMax");this.isFetching=!1;this.contentUpdateInfo={dir:e.dir,start:e.offset};this.handleUpdateLibData();this.slideExpired&&this.doSlideExpired()},handleUpdateLibData:function(){var e,t,n,r;if(this.contentUpdateInfo.dir===-1){e=this.libDataMin;t=this.contentUpdateInfo.start-1;n=this.createThumbs(e,t);r=0}else{e=this.contentUpdateInfo.start;t=this.libDataMax;n=this.createThumbs(e,t);r=this.thumbData.length}$.observable(this.thumbData).insert(r,n)},doSlideExpired:function(){this.toggleLoading();this.slideExpiredData.dir===-1?this.startThumb=$("#thumb_"+this.slideExpiredData.start):this.endThumb=$("#thumb_"+this.slideExpiredData.start);this.slideExpired=!1;this.moveSlide(this.slideExpiredData.dir)},shouldResize:function(){var e=this.win.width();if(this.windowWidth===e)return!1;this.windowWidth=e;return!0},configureLayout:function(){var e=this.win.width();if(!this.shouldResize())return;e<=1024&&!this.isCompact?this.switchCompact():e>1024&&this.isCompact&&this.switchNormal()},switchCompact:function(){var e=$("#mediaTemplateTarget");this.isCompact=!0;var t=$.Event(this.filmstripCompactEvent);$(document).trigger(t);e.addClass("compact");this.filmstripWrapper.addClass("compact");$("#detailfilmstrip").width(120).height(450)},switchNormal:function(){var e=$("#mediaTemplateTarget");this.isCompact=!1;var t=$.Event(this.filmstripNormalEvent);$(document).trigger(t);e.removeClass("compact");this.filmstripWrapper.removeClass("compact")},configureScrollable:function(){if(!this.shouldResize())return;this.hasResized&&(this.itemContainer[0].innerHTML="");this.scrollableWidth=$(this.scrollableWrapper).outerWidth();this.scrollableHeight=this.verticalThumbHeight;if(!this.isCompact){$(this.scrollableId).width(this.scrollableWidth);$(this.scrollableId).height(this.scrollableHeight)}this.createStrip(this.libDataMin,this.libDataMax)},preloadThumbs:function(e,t){var n=[];for(var r in this.libData)r>=e&&r<=t&&this.libData.hasOwnProperty(r)&&!this.libData[r].thWidth&&n.push(this.libData[r].thumbUrl);if(n.length>0){var i=new Pb.ClientImagePreloader;i.preLoad(this.preloadThumbsEvent,n)}},handlePreloadThumbs:function(e){var t,n,r,i;if(e.dimensions){r=e.dimensions;for(var s in this.libData){if(this.libData.hasOwnProperty(s)){t=this.libData[s];if(r[t.thumbUrl]){t.thWidth=r[t.thumbUrl].width;t.thHeight=r[t.thumbUrl].height}}if(!t.thWidth||!t.thHeight)continue;if(t.thWidth>t.thHeight){i=(t.thWidth*70/t.thHeight-70)/2;n="margin-left: -"+i+"px; max-height: 70px"}else{i=(t.thHeight*70/t.thWidth-70)/2;n="margin-top: -"+i+"px; max-width: 70px"}if(t.thPlaceHold){var o=$("#thumb_"+t.offset+" img");o.attr("src",t.thumbUrl).attr("style",n);t.thPlaceHold=!1}}}},createStrip:function(e,t){this.itemContainer=$("#itemContainer");this.thumbData=this.createThumbs(e,t);Pb.JSTemplates.link("#thumbTemplate",this.itemContainer,this.thumbData);this.itemContainer.css("visibility","visible");this.startThumb=$("#thumb_"+this.currentOffset);this.startThumb.addClass("selected");this.currentThumb=this.startThumb;this.toggleMediaArrow();var n=this.getSlideOffsetData(this.currentOffset,this.libDataMax,1);this.endThumb=$("#thumb_"+n.endOffset);this.moveSlideMargins(n);this.toggleThumbVisibility(this.currentOffset,n.endOffset);this.testThresholds(1)},testThresholds:function(e){var t=this.endThumb.data("index")-this.startThumb.data("index")+20,n=this.endThumb.data("index")+1+t;n>this.total&&(n=this.total);var r=this.startThumb.data("index")-1-t;r<0&&(r=0);var i={dir:e},s=!1;if(e===1&&this.libDataMax<n){s=!0;i.startOffset=this.libDataMax+1}else if(e===-1&&this.libDataMin>=r){s=!0;i.startOffset=this.libDataMin}if(s&&this.lastFetchOffset!==i.startOffset){this.isFetching=!0;this.lastFetchOffset=i.startOffset;var o=$.Event(this.filmstripSlideEvent,i);$(document).trigger(o)}else this.slideExpired&&this.doSlideExpired()},createThumbs:function(e,t){var n=[];for(var r=e;r<=t;r++){var i,s,o,u=this.libData[r];if(!u.thWidth){i=this.placeHoldThumb;o="";u.thPlaceHold=!0}else{i=u.thumbUrl;if(u.thWidth>u.thHeight){s=(u.thWidth*70/u.thHeight-70)/2;o="margin-left: -"+s+"px; max-height: 70px"}else{s=(u.thHeight*70/u.thWidth-70)/2;o="margin-top: -"+s+"px; max-width: 70px"}}var a={thumbId:"thumb_"+r,dataIndex:""+r,altText:u.altText,thumbUrl:i,imgStyle:o,mediaType:u.mediaType};n.push(a)}return n},moveSlideMargins:function(e){if(this.isCompact){this.startThumb.css("margin-top",e.diff+"px");this.endThumb.css("margin-bottom",e.diff+"px")}else{this.startThumb.css("margin-left",e.diff+"px");this.endThumb.css("margin-right",e.diff+"px")}},resetMargins:function(){this.startThumb.css({"margin-top":0,"margin-left":0});this.endThumb.css({"margin-bottom":0,"margin-right":0})},toggleThumbVisibility:function(e,t){e===0?this.filmstripPrevArrow.hide():this.filmstripPrevArrow.show();t===this.total-1?this.filmstripNextArrow.hide():this.filmstripNextArrow.show();this.hideThumbVisibility();for(var n=e;n<=t;n++)$("#thumb_"+n).show();this.preloadThumbs(e,t);this.filmstripWrapper.hasClass("off")&&this.filmstripWrapper.removeClass("off").fadeTo(300,1);e-=3;e<0&&(e=0);this.preloadFullsizeImages(e,t)},hideThumbVisibility:function(){for(var e in this.libData)this.libData.hasOwnProperty(e)&&$("#thumb_"+e).hide()},getSlideOffsetData:function(e,t,n){var r;this.isCompact?r=this.getVerticalOffset(e,n):r=this.getHorizontalOffset(e,n);return r},getHorizontalOffset:function(e,t){var n,r,i,s,o,u=70+this.thumbPaddingBorder;n=Math.floor(this.scrollableWidth/u);r=n*u;if(t===-1){s=e-(n-1);s<0&&(s=this.libDataMin);o=e-s+1}else{s=e+(n-1);s>this.total-1&&(s=this.libDataMax);o=s-e+1}var a=o*u;a<this.scrollableWidth?i=(this.scrollableWidth-a)/2:i=(this.scrollableWidth-r)/2;return{diff:i,endOffset:s}},getVerticalOffset:function(e,t){var n,r,i,s,o;n=Math.floor(this.verticalHeight/this.verticalThumbHeight);r=n*this.verticalThumbHeight;if(t===-1){s=e-(n-1);s<0&&(s=this.libDataMin);o=e-s+1}else{s=e+(n-1);s>this.total-1&&(s=this.libDataMax);o=s-e+1}var u=o*this.verticalThumbHeight;u<this.verticalHeight?i=(this.verticalHeight-u)/2:i=(this.verticalHeight-r)/2;return{diff:i,endOffset:s}},moveSlide:function(e){var t,n,r;if(this.slideExpired)return;if(e===-1){var i=this.startThumb.data("index");if(i===this.libDataMin)return;this.lastSlideIndex=i;t=parseInt(i,10)-1;n=this.libDataMin;r=this.getSlideOffsetData(t,n,e);if(r.endOffset<this.libDataMin){this.handleSlideExpired(e);return}this.resetMargins();this.startThumb=$("#thumb_"+r.endOffset);this.endThumb=$("#thumb_"+t);this.toggleThumbVisibility(r.endOffset,t)}else if(e===1){var s=this.endThumb.data("index");if(s===this.libDataMax)return;this.lastSlideIndex=s;t=parseInt(s,10)+1;n=this.libDataMax;r=this.getSlideOffsetData(t,n,e);if(r.endOffset>this.libDataMax){this.handleSlideExpired(e);return}this.resetMargins();this.startThumb=$("#thumb_"+t);this.endThumb=$("#thumb_"+r.endOffset);this.toggleThumbVisibility(t,r.endOffset)}this.moveSlideMargins(r);this.testThresholds(e)},handleSlideExpired:function(e){this.hideThumbVisibility();this.toggleLoading();this.slideExpired=!0;this.slideExpiredData={start:this.lastSlideIndex,dir:e}},preloadFullsizeImages:function(e,t){var n=[];for(var r=e;r<=t;r++){var i=this.libData[r];typeof i!="undefined"&&i.mediaType==="image"&&(i.fsWidth||n.push(i.fullsizeUrl))}if(n.length>0){var s=new Pb.ClientImagePreloader;s.preLoad("preloadFullsize",n,{start:e,end:t})}},handlePreloadedFullsize:function(e){var t=e.dimensions,n=e.memo;for(var r=n.start;r<=n.end;r++){var i=this.libData[r];if(typeof i=="undefined")continue;var s=i.fullsizeUrl,o;if(i.mediaType==="image"){if(t[s]){i.fsWidth=t[s].width;i.fsHeight=t[s].height}if(i.rsWidth===""){o={width:i.fsWidth,height:i.fsHeight};var u=Pb.Data.get("mediaMaxDims");if(i.fsWidth>u.width||i.fsHeight>u.height){var a=new Pb.ClientImageRescaler(u);o=a.rescale(o)}if(o){i.rsWidth=o.width;i.rsHeight=o.height}}}i.placeHold===!0&&$(document).trigger($.Event("Pb.Component.Media.Media::replacePlaceHolder"))}$(document).trigger($.Event(this.fullsizePreloadEvent))},handleThumbClick:function(e,t){var n=this.currentOffset;this.currentThumb.removeClass("selected");this.currentThumb=$(e.currentTarget).parents(".wrap");this.currentThumb.addClass("selected");this.currentThumb.data("isprevnextclick")!=="true"&&t!=="prevnextclick"?Pb.Track.trf("detail_filmstrip_thumbnail_click"):this.currentThumb.removeData("isprevnextclick");this.currentOffset=this.currentThumb.data("index");this.toggleMediaArrow();var r=this.currentOffset-3;r<0&&(r=0);var i=this.currentOffset+3;i>this.total&&(i=this.total);this.preloadFullsizeImages(r,i);var s=$.Event(this.filmstripOffsetUpdateEvent,{currentOffset:this.currentOffset,oldOffset:n});$(document).trigger(s)},move:function(e){var t=this.currentOffset+e;if(t<this.libDataMin||t>this.libDataMax)return;var n=this.startThumb.data("index")-1;n<0&&(n=0);var r=this.endThumb.data("index")+1;r>this.libDataMax&&(r=this.libDataMax);if(e===-1&&t===this.startThumb.data("index")+3){var i=n-10;i<0&&(i=0);this.preloadFullsizeImages(i,n)}else if(e===1&&t===this.endThumb.data("index")-3){var s=r+10;s>this.libDataMax&&(s=this.libDataMax);this.preloadFullsizeImages(r,s)}t===this.startThumb.data("index")-1?this.moveSlide(-1):t===this.endThumb.data("index")+1&&this.moveSlide(1);var o=$("#thumb_"+t);o.data("isprevnextclick","true");o.find("a").trigger("click",["prevnextclick"])},toggleMediaArrow:function(){var e=this.currentOffset,t=e===0?"hidden":"visible";$("#mediaTemplate div#previous").css("visibility",t);$("#mediaTemplate").data("prev",t);$("#btnprev").toggleClass("disabled",e===0);var n=e===this.total-1?"hidden":"visible";$("#mediaTemplate div#next").css("visibility",n);$("#mediaTemplate").data("next",n);$("#btnnext").toggleClass("disabled",e===this.total-1)},toggleLoading:function(){this.filmstripLoading.toggle()}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.RecentUploads",!0).RecentUploadsDetailManager=function(){function e(e){this.init(e)}var t={start:0,end:19,current:0,libData:null,libDataMax:null,libDataMin:null,mediaPrevArrow:null,mediaNextArrow:null,maxFullSizeDims:{width:600,height:450},init:function(){this.updateLibData();this.bindEvents();this.preloadFullsize(this.start,this.end);this.getElements()},getElements:function(){this.mediaPrevArrow=$("#mediaTemplate a#previous");this.mediaNextArrow=$("#mediaTemplate a#next")},bindEvents:function(){var e=$(document);e.on("Pb.Component.Media.Media::media_previous_click",$.proxy(function(){Pb.Track.trf("detail_pagination_previous_click");this.move(-1)},this)).on("Pb.Component.Media.Media::media_next_click",$.proxy(function(){Pb.Track.trf("detail_pagination_next_click");this.move(1)},this)).on("Pb.Component.Detail.DetailActions::media_next_click",$.proxy(function(e){this.move(1)},this)).on("Pb.Component.Detail.DetailActions::media_previous_click",$.proxy(function(e){this.move(-1)},this));e.on("keyup.mediadetail",$.proxy(this.onKeyUp,this));e.on("Pb.Component.Media.ZoomModal::shown",function(){$(document).off("keyup.mediadetail")});e.on("Pb.Component.Media.ZoomModal::hide",$.proxy(function(e){$(document).on("keyup.mediadetail",$.proxy(this.onKeyUp,this))},this));e.on("Pb.Component.Detail.Fetcher::libdata_update",$.proxy(this.updateLibData,this));e.on("preloadFullsize",$.proxy(this.handlePreloadedFullsize,this))},onKeyUp:function(e){var t=e.target.tagName;if(t==="INPUT"||t==="TEXTAREA")return;var n=e.keyCode;if(n===37||n===188){Pb.Track.trf("detail_pagination_left_keyboard_click");this.move(-1)}else if(n===39||n===190){Pb.Track.trf("detail_pagination_right_keyboard_click");this.move(1)}},updateLibData:function(e){this.libData=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET);this.libDataMax=Pb.Data.get("libDataMax");this.libDataMin=Pb.Data.get("libDataMin");typeof e!="undefined"&&this.preloadFullsize(e.offset,this.libDataMax)},preloadFullsize:function(e,t){var n=[];for(var r=e;r<=t;r++){var i=this.libData[r];typeof i!="undefined"&&i.mediaType==="image"&&(i.fsWidth||n.push(i.fullsizeUrl))}if(n.length>0){var s=new Pb.ClientImagePreloader;s.preLoad("preloadFullsize",n,{start:e,end:t})}},handlePreloadedFullsize:function(e){var t=e.dimensions,n=e.memo;for(var r=n.start;r<=n.end;r++){var i=this.libData[r];if(typeof i=="undefined")continue;var s=i.fullsizeUrl,o;if(i.mediaType==="image"){if(t[s]){i.fsWidth=t[s].width;i.fsHeight=t[s].height}if(i.rsWidth===""){o={width:i.fsWidth,height:i.fsHeight};if(i.fsWidth>this.maxFullSizeDims.width||i.fsHeight>this.maxFullSizeDims.height){var u=new Pb.ClientImageRescaler(this.maxFullSizeDims);o=u.rescale(o)}if(o){i.rsWidth=o.width;i.rsHeight=o.height}}if(i.placeHold){var a=$("#"+i.placeHolderId);a.length>0&&a.attr("src",i.fullsizeUrl).css({width:i.rsWidth+"px",height:i.rsHeight+"px"});i.placeHold=!1}}}},move:function(e){this.current=this.current+e;this.current<0&&(this.current=0);var t=$.Event("Pb.Component.RecentUploads.RecentUploadsDetailManager::recentuploads_offset_update",{currentOffset:this.current});$(document).trigger(t);this.testThresholds(e)},testThresholds:function(e){var t=20,n=this.current+t,r={isFirstRender:!1,dir:e},i=!1;if(e===1&&this.libDataMax<=n){i=!0;r.startOffset=this.libDataMax+1}if(i){var s=$.Event("Pb.Component.RecentUploads.RecentUploadsDetailManager::recentuploads_update",r);$(document).trigger(s)}},toggleMediaArrow:function(){var e=this.current,t=e===0?"hidden":"visible";this.mediaPrevArrow.css("visibility",t);$("#mediaTemplate").data("prev",t);$("#btnprev").toggleClass("disabled",e===0)}};$.extend(e.prototype,t);return e}();$.getObject("Pb",!0).StorageMessage=function(){function e(e){var t={name:e},n={url:"/action/notification/update",data:t};Pb.Ajax.ajax(n)}return{close:e}}();$.getObject("Pb.Component.Bandwidth",!0).BandwidthNotification=function(){function e(e){var t={name:"bandwidthNotificationShown"},n={url:"/action/notification/update",data:t,success:function(){e&&(location.href=e)}};Pb.Ajax.ajax(n)}function t(){$("#bandwidthWarning").on("close",function(){e()})}Pb.InitEventQueue.add(t);return{setViewed:e}}();